<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Documentation for OptaDOS">
    <meta name="author" content="The OptaDOS developers group" >
    <link rel="icon" href="../favicon.png">

    <title>parameters.f90 &ndash; OptaDOS</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">OptaDOS </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
            <li><a href="../lists/programs.html">Programs</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>parameters.f90
      <small>Source File</small>
      
    </h1>
      <div class="row" id="info-bar">
    <div class="col-lg-12">
      <div class="well well-sm">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">

          <li id="statements"><i class="fa fa-list-ol"></i>
            <a data-toggle="tooltip"
               data-placement="bottom" data-html="true"
               title="13.9% of total for source files.">1268 statements</a>
          </li>

            <li id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/parameters.f90"> Source File</a>
            </li>
        </ul>
        <ol class="breadcrumb in-well text-right">
          <li class="active">parameters.f90</li>
        </ol>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
      <div class="panel panel-primary">
      <div class="panel-heading text-left">
        <h3 class="panel-title">
          <a data-toggle="collapse" href="#mods-0">Modules</a>
        </h3>
      </div>
      <div id="mods-0" class="panel-collapse collapse">
        <div class="list-group">
            <a class="list-group-item" href="../module/od_parameters.html">od_parameters</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="panel panel-primary">
      <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../sourcefile/parameters.f90.html#src">parameters.f90</a>
      </div>
    </div>


  </div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~parameters.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefileparametersf90EfferentGraph" width="549pt" height="162pt"
 viewBox="0.00 0.00 549.00 162.48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parameters.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 158.48)">
<title>sourcefile~~parameters.f90~~EfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-158.48 545,-158.48 545,4 -4,4"/>
<!-- sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~parameters.f90</title>
<polygon fill="none" stroke="black" points="541,-82.3 446,-82.3 446,-58.3 541,-58.3 541,-82.3"/>
<text text-anchor="middle" x="493.5" y="-67.9" font-family="Helvetica,sans-Serif" font-size="10.50">parameters.f90</text>
</g>
<!-- sourcefile~constants.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~constants.f90</title>
<g id="a_sourcefile~~parameters.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/constants.f90.html" xlink:title="constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="84,-82.3 0,-82.3 0,-58.3 84,-58.3 84,-82.3"/>
<text text-anchor="middle" x="42" y="-67.9" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parameters.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~parameters.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M274,-150.3C205.28,-144.52 183.62,-157.92 120,-131.3 97.43,-121.85 75.98,-103.84 61.48,-89.83"/>
<polygon fill="#ff0000" stroke="#ff0000" points="63.73,-87.13 54.18,-82.54 58.78,-92.08 63.73,-87.13"/>
</g>
<!-- sourcefile~io.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~io.f90</title>
<g id="a_sourcefile~~parameters.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/io.f90.html" xlink:title="io.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="184,-122.3 130,-122.3 130,-98.3 184,-98.3 184,-122.3"/>
<text text-anchor="middle" x="157" y="-107.9" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">io.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parameters.f90&#45;&gt;sourcefile~io.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~parameters.f90&#45;&gt;sourcefile~io.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M382,-150.3C335.32,-156.68 322.95,-154.25 276,-150.3"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M274,-150.3C244.84,-147.85 213.57,-136.51 190.85,-126.52"/>
<polygon fill="#ff0000" stroke="#ff0000" points="192.23,-123.3 181.67,-122.36 189.33,-129.68 192.23,-123.3"/>
</g>
<!-- sourcefile~cell.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~cell.f90</title>
<g id="a_sourcefile~~parameters.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/cell.f90.html" xlink:title="cell.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="410,-82.3 356,-82.3 356,-58.3 410,-58.3 410,-82.3"/>
<text text-anchor="middle" x="383" y="-67.9" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">cell.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parameters.f90&#45;&gt;sourcefile~cell.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~parameters.f90&#45;&gt;sourcefile~cell.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M445.86,-70.3C437.39,-70.3 428.67,-70.3 420.55,-70.3"/>
<polygon fill="#ff0000" stroke="#ff0000" points="420.28,-66.8 410.28,-70.3 420.28,-73.8 420.28,-66.8"/>
</g>
<!-- sourcefile~algorithms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~algorithms.f90</title>
<g id="a_sourcefile~~parameters.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/algorithms.f90.html" xlink:title="algorithms.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="320,-82.3 230,-82.3 230,-58.3 320,-58.3 320,-82.3"/>
<text text-anchor="middle" x="275" y="-67.9" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">algorithms.f90</text>
</a>
</g>
</g>
<!-- sourcefile~parameters.f90&#45;&gt;sourcefile~algorithms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~parameters.f90&#45;&gt;sourcefile~algorithms.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M483.37,-82.31C466.48,-103.12 428.06,-144.27 384,-150.3"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M382,-150.3C341.95,-155.78 307.04,-116.23 289.01,-90.76"/>
<polygon fill="#ff0000" stroke="#ff0000" points="291.87,-88.74 283.36,-82.43 286.08,-92.67 291.87,-88.74"/>
</g>
<!-- sourcefile~comms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~comms.f90</title>
<g id="a_sourcefile~~parameters.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/comms.f90.html" xlink:title="comms.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="194,-42.3 120,-42.3 120,-18.3 194,-18.3 194,-42.3"/>
<text text-anchor="middle" x="157" y="-27.9" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">comms.F90</text>
</a>
</g>
</g>
<!-- sourcefile~parameters.f90&#45;&gt;sourcefile~comms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~parameters.f90&#45;&gt;sourcefile~comms.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M463.54,-58.25C429.77,-44.91 371.96,-24.24 320,-16.3 280.46,-10.25 269.82,-12.46 230,-16.3 221.53,-17.11 212.57,-18.46 203.96,-20"/>
<polygon fill="#ff0000" stroke="#ff0000" points="203.23,-16.58 194.06,-21.88 204.54,-23.45 203.23,-16.58"/>
</g>
<!-- sourcefile~io.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~io.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M129.79,-101.02C117.08,-96.52 101.46,-90.99 86.99,-85.87"/>
<polygon fill="#cbff00" stroke="#cbff00" points="87.81,-82.45 77.21,-82.41 85.47,-89.05 87.81,-82.45"/>
</g>
<!-- sourcefile~cell.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~cell.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M355.91,-58.78C334.74,-49.85 303.93,-37.77 276,-30.3"/>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M274,-30.3C207.27,-12.45 185.24,13.41 120,-9.3 96.49,-17.48 74.76,-36.17 60.42,-50.71"/>
<polygon fill="#00ff66" stroke="#00ff66" points="57.59,-48.61 53.25,-58.28 62.67,-53.43 57.59,-48.61"/>
</g>
<!-- sourcefile~cell.f90&#45;&gt;sourcefile~io.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~cell.f90&#45;&gt;sourcefile~io.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M355.8,-80.53C344.88,-84.44 331.97,-88.6 320,-91.3 277.37,-100.91 227.28,-105.83 194.21,-108.23"/>
<polygon fill="#00ff66" stroke="#00ff66" points="193.83,-104.75 184.1,-108.93 194.31,-111.73 193.83,-104.75"/>
</g>
<!-- sourcefile~cell.f90&#45;&gt;sourcefile~algorithms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~cell.f90&#45;&gt;sourcefile~algorithms.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M355.8,-70.3C347.96,-70.3 339.06,-70.3 330.11,-70.3"/>
<polygon fill="#00ff66" stroke="#00ff66" points="330.05,-66.8 320.05,-70.3 330.05,-73.8 330.05,-66.8"/>
</g>
<!-- sourcefile~cell.f90&#45;&gt;sourcefile~comms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~cell.f90&#45;&gt;sourcefile~comms.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M274,-30.3C251.6,-24.31 225.88,-23.71 204.36,-24.86"/>
<polygon fill="#00ff66" stroke="#00ff66" points="203.9,-21.38 194.16,-25.55 204.38,-28.37 203.9,-21.38"/>
</g>
<!-- sourcefile~algorithms.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~algorithms.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M229.73,-70.3C191.05,-70.3 134.87,-70.3 94.25,-70.3"/>
<polygon fill="#0066ff" stroke="#0066ff" points="94.01,-66.8 84.01,-70.3 94.01,-73.8 94.01,-66.8"/>
</g>
<!-- sourcefile~algorithms.f90&#45;&gt;sourcefile~io.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~algorithms.f90&#45;&gt;sourcefile~io.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M239.2,-82.3C224.88,-87.24 208.31,-92.95 193.88,-97.92"/>
<polygon fill="#0066ff" stroke="#0066ff" points="192.61,-94.66 184.3,-101.23 194.89,-101.28 192.61,-94.66"/>
</g>
<!-- sourcefile~algorithms.f90&#45;&gt;sourcefile~comms.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~algorithms.f90&#45;&gt;sourcefile~comms.f90</title>
<path fill="none" stroke="#0066ff" stroke-dasharray="5,2" d="M239.2,-58.3C227.72,-54.34 214.79,-49.88 202.67,-45.7"/>
<polygon fill="#0066ff" stroke="#0066ff" points="203.77,-42.38 193.18,-42.43 201.49,-49 203.77,-42.38"/>
</g>
<!-- sourcefile~comms.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~parameters.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~comms.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M122.1,-42.3C111.02,-46.22 98.57,-50.63 86.87,-54.77"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="85.53,-51.53 77.27,-58.17 87.87,-58.13 85.53,-51.53"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193.5,-24 88.5,-24 88.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~parameters.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefileparametersf90AfferentGraph" width="641pt" height="429pt"
 viewBox="0.00 0.00 641.00 429.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~parameters.f90~~AfferentGraph" class="graph" transform="scale(1.1 1.1) rotate(0) translate(4 466.77)">
<title>sourcefile~~parameters.f90~~AfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-466.77 699,-466.77 699,4 -4,4"/>
<!-- sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~parameters.f90</title>
<polygon fill="none" stroke="black" points="95,-213.37 0,-213.37 0,-189.37 95,-189.37 95,-213.37"/>
<text text-anchor="middle" x="47.5" y="-198.97" font-family="Helvetica,sans-Serif" font-size="10.50">parameters.f90</text>
</g>
<!-- sourcefile~od2od.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~od2od.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/od2od.f90.html" xlink:title="od2od.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="342,-409.37 275,-409.37 275,-385.37 342,-385.37 342,-409.37"/>
<text text-anchor="middle" x="308.5" y="-394.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">od2od.f90</text>
</a>
</g>
</g>
<!-- sourcefile~od2od.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~od2od.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M274.98,-386.06C266.88,-382.23 258.63,-377.37 252,-371.37 202.13,-326.23 233.92,-272.89 174.5,-241.37"/>
</g>
<!-- sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~electronic.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/electronic.f90.html" xlink:title="electronic.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="216,-213.37 131,-213.37 131,-189.37 216,-189.37 216,-213.37"/>
<text text-anchor="middle" x="173.5" y="-198.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">electronic.f90</text>
</a>
</g>
</g>
<!-- sourcefile~od2od.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge13" class="edge">
<title>sourcefile~od2od.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M274.86,-387.82C266.37,-383.93 257.95,-378.6 252,-371.37 210.07,-320.44 254.76,-280.75 216,-227.37 214,-224.62 211.61,-222.09 209.01,-219.79"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="210.8,-216.76 200.71,-213.54 206.59,-222.35 210.8,-216.76"/>
</g>
<!-- sourcefile~electronic.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~electronic.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M130.86,-201.37C122.76,-201.37 114.14,-201.37 105.63,-201.37"/>
<polygon fill="#ff0000" stroke="#ff0000" points="105.37,-197.87 95.37,-201.37 105.37,-204.87 105.37,-197.87"/>
</g>
<!-- sourcefile~dos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~dos_utils.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/dos_utils.f90.html" xlink:title="dos_utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="348,-133.37 269,-133.37 269,-109.37 348,-109.37 348,-133.37"/>
<text text-anchor="middle" x="308.5" y="-118.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dos_utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~dos_utils.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~dos_utils.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M268.99,-123.22C241.91,-125.46 205.17,-130.41 174.5,-141.37"/>
</g>
<!-- sourcefile~dos_utils.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge16" class="edge">
<title>sourcefile~dos_utils.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M279.36,-133.42C270.45,-137.54 260.66,-142.37 252,-147.37 233.36,-158.13 213.46,-172.05 198.5,-183.06"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="196.23,-180.38 190.3,-189.16 200.41,-186 196.23,-180.38"/>
</g>
<!-- sourcefile~pdos.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~pdos.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/pdos.f90.html" xlink:title="pdos.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="472.5,-329.37 411.5,-329.37 411.5,-305.37 472.5,-305.37 472.5,-329.37"/>
<text text-anchor="middle" x="442" y="-314.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">pdos.F90</text>
</a>
</g>
</g>
<!-- sourcefile~pdos.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~pdos.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M432.42,-329.59C414.45,-355.06 373.79,-411.99 365,-418.37 343.9,-433.68 334.46,-444.92 309.5,-437.37"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M307.5,-437.37C282.54,-429.82 271.18,-436.03 252,-418.37 188.81,-360.21 250.37,-281.61 174.5,-241.37"/>
</g>
<!-- sourcefile~pdos.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge17" class="edge">
<title>sourcefile~pdos.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M411.28,-308.5C365.57,-294.65 280.33,-267.98 252,-253.37 234.46,-244.33 232.37,-238.39 216,-227.37 211.9,-224.61 207.51,-221.76 203.19,-219"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="204.84,-215.91 194.51,-213.54 201.11,-221.83 204.84,-215.91"/>
</g>
<!-- sourcefile~pdos.f90&#45;&gt;sourcefile~dos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge24" class="edge">
<title>sourcefile~pdos.f90&#45;&gt;sourcefile~dos_utils.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M438.59,-305C432.04,-274.44 411.22,-194.42 365,-147.37 361.77,-144.08 358.04,-141.16 354.07,-138.57"/>
<polygon fill="#ffff00" stroke="#ffff00" points="355.53,-135.38 345.11,-133.45 352.05,-141.45 355.53,-135.38"/>
</g>
<!-- sourcefile~projection_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~projection_utils.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/projection_utils.f90.html" xlink:title="projection_utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="365,-329.37 252,-329.37 252,-305.37 365,-305.37 365,-329.37"/>
<text text-anchor="middle" x="308.5" y="-314.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">projection_utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pdos.f90&#45;&gt;sourcefile~projection_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge31" class="edge">
<title>sourcefile~pdos.f90&#45;&gt;sourcefile~projection_utils.f90</title>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M411.49,-317.37C400.67,-317.37 387.96,-317.37 375.24,-317.37"/>
<polygon fill="#00ff7f" stroke="#00ff7f" points="375.08,-313.87 365.08,-317.37 375.08,-320.87 375.08,-313.87"/>
</g>
<!-- sourcefile~pdis.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~pdis.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/pdis.f90.html" xlink:title="pdis.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="469.5,-409.37 414.5,-409.37 414.5,-385.37 469.5,-385.37 469.5,-409.37"/>
<text text-anchor="middle" x="442" y="-394.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">pdis.f90</text>
</a>
</g>
</g>
<!-- sourcefile~pdis.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~pdis.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M423.56,-409.41C398.39,-425.26 350.38,-449.74 309.5,-437.37"/>
</g>
<!-- sourcefile~pdis.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge15" class="edge">
<title>sourcefile~pdis.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M414.16,-389.7C363.41,-375.09 257.93,-344.23 252,-338.37 215.13,-301.9 247.9,-268.27 216,-227.37 213.79,-224.54 211.18,-221.93 208.36,-219.55"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="210.15,-216.53 200.01,-213.46 206.02,-222.18 210.15,-216.53"/>
</g>
<!-- sourcefile~pdis.f90&#45;&gt;sourcefile~projection_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge32" class="edge">
<title>sourcefile~pdis.f90&#45;&gt;sourcefile~projection_utils.f90</title>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M425.83,-385.35C410.86,-373.8 387.09,-356.25 365,-343.37 359.33,-340.07 353.17,-336.84 347.09,-333.86"/>
<polygon fill="#00ff7f" stroke="#00ff7f" points="348.2,-330.51 337.67,-329.38 345.19,-336.83 348.2,-330.51"/>
</g>
<!-- sourcefile~projection_utils.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~projection_utils.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M279.75,-305.26C270.77,-301.11 260.84,-296.27 252,-291.37 216.14,-271.52 210.71,-260.58 174.5,-241.37"/>
</g>
<!-- sourcefile~projection_utils.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge14" class="edge">
<title>sourcefile~projection_utils.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M273.14,-305.33C265.61,-301.64 258.08,-297.02 252,-291.37 228.08,-269.17 238.52,-250.99 216,-227.37 213.24,-224.48 210.09,-221.77 206.8,-219.28"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="208.65,-216.3 198.42,-213.54 204.69,-222.08 208.65,-216.3"/>
</g>
<!-- sourcefile~jdos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node8" class="node">
<title>sourcefile~jdos_utils.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node8"><a xlink:href=".././sourcefile/jdos_utils.f90.html" xlink:title="jdos_utils.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="483,-173.37 401,-173.37 401,-149.37 483,-149.37 483,-173.37"/>
<text text-anchor="middle" x="442" y="-158.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jdos_utils.f90</text>
</a>
</g>
</g>
<!-- sourcefile~jdos_utils.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~jdos_utils.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M400.99,-160.6C374.93,-160.29 340.19,-160.24 309.5,-161.37"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M307.5,-161.37C247.77,-163.58 230.79,-121.25 174.5,-141.37"/>
</g>
<!-- sourcefile~jdos_utils.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge18" class="edge">
<title>sourcefile~jdos_utils.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M307.5,-161.37C273.31,-162.64 236.17,-174.78 209.85,-185.36"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="208.21,-182.25 200.32,-189.32 210.9,-188.72 208.21,-182.25"/>
</g>
<!-- sourcefile~jdos_utils.f90&#45;&gt;sourcefile~dos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge27" class="edge">
<title>sourcefile~jdos_utils.f90&#45;&gt;sourcefile~dos_utils.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M401.55,-149.37C387.78,-145.18 372.17,-140.43 357.76,-136.05"/>
<polygon fill="#ffff00" stroke="#ffff00" points="358.61,-132.65 348.02,-133.09 356.57,-139.35 358.61,-132.65"/>
</g>
<!-- sourcefile~jdos.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node9" class="node">
<title>sourcefile~jdos.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node9"><a xlink:href=".././sourcefile/jdos.f90.html" xlink:title="jdos.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="578.5,-253.37 523.5,-253.37 523.5,-229.37 578.5,-229.37 578.5,-253.37"/>
<text text-anchor="middle" x="551" y="-238.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">jdos.f90</text>
</a>
</g>
</g>
<!-- sourcefile~jdos.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~jdos.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M307.5,-239.37C248.56,-234.79 226.73,-269.07 174.5,-241.37"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M172.5,-241.37C151.44,-230.2 126.72,-221.45 104.9,-215.02"/>
<polygon fill="#ff0000" stroke="#ff0000" points="105.69,-211.61 95.11,-212.23 103.77,-218.34 105.69,-211.61"/>
</g>
<!-- sourcefile~jdos.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge19" class="edge">
<title>sourcefile~jdos.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M523.27,-242.16C478.84,-243.24 386.99,-244.52 309.5,-239.37"/>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M307.5,-239.37C274.91,-236.84 239.38,-226.26 213.25,-216.9"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="214.31,-213.56 203.72,-213.4 211.89,-220.13 214.31,-213.56"/>
</g>
<!-- sourcefile~jdos.f90&#45;&gt;sourcefile~jdos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge33" class="edge">
<title>sourcefile~jdos.f90&#45;&gt;sourcefile~jdos_utils.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M535.95,-229.35C522.62,-218.11 501.87,-201.05 483,-187.37 479.2,-184.62 475.12,-181.81 471.08,-179.1"/>
<polygon fill="#00ffff" stroke="#00ffff" points="472.68,-175.97 462.39,-173.41 468.84,-181.82 472.68,-175.97"/>
</g>
<!-- sourcefile~optados.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node10" class="node">
<title>sourcefile~optados.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node10"><a xlink:href=".././sourcefile/optados.f90.html" xlink:title="optados.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="695,-213.37 619,-213.37 619,-189.37 695,-189.37 695,-213.37"/>
<text text-anchor="middle" x="657" y="-198.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">optados.f90</text>
</a>
</g>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M550,-437.37C449.47,-473.7 411.81,-468.32 309.5,-437.37"/>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge23" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M618.93,-199.01C576.34,-196.84 504.41,-194.86 443,-201.37"/>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~pdos.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge29" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~pdos.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M655.87,-213.53C654.62,-257.06 643.59,-404.27 552,-437.37"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M550,-437.37C537.48,-441.9 484.17,-373 457.84,-337.62"/>
<polygon fill="#7fff00" stroke="#7fff00" points="460.53,-335.37 451.77,-329.42 454.9,-339.54 460.53,-335.37"/>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~pdis.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge30" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~pdis.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M550,-437.37C535.8,-442.5 500.62,-427.37 474.46,-414.27"/>
<polygon fill="#00ff00" stroke="#00ff00" points="475.78,-411.02 465.28,-409.58 472.59,-417.25 475.78,-411.02"/>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~jdos.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge35" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~jdos.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M624.8,-213.37C613.3,-217.8 600.17,-222.84 588.27,-227.42"/>
<polygon fill="#007fff" stroke="#007fff" points="586.69,-224.28 578.61,-231.14 589.2,-230.81 586.69,-224.28"/>
</g>
<!-- sourcefile~dos.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node11" class="node">
<title>sourcefile~dos.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node11"><a xlink:href=".././sourcefile/dos.f90.html" xlink:title="dos.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="469,-93.37 415,-93.37 415,-69.37 469,-69.37 469,-93.37"/>
<text text-anchor="middle" x="442" y="-78.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dos.f90</text>
</a>
</g>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~dos.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge36" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~dos.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M550,-81.37C528.69,-69.21 500.89,-69.59 478.96,-72.82"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="478.3,-69.38 469.04,-74.53 479.49,-76.28 478.3,-69.38"/>
</g>
<!-- sourcefile~optics.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node12" class="node">
<title>sourcefile~optics.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node12"><a xlink:href=".././sourcefile/optics.f90.html" xlink:title="optics.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="583,-173.37 519,-173.37 519,-149.37 583,-149.37 583,-173.37"/>
<text text-anchor="middle" x="551" y="-158.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">optics.f90</text>
</a>
</g>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~optics.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge37" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~optics.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M624.8,-189.37C614.72,-185.49 603.39,-181.14 592.73,-177.04"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="593.77,-173.69 583.18,-173.36 591.26,-180.22 593.77,-173.69"/>
</g>
<!-- sourcefile~core.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_node13" class="node">
<title>sourcefile~core.f90</title>
<g id="a_sourcefile~~parameters.f90~~AfferentGraph_node13"><a xlink:href=".././sourcefile/core.f90.html" xlink:title="core.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="470,-51.37 414,-51.37 414,-27.37 470,-27.37 470,-51.37"/>
<text text-anchor="middle" x="442" y="-36.97" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">core.f90</text>
</a>
</g>
</g>
<!-- sourcefile~optados.f90&#45;&gt;sourcefile~core.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge38" class="edge">
<title>sourcefile~optados.f90&#45;&gt;sourcefile~core.f90</title>
<path fill="none" stroke="#ff007f" stroke-dasharray="5,2" d="M649.27,-189.1C634.96,-164.27 598.92,-108.16 552,-81.37"/>
<path fill="none" stroke="#ff007f" stroke-dasharray="5,2" d="M550,-81.37C527.86,-68.73 501.17,-58.24 479.98,-50.91"/>
<polygon fill="#ff007f" stroke="#ff007f" points="480.96,-47.55 470.37,-47.67 478.72,-54.18 480.96,-47.55"/>
</g>
<!-- sourcefile~dos.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~dos.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M414.95,-69.53C382.55,-55.5 329.13,-34.79 309.5,-41.37"/>
</g>
<!-- sourcefile~dos.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge20" class="edge">
<title>sourcefile~dos.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M414.87,-75.08C387.26,-69.82 343.15,-65.48 309.5,-81.37"/>
</g>
<!-- sourcefile~dos.f90&#45;&gt;sourcefile~dos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge25" class="edge">
<title>sourcefile~dos.f90&#45;&gt;sourcefile~dos_utils.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M414.71,-89.37C398.49,-94.3 377.2,-100.78 358.02,-106.61"/>
<polygon fill="#ffff00" stroke="#ffff00" points="356.77,-103.34 348.22,-109.59 358.8,-110.03 356.77,-103.34"/>
</g>
<!-- sourcefile~optics.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge12" class="edge">
<title>sourcefile~optics.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M544.28,-149.21C538.05,-135.97 527.81,-114.17 519,-95.37 502.97,-61.16 514.87,-38.65 483,-18.37 417.38,23.39 383.24,-16.62 309.5,-41.37"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M307.5,-41.37C281.57,-49.71 274.48,-51.99 252,-67.37 212.7,-94.27 219.35,-125.34 174.5,-141.37"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M172.5,-141.37C139.35,-153.22 103.33,-171.28 78.69,-184.49"/>
<polygon fill="#ff0000" stroke="#ff0000" points="76.96,-181.45 69.84,-189.29 80.3,-187.6 76.96,-181.45"/>
</g>
<!-- sourcefile~optics.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge22" class="edge">
<title>sourcefile~optics.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M528.28,-173.43C507.23,-184.15 474.01,-198.55 443,-201.37"/>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M441,-201.37C366.7,-208.13 280.27,-206.38 226.46,-204.15"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="226.29,-200.64 216.15,-203.7 225.99,-207.63 226.29,-200.64"/>
</g>
<!-- sourcefile~optics.f90&#45;&gt;sourcefile~dos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge26" class="edge">
<title>sourcefile~optics.f90&#45;&gt;sourcefile~dos_utils.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M518.97,-150.26C507.76,-146.62 494.93,-142.87 483,-140.37 441.47,-131.68 393.47,-126.81 358.5,-124.18"/>
<polygon fill="#ffff00" stroke="#ffff00" points="358.31,-120.66 348.09,-123.44 357.81,-127.64 358.31,-120.66"/>
</g>
<!-- sourcefile~optics.f90&#45;&gt;sourcefile~jdos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge34" class="edge">
<title>sourcefile~optics.f90&#45;&gt;sourcefile~jdos_utils.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M518.76,-161.37C510.78,-161.37 502,-161.37 493.33,-161.37"/>
<polygon fill="#00ffff" stroke="#00ffff" points="493.25,-157.87 483.25,-161.37 493.25,-164.87 493.25,-157.87"/>
</g>
<!-- sourcefile~core.f90&#45;&gt;sourcefile~parameters.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~core.f90&#45;&gt;sourcefile~parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M413.75,-35.07C386.58,-31.86 344.03,-29.79 309.5,-41.37"/>
</g>
<!-- sourcefile~core.f90&#45;&gt;sourcefile~electronic.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge21" class="edge">
<title>sourcefile~core.f90&#45;&gt;sourcefile~electronic.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M413.76,-45.82C386.6,-52.76 344.06,-65.04 309.5,-81.37"/>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M307.5,-81.37C283.93,-92.51 272.59,-84.38 252,-100.37 228.93,-118.3 233.84,-132.23 216,-155.37 209.01,-164.44 200.65,-173.93 193.27,-181.91"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="190.61,-179.64 186.31,-189.33 195.71,-184.43 190.61,-179.64"/>
</g>
<!-- sourcefile~core.f90&#45;&gt;sourcefile~dos_utils.f90 -->
<g id="sourcefile~~parameters.f90~~AfferentGraph_edge28" class="edge">
<title>sourcefile~core.f90&#45;&gt;sourcefile~dos_utils.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M415.38,-51.42C410.45,-54.12 405.44,-57.15 401,-60.37 382.93,-73.47 383.36,-82.68 365,-95.37 360.07,-98.78 354.61,-101.95 349.11,-104.82"/>
<polygon fill="#ffff00" stroke="#ffff00" points="347.31,-101.8 339.88,-109.35 350.4,-108.08 347.31,-101.8"/>
</g>
</g>
</svg>
</div><script>var pansourcefileparametersf90AfferentGraph = svgPanZoom('#sourcefileparametersf90AfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193.5,-24 88.5,-24 88.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
<br>
    <section class="visible-xs visible-sm hidden-md">
        <h3>Contents</h3>
  
  
  
  
  
      <div class="panel panel-primary">
      <div class="panel-heading text-left">
        <h3 class="panel-title">
          <a data-toggle="collapse" href="#mods-1">Modules</a>
        </h3>
      </div>
      <div id="mods-1" class="panel-collapse collapse">
        <div class="list-group">
            <a class="list-group-item" href="../module/od_parameters.html">od_parameters</a>
        </div>
      </div>
    </div>

  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="panel panel-primary">
      <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../sourcefile/parameters.f90.html#src">parameters.f90</a>
      </div>
    </div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a id="ln-1" name="ln-1" href="#ln-1"></a><span class="c">!-*- mode: F90; mode: font-lock; column-number-mode: true -*-!</span>
<a id="ln-2" name="ln-2" href="#ln-2"></a><span class="c">!                                                            !</span>
<a id="ln-3" name="ln-3" href="#ln-3"></a><span class="c">! This module contains GPL routines from Wannier90           !</span>
<a id="ln-4" name="ln-4" href="#ln-4"></a><span class="c">! Copyright (C) 2007 Jonathan Yates, Arash Mostofi,          !</span>
<a id="ln-5" name="ln-5" href="#ln-5"></a><span class="c">!  Young-Su Lee, Nicola Marzari, Ivo Souza, David Vanderbilt !</span>
<a id="ln-6" name="ln-6" href="#ln-6"></a><span class="c">!                                                            !</span>
<a id="ln-7" name="ln-7" href="#ln-7"></a><span class="c">! This file is distributed under the terms of the GNU        !</span>
<a id="ln-8" name="ln-8" href="#ln-8"></a><span class="c">! General Public License. See the file &#39;COPYING&#39; in          !</span>
<a id="ln-9" name="ln-9" href="#ln-9"></a><span class="c">! the root directory of the present distribution, or         !</span>
<a id="ln-10" name="ln-10" href="#ln-10"></a><span class="c">! http://www.gnu.org/copyleft/gpl.txt .                      !</span>
<a id="ln-11" name="ln-11" href="#ln-11"></a><span class="c">!                                                            !</span>
<a id="ln-12" name="ln-12" href="#ln-12"></a><span class="c">!------------------------------------------------------------!</span>
<a id="ln-13" name="ln-13" href="#ln-13"></a><span class="c">!</span>
<a id="ln-14" name="ln-14" href="#ln-14"></a><span class="c">! This file is part of OptaDOS</span>
<a id="ln-15" name="ln-15" href="#ln-15"></a><span class="c">!</span>
<a id="ln-16" name="ln-16" href="#ln-16"></a><span class="c">! OptaDOS - For obtaining electronic structure properties based on</span>
<a id="ln-17" name="ln-17" href="#ln-17"></a><span class="c">!             integrations over the Brillouin zone</span>
<a id="ln-18" name="ln-18" href="#ln-18"></a><span class="c">! Copyright (C) 2011  Andrew J. Morris,  R. J. Nicholls, C. J. Pickard</span>
<a id="ln-19" name="ln-19" href="#ln-19"></a><span class="c">!                         and J. R. Yates</span>
<a id="ln-20" name="ln-20" href="#ln-20"></a><span class="c">!</span>
<a id="ln-21" name="ln-21" href="#ln-21"></a><span class="c">! This program is free software: you can redistribute it and/or modify</span>
<a id="ln-22" name="ln-22" href="#ln-22"></a><span class="c">! it under the terms of the GNU General Public License as published by</span>
<a id="ln-23" name="ln-23" href="#ln-23"></a><span class="c">! the Free Software Foundation, either version 3 of the License, or</span>
<a id="ln-24" name="ln-24" href="#ln-24"></a><span class="c">! (at your option) any later version.</span>
<a id="ln-25" name="ln-25" href="#ln-25"></a><span class="c">!</span>
<a id="ln-26" name="ln-26" href="#ln-26"></a><span class="c">! This program is distributed in the hope that it will be useful,</span>
<a id="ln-27" name="ln-27" href="#ln-27"></a><span class="c">! but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a id="ln-28" name="ln-28" href="#ln-28"></a><span class="c">! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a id="ln-29" name="ln-29" href="#ln-29"></a><span class="c">! GNU General Public License for more details.</span>
<a id="ln-30" name="ln-30" href="#ln-30"></a><span class="c">!</span>
<a id="ln-31" name="ln-31" href="#ln-31"></a><span class="c">! You should have received a copy of the GNU General Public License</span>
<a id="ln-32" name="ln-32" href="#ln-32"></a><span class="c">! along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a id="ln-33" name="ln-33" href="#ln-33"></a><span class="c">!</span>
<a id="ln-34" name="ln-34" href="#ln-34"></a>
<a id="ln-35" name="ln-35" href="#ln-35"></a><span class="k">module </span><span class="n">od_parameters</span><span class="w"></span>
<a id="ln-36" name="ln-36" href="#ln-36"></a>
<a id="ln-37" name="ln-37" href="#ln-37"></a><span class="w">  </span><span class="k">use </span><span class="n">od_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">dp</span><span class="w"></span>
<a id="ln-38" name="ln-38" href="#ln-38"></a><span class="w">  </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="n">maxlen</span><span class="w"></span>
<a id="ln-39" name="ln-39" href="#ln-39"></a><span class="w">  </span><span class="k">use </span><span class="n">od_cell</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">atoms_label</span><span class="p">,</span><span class="w"> </span><span class="n">num_atoms</span><span class="p">,</span><span class="w"> </span><span class="n">num_species</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_symbol</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-40" name="ln-40" href="#ln-40"></a><span class="w">       </span><span class="p">&amp;</span><span class="w"> </span><span class="n">atoms_species_num</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_pos_frac</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_pos_cart</span><span class="p">,</span><span class="w"> </span><span class="n">num_crystal_symmetry_operations</span><span class="w"></span>
<a id="ln-41" name="ln-41" href="#ln-41"></a>
<a id="ln-42" name="ln-42" href="#ln-42"></a><span class="w">  </span><span class="k">implicit none</span><span class="w"></span>
<a id="ln-43" name="ln-43" href="#ln-43"></a>
<a id="ln-44" name="ln-44" href="#ln-44"></a><span class="w">  </span><span class="c">!Generic Parameters</span>
<a id="ln-45" name="ln-45" href="#ln-45"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">output_format</span><span class="w"></span>
<a id="ln-46" name="ln-46" href="#ln-46"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">devel_flag</span><span class="w"></span>
<a id="ln-47" name="ln-47" href="#ln-47"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iprint</span><span class="w"></span>
<a id="ln-48" name="ln-48" href="#ln-48"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">energy_unit</span><span class="w"></span>
<a id="ln-49" name="ln-49" href="#ln-49"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">length_unit</span><span class="w"> </span><span class="c">! not exposed - but useful for BZ plots?</span>
<a id="ln-50" name="ln-50" href="#ln-50"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">legacy_file_format</span><span class="w"></span>
<a id="ln-51" name="ln-51" href="#ln-51"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">kpoint_mp_grid</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-52" name="ln-52" href="#ln-52"></a>
<a id="ln-53" name="ln-53" href="#ln-53"></a><span class="w">  </span><span class="c">!Task parameters</span>
<a id="ln-54" name="ln-54" href="#ln-54"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dos</span><span class="w"></span>
<a id="ln-55" name="ln-55" href="#ln-55"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">compare_dos</span><span class="w"></span>
<a id="ln-56" name="ln-56" href="#ln-56"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pdos</span><span class="w"></span>
<a id="ln-57" name="ln-57" href="#ln-57"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">pdis</span><span class="w"></span>
<a id="ln-58" name="ln-58" href="#ln-58"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jdos</span><span class="w"></span>
<a id="ln-59" name="ln-59" href="#ln-59"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">compare_jdos</span><span class="w"></span>
<a id="ln-60" name="ln-60" href="#ln-60"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics</span><span class="w"></span>
<a id="ln-61" name="ln-61" href="#ln-61"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">core</span><span class="w"></span>
<a id="ln-62" name="ln-62" href="#ln-62"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo</span><span class="w"></span>
<a id="ln-63" name="ln-63" href="#ln-63"></a>
<a id="ln-64" name="ln-64" href="#ln-64"></a><span class="w">  </span><span class="c">!Broadening parameters</span>
<a id="ln-65" name="ln-65" href="#ln-65"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fixed</span><span class="w"></span>
<a id="ln-66" name="ln-66" href="#ln-66"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">adaptive</span><span class="w"></span>
<a id="ln-67" name="ln-67" href="#ln-67"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">linear</span><span class="w"></span>
<a id="ln-68" name="ln-68" href="#ln-68"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">quad</span><span class="w"></span>
<a id="ln-69" name="ln-69" href="#ln-69"></a>
<a id="ln-70" name="ln-70" href="#ln-70"></a><span class="w">  </span><span class="c">! Belonging to the dos module</span>
<a id="ln-71" name="ln-71" href="#ln-71"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">compute_band_energy</span><span class="w"></span>
<a id="ln-72" name="ln-72" href="#ln-72"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">adaptive_smearing</span><span class="w"></span>
<a id="ln-73" name="ln-73" href="#ln-73"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fixed_smearing</span><span class="w"></span>
<a id="ln-74" name="ln-74" href="#ln-74"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">linear_smearing</span><span class="w"></span>
<a id="ln-75" name="ln-75" href="#ln-75"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dos_per_volume</span><span class="w"></span>
<a id="ln-76" name="ln-76" href="#ln-76"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">efermi_user</span><span class="w">     </span><span class="c">! If the user has set efermi in the odi file</span>
<a id="ln-77" name="ln-77" href="#ln-77"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">efermi_choice</span><span class="w">   </span><span class="c">! Where do we want to get the fermi energy from</span>
<a id="ln-78" name="ln-78" href="#ln-78"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">finite_bin_correction</span><span class="w"></span>
<a id="ln-79" name="ln-79" href="#ln-79"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">hybrid_linear</span><span class="w"></span>
<a id="ln-80" name="ln-80" href="#ln-80"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">hybrid_linear_grad_tol</span><span class="w"></span>
<a id="ln-81" name="ln-81" href="#ln-81"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">numerical_intdos</span><span class="w"></span>
<a id="ln-82" name="ln-82" href="#ln-82"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">compute_band_gap</span><span class="w"></span>
<a id="ln-83" name="ln-83" href="#ln-83"></a>
<a id="ln-84" name="ln-84" href="#ln-84"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">set_efermi_zero</span><span class="w">  </span><span class="c">! Set fermi level to zero in dos plot default true</span>
<a id="ln-85" name="ln-85" href="#ln-85"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dos_min_energy</span><span class="w"></span>
<a id="ln-86" name="ln-86" href="#ln-86"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dos_max_energy</span><span class="w"></span>
<a id="ln-87" name="ln-87" href="#ln-87"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dos_spacing</span><span class="w"></span>
<a id="ln-88" name="ln-88" href="#ln-88"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dos_nbins</span><span class="w"></span>
<a id="ln-89" name="ln-89" href="#ln-89"></a>
<a id="ln-90" name="ln-90" href="#ln-90"></a><span class="w">  </span><span class="c">! pdos &amp; pdis</span>
<a id="ln-91" name="ln-91" href="#ln-91"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">projectors_string</span><span class="w"></span>
<a id="ln-92" name="ln-92" href="#ln-92"></a>
<a id="ln-93" name="ln-93" href="#ln-93"></a><span class="w">  </span><span class="c">! Belonging to the jdos module</span>
<a id="ln-94" name="ln-94" href="#ln-94"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jdos_max_energy</span><span class="w"></span>
<a id="ln-95" name="ln-95" href="#ln-95"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jdos_spacing</span><span class="w"></span>
<a id="ln-96" name="ln-96" href="#ln-96"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">scissor_op</span><span class="w"></span>
<a id="ln-97" name="ln-97" href="#ln-97"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">exclude_bands</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-98" name="ln-98" href="#ln-98"></a>
<a id="ln-99" name="ln-99" href="#ln-99"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">num_exclude_bands</span><span class="w">    </span><span class="c">! this is set by param_write</span>
<a id="ln-100" name="ln-100" href="#ln-100"></a>
<a id="ln-101" name="ln-101" href="#ln-101"></a><span class="w">  </span><span class="c">! Optics parameters</span>
<a id="ln-102" name="ln-102" href="#ln-102"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics_geom</span><span class="w"></span>
<a id="ln-103" name="ln-103" href="#ln-103"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics_qdir</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-104" name="ln-104" href="#ln-104"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics_intraband</span><span class="w"></span>
<a id="ln-105" name="ln-105" href="#ln-105"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics_drude_broadening</span><span class="w"></span>
<a id="ln-106" name="ln-106" href="#ln-106"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics_lossfn_gaussian</span><span class="w"></span>
<a id="ln-107" name="ln-107" href="#ln-107"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">optics_lossfn_broadening</span><span class="w"> </span><span class="c">! the is set by param_write</span>
<a id="ln-108" name="ln-108" href="#ln-108"></a>
<a id="ln-109" name="ln-109" href="#ln-109"></a><span class="w">  </span><span class="c">! Core parameters</span>
<a id="ln-110" name="ln-110" href="#ln-110"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">core_geom</span><span class="w"></span>
<a id="ln-111" name="ln-111" href="#ln-111"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">core_qdir</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-112" name="ln-112" href="#ln-112"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">core_LAI_broadening</span><span class="w"></span>
<a id="ln-113" name="ln-113" href="#ln-113"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">core_type</span><span class="w"></span>
<a id="ln-114" name="ln-114" href="#ln-114"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LAI_gaussian_width</span><span class="w"></span>
<a id="ln-115" name="ln-115" href="#ln-115"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LAI_gaussian</span><span class="w"></span>
<a id="ln-116" name="ln-116" href="#ln-116"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LAI_lorentzian_width</span><span class="w"></span>
<a id="ln-117" name="ln-117" href="#ln-117"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LAI_lorentzian_scale</span><span class="w"></span>
<a id="ln-118" name="ln-118" href="#ln-118"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LAI_lorentzian_offset</span><span class="w"></span>
<a id="ln-119" name="ln-119" href="#ln-119"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">LAI_lorentzian</span><span class="w"></span>
<a id="ln-120" name="ln-120" href="#ln-120"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">core_chemical_shift</span><span class="w"> </span><span class="c">! used in conjunction with miz_chemical_shift script in tools</span>
<a id="ln-121" name="ln-121" href="#ln-121"></a>
<a id="ln-122" name="ln-122" href="#ln-122"></a><span class="w">  </span><span class="c">! Photoemission parameters - V.Chang, et al. Dec-2022</span>
<a id="ln-123" name="ln-123" href="#ln-123"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_model</span><span class="w"></span>
<a id="ln-124" name="ln-124" href="#ln-124"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">write_photo_output</span><span class="w"></span>
<a id="ln-125" name="ln-125" href="#ln-125"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_momentum</span><span class="w"></span>
<a id="ln-126" name="ln-126" href="#ln-126"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_layer_choice</span><span class="w"></span>
<a id="ln-127" name="ln-127" href="#ln-127"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_max_layer</span><span class="w"></span>
<a id="ln-128" name="ln-128" href="#ln-128"></a><span class="w">  </span><span class="c">!logical,           public, save :: angle_resolution</span>
<a id="ln-129" name="ln-129" href="#ln-129"></a><span class="w">  </span><span class="c">!character(len=20), public, save :: resolution_type</span>
<a id="ln-130" name="ln-130" href="#ln-130"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_phi_lower</span><span class="w"></span>
<a id="ln-131" name="ln-131" href="#ln-131"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_phi_upper</span><span class="w"></span>
<a id="ln-132" name="ln-132" href="#ln-132"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_theta_lower</span><span class="w"></span>
<a id="ln-133" name="ln-133" href="#ln-133"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_theta_upper</span><span class="w"></span>
<a id="ln-134" name="ln-134" href="#ln-134"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_photon_energy</span><span class="w"></span>
<a id="ln-135" name="ln-135" href="#ln-135"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_photon_sweep</span><span class="w"></span>
<a id="ln-136" name="ln-136" href="#ln-136"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_photon_min</span><span class="w"></span>
<a id="ln-137" name="ln-137" href="#ln-137"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_photon_max</span><span class="w"></span>
<a id="ln-138" name="ln-138" href="#ln-138"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_bulk_cutoff</span><span class="w"></span>
<a id="ln-139" name="ln-139" href="#ln-139"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_temperature</span><span class="w"></span>
<a id="ln-140" name="ln-140" href="#ln-140"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_elec_field</span><span class="w"></span>
<a id="ln-141" name="ln-141" href="#ln-141"></a><span class="w">  </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_len_imfp_const</span><span class="w"></span>
<a id="ln-142" name="ln-142" href="#ln-142"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_imfp_const</span><span class="w"></span>
<a id="ln-143" name="ln-143" href="#ln-143"></a><span class="w">  </span><span class="c">! real(kind=dp), dimension(:), allocatable, public, save :: photo_imfp_list</span>
<a id="ln-144" name="ln-144" href="#ln-144"></a><span class="w">  </span><span class="c">! logical, public, save :: photo_e_units</span>
<a id="ln-145" name="ln-145" href="#ln-145"></a><span class="w">  </span><span class="c">! logical, public, save :: photo_mte</span>
<a id="ln-146" name="ln-146" href="#ln-146"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_work_function</span><span class="w"></span>
<a id="ln-147" name="ln-147" href="#ln-147"></a><span class="w">  </span><span class="c">! real(kind=dp), public, save :: photo_surface_area</span>
<a id="ln-148" name="ln-148" href="#ln-148"></a><span class="w">  </span><span class="c">! real(kind=dp), public, save :: photo_slab_volume</span>
<a id="ln-149" name="ln-149" href="#ln-149"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_slab_min</span><span class="w"></span>
<a id="ln-150" name="ln-150" href="#ln-150"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_slab_max</span><span class="w"></span>
<a id="ln-151" name="ln-151" href="#ln-151"></a><span class="w">  </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">photo_remove_box_states</span><span class="w"></span>
<a id="ln-152" name="ln-152" href="#ln-152"></a>
<a id="ln-153" name="ln-153" href="#ln-153"></a><span class="w">  </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">public</span><span class="p">,</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lenconfac</span><span class="w"></span>
<a id="ln-154" name="ln-154" href="#ln-154"></a>
<a id="ln-155" name="ln-155" href="#ln-155"></a><span class="w">  </span><span class="k">private</span>
<a id="ln-156" name="ln-156" href="#ln-156"></a>
<a id="ln-157" name="ln-157" href="#ln-157"></a><span class="k">  </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-158" name="ln-158" href="#ln-158"></a><span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">in_data</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-159" name="ln-159" href="#ln-159"></a>
<a id="ln-160" name="ln-160" href="#ln-160"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">param_read</span><span class="w"></span>
<a id="ln-161" name="ln-161" href="#ln-161"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">param_write</span><span class="w"></span>
<a id="ln-162" name="ln-162" href="#ln-162"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">param_write_header</span><span class="w"></span>
<a id="ln-163" name="ln-163" href="#ln-163"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">param_write_atomic_coord</span><span class="w"></span>
<a id="ln-164" name="ln-164" href="#ln-164"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">param_dealloc</span><span class="w"></span>
<a id="ln-165" name="ln-165" href="#ln-165"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">param_dist</span><span class="w"></span>
<a id="ln-166" name="ln-166" href="#ln-166"></a>
<a id="ln-167" name="ln-167" href="#ln-167"></a><span class="k">contains</span><span class="w"></span>
<a id="ln-168" name="ln-168" href="#ln-168"></a>
<a id="ln-169" name="ln-169" href="#ln-169"></a><span class="w">  </span><span class="c">!==================================================================!</span>
<a id="ln-170" name="ln-170" href="#ln-170"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_read</span><span class="p">()</span><span class="w"></span>
<a id="ln-171" name="ln-171" href="#ln-171"></a><span class="w">    </span><span class="c">!==================================================================!</span>
<a id="ln-172" name="ln-172" href="#ln-172"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-173" name="ln-173" href="#ln-173"></a><span class="w">    </span><span class="c">! Read parameters and calculate derived values                     !</span>
<a id="ln-174" name="ln-174" href="#ln-174"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-175" name="ln-175" href="#ln-175"></a><span class="w">    </span><span class="c">!===================================================================</span>
<a id="ln-176" name="ln-176" href="#ln-176"></a>
<a id="ln-177" name="ln-177" href="#ln-177"></a><span class="w">    </span><span class="k">use </span><span class="n">od_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">bohr2ang</span><span class="w"></span>
<a id="ln-178" name="ln-178" href="#ln-178"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="p">,</span><span class="w"> </span><span class="n">seedname</span><span class="p">,</span><span class="w"> </span><span class="n">stderr</span><span class="w"></span>
<a id="ln-179" name="ln-179" href="#ln-179"></a><span class="w">    </span><span class="k">use </span><span class="n">od_cell</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">cell_get_atoms</span><span class="p">,</span><span class="w"> </span><span class="n">cell_read_cell</span><span class="w"></span>
<a id="ln-180" name="ln-180" href="#ln-180"></a>
<a id="ln-181" name="ln-181" href="#ln-181"></a><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<a id="ln-182" name="ln-182" href="#ln-182"></a>
<a id="ln-183" name="ln-183" href="#ln-183"></a><span class="w">    </span><span class="c">!local variables</span>
<a id="ln-184" name="ln-184" href="#ln-184"></a><span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i_temp</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<a id="ln-185" name="ln-185" href="#ln-185"></a><span class="w">    </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-186" name="ln-186" href="#ln-186"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">task_string</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-187" name="ln-187" href="#ln-187"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_string</span><span class="w"></span>
<a id="ln-188" name="ln-188" href="#ln-188"></a>
<a id="ln-189" name="ln-189" href="#ln-189"></a><span class="w">    </span><span class="k">call </span><span class="n">param_in_file</span><span class="w"></span>
<a id="ln-190" name="ln-190" href="#ln-190"></a>
<a id="ln-191" name="ln-191" href="#ln-191"></a><span class="w">    </span><span class="n">iprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">             </span><span class="c">! Verbosity</span>
<a id="ln-192" name="ln-192" href="#ln-192"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;iprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="o">=</span><span class="n">iprint</span><span class="p">)</span><span class="w"></span>
<a id="ln-193" name="ln-193" href="#ln-193"></a>
<a id="ln-194" name="ln-194" href="#ln-194"></a><span class="w">    </span><span class="n">legacy_file_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-195" name="ln-195" href="#ln-195"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;legacy_file_format&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">legacy_file_format</span><span class="p">)</span><span class="w"></span>
<a id="ln-196" name="ln-196" href="#ln-196"></a>
<a id="ln-197" name="ln-197" href="#ln-197"></a><span class="w">    </span><span class="n">energy_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ev&#39;</span><span class="w">          </span><span class="c">!</span>
<a id="ln-198" name="ln-198" href="#ln-198"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;energy_unit&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">energy_unit</span><span class="p">)</span><span class="w"></span>
<a id="ln-199" name="ln-199" href="#ln-199"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">energy_unit</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ev&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">energy_unit</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ry&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">energy_unit</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ha&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-200" name="ln-200" href="#ln-200"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of energy_unit not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-201" name="ln-201" href="#ln-201"></a>
<a id="ln-202" name="ln-202" href="#ln-202"></a><span class="w">    </span><span class="n">dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">pdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">pdis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">optics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-203" name="ln-203" href="#ln-203"></a><span class="w">    </span><span class="n">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">compare_dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">compare_jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">photo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">photo_photon_sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-204" name="ln-204" href="#ln-204"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_vector_length</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_temp</span><span class="p">)</span><span class="w"></span>
<a id="ln-205" name="ln-205" href="#ln-205"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">i_temp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-206" name="ln-206" href="#ln-206"></a><span class="k">      allocate</span><span class="w"> </span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">i_temp</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-207" name="ln-207" href="#ln-207"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: param_read - allocation failed for task_string&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-208" name="ln-208" href="#ln-208"></a><span class="w">      </span><span class="k">call </span><span class="n">param_get_keyword_vector</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_temp</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">task_string</span><span class="p">)</span><span class="w"></span>
<a id="ln-209" name="ln-209" href="#ln-209"></a><span class="w">      </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i_temp</span><span class="w"></span>
<a id="ln-210" name="ln-210" href="#ln-210"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;optics&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-211" name="ln-211" href="#ln-211"></a><span class="k">          </span><span class="n">optics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-212" name="ln-212" href="#ln-212"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;core&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-213" name="ln-213" href="#ln-213"></a><span class="k">          </span><span class="n">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-214" name="ln-214" href="#ln-214"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;compare_jdos&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-215" name="ln-215" href="#ln-215"></a><span class="k">          </span><span class="n">jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">compare_jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-216" name="ln-216" href="#ln-216"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;jdos&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-217" name="ln-217" href="#ln-217"></a><span class="k">          </span><span class="n">jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-218" name="ln-218" href="#ln-218"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;pdos&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-219" name="ln-219" href="#ln-219"></a><span class="k">          </span><span class="n">pdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-220" name="ln-220" href="#ln-220"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;pdispersion&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-221" name="ln-221" href="#ln-221"></a><span class="k">          </span><span class="n">pdis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-222" name="ln-222" href="#ln-222"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;compare_dos&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-223" name="ln-223" href="#ln-223"></a><span class="k">          </span><span class="n">dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">compare_dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-224" name="ln-224" href="#ln-224"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;dos&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-225" name="ln-225" href="#ln-225"></a><span class="k">          </span><span class="n">dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-226" name="ln-226" href="#ln-226"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;photoemission&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-227" name="ln-227" href="#ln-227"></a><span class="k">          </span><span class="n">photo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-228" name="ln-228" href="#ln-228"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;photon_sweep&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-229" name="ln-229" href="#ln-229"></a><span class="k">          </span><span class="n">photo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">photo_photon_sweep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-230" name="ln-230" href="#ln-230"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-231" name="ln-231" href="#ln-231"></a><span class="k">          </span><span class="n">dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">pdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">optics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-232" name="ln-232" href="#ln-232"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">task_string</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-233" name="ln-233" href="#ln-233"></a><span class="k">          </span><span class="n">dos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">pdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">jdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">optics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-234" name="ln-234" href="#ln-234"></a><span class="w">        </span><span class="k">else</span>
<a id="ln-235" name="ln-235" href="#ln-235"></a><span class="k">          call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of task unrecognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-236" name="ln-236" href="#ln-236"></a><span class="w">        </span><span class="k">end if</span>
<a id="ln-237" name="ln-237" href="#ln-237"></a><span class="k">      end do</span>
<a id="ln-238" name="ln-238" href="#ln-238"></a><span class="k">      deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">task_string</span><span class="p">,</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-239" name="ln-239" href="#ln-239"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: param_read - deallocation failed for task_string&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-240" name="ln-240" href="#ln-240"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-241" name="ln-241" href="#ln-241"></a><span class="k">    if</span><span class="w"> </span><span class="p">((</span><span class="n">compare_dos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">compare_jdos</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">pdos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">optics</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">photo</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-242" name="ln-242" href="#ln-242"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: compare_dos/compare_jdos are not comptable with pdos, core, optics or photoemission tasks&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-243" name="ln-243" href="#ln-243"></a>
<a id="ln-244" name="ln-244" href="#ln-244"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdis</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">optics</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">jdos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">pdos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">compare_dos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">compare_jdos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">photo</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-245" name="ln-245" href="#ln-245"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: projected bandstructure not compatible with any other tasks&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-246" name="ln-246" href="#ln-246"></a>
<a id="ln-247" name="ln-247" href="#ln-247"></a><span class="w">    </span><span class="n">i_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-248" name="ln-248" href="#ln-248"></a><span class="w">    </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">adaptive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.;</span><span class="w"> </span><span class="n">quad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-249" name="ln-249" href="#ln-249"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;broadening&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">c_string</span><span class="p">)</span><span class="w"></span>
<a id="ln-250" name="ln-250" href="#ln-250"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-251" name="ln-251" href="#ln-251"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">c_string</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;fixed&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-252" name="ln-252" href="#ln-252"></a><span class="k">        </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-253" name="ln-253" href="#ln-253"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">c_string</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;adaptive&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-254" name="ln-254" href="#ln-254"></a><span class="k">        </span><span class="n">adaptive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-255" name="ln-255" href="#ln-255"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">c_string</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;linear&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-256" name="ln-256" href="#ln-256"></a><span class="k">        </span><span class="n">linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-257" name="ln-257" href="#ln-257"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">c_string</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;quad&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-258" name="ln-258" href="#ln-258"></a><span class="k">        </span><span class="n">quad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-259" name="ln-259" href="#ln-259"></a><span class="w">        </span><span class="c">!          fixed=.true.;adaptive=.true.;linear=.true.</span>
<a id="ln-260" name="ln-260" href="#ln-260"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-261" name="ln-261" href="#ln-261"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of broadening unrecognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-262" name="ln-262" href="#ln-262"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-263" name="ln-263" href="#ln-263"></a><span class="k">    end if</span>
<a id="ln-264" name="ln-264" href="#ln-264"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">compare_dos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">compare_jdos</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-265" name="ln-265" href="#ln-265"></a><span class="k">      </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">adaptive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.;</span><span class="w"> </span><span class="n">linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-266" name="ln-266" href="#ln-266"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-267" name="ln-267" href="#ln-267"></a>
<a id="ln-268" name="ln-268" href="#ln-268"></a><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">pdis</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">fixed</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">adaptive</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">linear</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">quad</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! Pick a default</span>
<a id="ln-269" name="ln-269" href="#ln-269"></a><span class="w">      </span><span class="n">adaptive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-270" name="ln-270" href="#ln-270"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-271" name="ln-271" href="#ln-271"></a>
<a id="ln-272" name="ln-272" href="#ln-272"></a><span class="k">    </span><span class="n">kpoint_mp_grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">999</span><span class="w"></span>
<a id="ln-273" name="ln-273" href="#ln-273"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword_vector</span><span class="p">(</span><span class="s1">&#39;kpoint_mp_grid&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="o">=</span><span class="n">kpoint_mp_grid</span><span class="p">)</span><span class="w"></span>
<a id="ln-274" name="ln-274" href="#ln-274"></a>
<a id="ln-275" name="ln-275" href="#ln-275"></a><span class="w">    </span><span class="n">length_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ang&#39;</span><span class="w">         </span><span class="c">!</span>
<a id="ln-276" name="ln-276" href="#ln-276"></a><span class="w">    </span><span class="n">lenconfac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_dp</span><span class="w"></span>
<a id="ln-277" name="ln-277" href="#ln-277"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;length_unit&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">length_unit</span><span class="p">)</span><span class="w"></span>
<a id="ln-278" name="ln-278" href="#ln-278"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length_unit</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;ang&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">length_unit</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;bohr&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-279" name="ln-279" href="#ln-279"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of length_unit not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-280" name="ln-280" href="#ln-280"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">length_unit</span><span class="w"> </span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;bohr&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">lenconfac</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0_dp</span><span class="o">/</span><span class="n">bohr2ang</span><span class="w"></span>
<a id="ln-281" name="ln-281" href="#ln-281"></a>
<a id="ln-282" name="ln-282" href="#ln-282"></a><span class="w">    </span><span class="n">adaptive_smearing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.4_dp</span><span class="w"> </span><span class="c">! LinDOS default</span>
<a id="ln-283" name="ln-283" href="#ln-283"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;adaptive_smearing&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">adaptive_smearing</span><span class="p">)</span><span class="w"></span>
<a id="ln-284" name="ln-284" href="#ln-284"></a>
<a id="ln-285" name="ln-285" href="#ln-285"></a><span class="w">    </span><span class="n">fixed_smearing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.3_dp</span><span class="w"> </span><span class="c">! LinDOS default</span>
<a id="ln-286" name="ln-286" href="#ln-286"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;fixed_smearing&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">fixed_smearing</span><span class="p">)</span><span class="w"></span>
<a id="ln-287" name="ln-287" href="#ln-287"></a>
<a id="ln-288" name="ln-288" href="#ln-288"></a><span class="w">    </span><span class="n">linear_smearing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-289" name="ln-289" href="#ln-289"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;linear_smearing&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">linear_smearing</span><span class="p">)</span><span class="w"></span>
<a id="ln-290" name="ln-290" href="#ln-290"></a>
<a id="ln-291" name="ln-291" href="#ln-291"></a><span class="w">    </span><span class="n">efermi_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">99</span><span class="mf">9.0_dp</span><span class="w"></span>
<a id="ln-292" name="ln-292" href="#ln-292"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">pdis</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-293" name="ln-293" href="#ln-293"></a><span class="k">      </span><span class="n">efermi_choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;optados&quot;</span><span class="w"></span>
<a id="ln-294" name="ln-294" href="#ln-294"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-295" name="ln-295" href="#ln-295"></a><span class="k">      </span><span class="n">efermi_choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;file&quot;</span><span class="w"></span>
<a id="ln-296" name="ln-296" href="#ln-296"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-297" name="ln-297" href="#ln-297"></a><span class="k">    call </span><span class="n">param_get_efermi</span><span class="p">(</span><span class="s1">&#39;efermi&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">efermi_choice</span><span class="p">,</span><span class="w"> </span><span class="n">efermi_user</span><span class="p">)</span><span class="w"></span>
<a id="ln-298" name="ln-298" href="#ln-298"></a>
<a id="ln-299" name="ln-299" href="#ln-299"></a><span class="w">    </span><span class="n">compute_band_energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-300" name="ln-300" href="#ln-300"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;compute_band_energy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">compute_band_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-301" name="ln-301" href="#ln-301"></a>
<a id="ln-302" name="ln-302" href="#ln-302"></a><span class="w">    </span><span class="c">! Here we apply a chemical shift to the core energy if supplied by the user</span>
<a id="ln-303" name="ln-303" href="#ln-303"></a><span class="w">    </span><span class="n">core_chemical_shift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0_dp</span><span class="w"> </span><span class="c">! Mizoguchi chemical shift is always +ve</span>
<a id="ln-304" name="ln-304" href="#ln-304"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;core_chemical_shift&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">core_chemical_shift</span><span class="p">)</span><span class="w"></span>
<a id="ln-305" name="ln-305" href="#ln-305"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">core_chemical_shift</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="n">compute_band_gap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-306" name="ln-306" href="#ln-306"></a>
<a id="ln-307" name="ln-307" href="#ln-307"></a><span class="w">    </span><span class="c">! Force all Gaussians to be greater than the width of a bin. When using numerical_indos</span>
<a id="ln-308" name="ln-308" href="#ln-308"></a><span class="w">    </span><span class="c">! this is critical for counting all of the Gaussian DOS peaks.</span>
<a id="ln-309" name="ln-309" href="#ln-309"></a><span class="w">    </span><span class="c">! When using semi-analytic integration it is desirable to show up very sharp peaks in the</span>
<a id="ln-310" name="ln-310" href="#ln-310"></a><span class="w">    </span><span class="c">! DOS. However, the intDOS will not be affected.</span>
<a id="ln-311" name="ln-311" href="#ln-311"></a><span class="w">    </span><span class="n">finite_bin_correction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-312" name="ln-312" href="#ln-312"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;finite_bin_correction&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">finite_bin_correction</span><span class="p">)</span><span class="w"></span>
<a id="ln-313" name="ln-313" href="#ln-313"></a>
<a id="ln-314" name="ln-314" href="#ln-314"></a><span class="w">    </span><span class="c">! Perform fixed and adaptive smearing summing the contribution of each Gaussian</span>
<a id="ln-315" name="ln-315" href="#ln-315"></a><span class="w">    </span><span class="c">! instead of the new and better way of taking the erf. Left in for comparison to LinDOS</span>
<a id="ln-316" name="ln-316" href="#ln-316"></a><span class="w">    </span><span class="n">numerical_intdos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-317" name="ln-317" href="#ln-317"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;numerical_intdos&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">numerical_intdos</span><span class="p">)</span><span class="w"></span>
<a id="ln-318" name="ln-318" href="#ln-318"></a>
<a id="ln-319" name="ln-319" href="#ln-319"></a><span class="w">    </span><span class="c">! Whenever very flat features are found when performing linear broadening, revert to adaptive.</span>
<a id="ln-320" name="ln-320" href="#ln-320"></a><span class="w">    </span><span class="c">! The tolerance is the gradient of the band at the kpoint.</span>
<a id="ln-321" name="ln-321" href="#ln-321"></a><span class="w">    </span><span class="c">! N.B. Finite_bin_correction may also be set, to further improve the spectra.</span>
<a id="ln-322" name="ln-322" href="#ln-322"></a><span class="w">    </span><span class="n">hybrid_linear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-323" name="ln-323" href="#ln-323"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;hybrid_linear&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">hybrid_linear</span><span class="p">)</span><span class="w"></span>
<a id="ln-324" name="ln-324" href="#ln-324"></a><span class="w">    </span><span class="n">hybrid_linear_grad_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01_dp</span><span class="w"> </span><span class="c">! Seems about right for getting semi-core states correctly integrated.</span>
<a id="ln-325" name="ln-325" href="#ln-325"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;hybrid_linear_grad_tol&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">hybrid_linear_grad_tol</span><span class="p">)</span><span class="w"></span>
<a id="ln-326" name="ln-326" href="#ln-326"></a>
<a id="ln-327" name="ln-327" href="#ln-327"></a><span class="w">    </span><span class="n">set_efermi_zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-328" name="ln-328" href="#ln-328"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdis</span><span class="p">)</span><span class="w"> </span><span class="n">set_efermi_zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-329" name="ln-329" href="#ln-329"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;set_efermi_zero&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">set_efermi_zero</span><span class="p">)</span><span class="w"></span>
<a id="ln-330" name="ln-330" href="#ln-330"></a>
<a id="ln-331" name="ln-331" href="#ln-331"></a><span class="w">    </span><span class="n">dos_per_volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-332" name="ln-332" href="#ln-332"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;dos_per_volume&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">dos_per_volume</span><span class="p">)</span><span class="w"></span>
<a id="ln-333" name="ln-333" href="#ln-333"></a>
<a id="ln-334" name="ln-334" href="#ln-334"></a><span class="w">    </span><span class="n">dos_min_energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nb">huge</span><span class="p">(</span><span class="n">dos_min_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-335" name="ln-335" href="#ln-335"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;dos_min_energy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">dos_min_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-336" name="ln-336" href="#ln-336"></a>
<a id="ln-337" name="ln-337" href="#ln-337"></a><span class="w">    </span><span class="n">dos_max_energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">huge</span><span class="p">(</span><span class="n">dos_max_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-338" name="ln-338" href="#ln-338"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;dos_max_energy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">dos_max_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-339" name="ln-339" href="#ln-339"></a>
<a id="ln-340" name="ln-340" href="#ln-340"></a><span class="w">    </span><span class="n">dos_spacing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0_dp</span><span class="w"></span>
<a id="ln-341" name="ln-341" href="#ln-341"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;dos_spacing&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">dos_spacing</span><span class="p">)</span><span class="w"></span>
<a id="ln-342" name="ln-342" href="#ln-342"></a>
<a id="ln-343" name="ln-343" href="#ln-343"></a><span class="w">    </span><span class="n">dos_nbins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="c">! 10001 LinDOS default</span>
<a id="ln-344" name="ln-344" href="#ln-344"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;dos_nbins&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="o">=</span><span class="n">dos_nbins</span><span class="p">)</span><span class="w"></span>
<a id="ln-345" name="ln-345" href="#ln-345"></a>
<a id="ln-346" name="ln-346" href="#ln-346"></a><span class="w">    </span><span class="n">projectors_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
<a id="ln-347" name="ln-347" href="#ln-347"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;pdos&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">projectors_string</span><span class="p">)</span><span class="w"></span>
<a id="ln-348" name="ln-348" href="#ln-348"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdos</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">projectors_string</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;pdos requested but pdos is not specified&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-349" name="ln-349" href="#ln-349"></a>
<a id="ln-350" name="ln-350" href="#ln-350"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdis</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;pdispersion&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">projectors_string</span><span class="p">)</span><span class="w"></span>
<a id="ln-351" name="ln-351" href="#ln-351"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdis</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">projectors_string</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-352" name="ln-352" href="#ln-352"></a><span class="w">         </span><span class="p">&amp;</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;pdispersion requested but pdispersion keyword is not specified&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-353" name="ln-353" href="#ln-353"></a>
<a id="ln-354" name="ln-354" href="#ln-354"></a><span class="w">    </span><span class="n">jdos_max_energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0_dp</span><span class="w"> </span><span class="c">!! change</span>
<a id="ln-355" name="ln-355" href="#ln-355"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;jdos_max_energy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">jdos_max_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-356" name="ln-356" href="#ln-356"></a>
<a id="ln-357" name="ln-357" href="#ln-357"></a><span class="w">    </span><span class="n">jdos_spacing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01_dp</span><span class="w"> </span><span class="c">!! change</span>
<a id="ln-358" name="ln-358" href="#ln-358"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;jdos_spacing&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">jdos_spacing</span><span class="p">)</span><span class="w"></span>
<a id="ln-359" name="ln-359" href="#ln-359"></a>
<a id="ln-360" name="ln-360" href="#ln-360"></a><span class="w">    </span><span class="n">num_exclude_bands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-361" name="ln-361" href="#ln-361"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_range_vector</span><span class="p">(</span><span class="s1">&#39;exclude_bands&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">num_exclude_bands</span><span class="p">,</span><span class="w"> </span><span class="n">lcount</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span><span class="w"></span>
<a id="ln-362" name="ln-362" href="#ln-362"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-363" name="ln-363" href="#ln-363"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">num_exclude_bands</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: problem reading exclude_bands&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-364" name="ln-364" href="#ln-364"></a><span class="w">      </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">exclude_bands</span><span class="p">(</span><span class="n">num_exclude_bands</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-365" name="ln-365" href="#ln-365"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error allocating exclude_bands in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-366" name="ln-366" href="#ln-366"></a><span class="w">      </span><span class="k">call </span><span class="n">param_get_range_vector</span><span class="p">(</span><span class="s1">&#39;exclude_bands&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">num_exclude_bands</span><span class="p">,</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="w"> </span><span class="n">exclude_bands</span><span class="p">)</span><span class="w"></span>
<a id="ln-367" name="ln-367" href="#ln-367"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">exclude_bands</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-368" name="ln-368" href="#ln-368"></a><span class="w">        </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: exclude_bands must contain positive numbers&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-369" name="ln-369" href="#ln-369"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-370" name="ln-370" href="#ln-370"></a>
<a id="ln-371" name="ln-371" href="#ln-371"></a><span class="k">    </span><span class="n">compute_band_gap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-372" name="ln-372" href="#ln-372"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;compute_band_gap&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">compute_band_gap</span><span class="p">)</span><span class="w"></span>
<a id="ln-373" name="ln-373" href="#ln-373"></a>
<a id="ln-374" name="ln-374" href="#ln-374"></a><span class="w">    </span><span class="n">devel_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-375" name="ln-375" href="#ln-375"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;devel_flag&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">devel_flag</span><span class="p">)</span><span class="w"></span>
<a id="ln-376" name="ln-376" href="#ln-376"></a>
<a id="ln-377" name="ln-377" href="#ln-377"></a><span class="w">    </span><span class="n">output_format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;xmgrace&#39;</span><span class="w"></span>
<a id="ln-378" name="ln-378" href="#ln-378"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;output_format&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">output_format</span><span class="p">)</span><span class="w"></span>
<a id="ln-379" name="ln-379" href="#ln-379"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">output_format</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;xmgrace&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">output_format</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gnuplot&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-380" name="ln-380" href="#ln-380"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of output_format not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-381" name="ln-381" href="#ln-381"></a>
<a id="ln-382" name="ln-382" href="#ln-382"></a><span class="w">    </span><span class="n">optics_geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="w"></span>
<a id="ln-383" name="ln-383" href="#ln-383"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;optics_geom&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">optics_geom</span><span class="p">)</span><span class="w"></span>
<a id="ln-384" name="ln-384" href="#ln-384"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tensor&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-385" name="ln-385" href="#ln-385"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of optics_geom not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-386" name="ln-386" href="#ln-386"></a>
<a id="ln-387" name="ln-387" href="#ln-387"></a><span class="w">    </span><span class="n">scissor_op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"> </span><span class="c">!! change</span>
<a id="ln-388" name="ln-388" href="#ln-388"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;scissor_op&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">scissor_op</span><span class="p">)</span><span class="w"></span>
<a id="ln-389" name="ln-389" href="#ln-389"></a>
<a id="ln-390" name="ln-390" href="#ln-390"></a><span class="w">    </span><span class="n">optics_qdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-391" name="ln-391" href="#ln-391"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword_vector</span><span class="p">(</span><span class="s1">&#39;optics_qdir&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">optics_qdir</span><span class="p">)</span><span class="w"></span>
<a id="ln-392" name="ln-392" href="#ln-392"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-393" name="ln-393" href="#ln-393"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: polarised or unpolarised optics geometry requested but optics_qdir is not set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-394" name="ln-394" href="#ln-394"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tensor&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-395" name="ln-395" href="#ln-395"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: polycrystalline optics geometry or full dielectric tensor requested but optics_qdir is set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-396" name="ln-396" href="#ln-396"></a>
<a id="ln-397" name="ln-397" href="#ln-397"></a><span class="w">    </span><span class="n">optics_intraband</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-398" name="ln-398" href="#ln-398"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;optics_intraband&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">optics_intraband</span><span class="p">)</span><span class="w"></span>
<a id="ln-399" name="ln-399" href="#ln-399"></a>
<a id="ln-400" name="ln-400" href="#ln-400"></a><span class="w">    </span><span class="n">optics_drude_broadening</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0e14_dp</span><span class="w"></span>
<a id="ln-401" name="ln-401" href="#ln-401"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;optics_drude_broadening&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">optics_drude_broadening</span><span class="p">)</span><span class="w"></span>
<a id="ln-402" name="ln-402" href="#ln-402"></a>
<a id="ln-403" name="ln-403" href="#ln-403"></a><span class="w">    </span><span class="n">optics_lossfn_broadening</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-404" name="ln-404" href="#ln-404"></a><span class="w">    </span><span class="n">optics_lossfn_gaussian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-405" name="ln-405" href="#ln-405"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;optics_lossfn_broadening&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">optics_lossfn_broadening</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">optics_lossfn_gaussian</span><span class="p">)</span><span class="w"></span>
<a id="ln-406" name="ln-406" href="#ln-406"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">optics_lossfn_gaussian</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: optics_lossfn_broadening must be positive&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-407" name="ln-407" href="#ln-407"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">optics_lossfn_gaussian</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0e-6_dp</span><span class="p">)</span><span class="w"> </span><span class="n">optics_lossfn_broadening</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"> </span><span class="c">! trap too small values</span>
<a id="ln-408" name="ln-408" href="#ln-408"></a>
<a id="ln-409" name="ln-409" href="#ln-409"></a><span class="w">    </span><span class="n">core_geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="w"></span>
<a id="ln-410" name="ln-410" href="#ln-410"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;core_geom&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">core_geom</span><span class="p">)</span><span class="w"></span>
<a id="ln-411" name="ln-411" href="#ln-411"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="nb">index</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-412" name="ln-412" href="#ln-412"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of core_geom not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-413" name="ln-413" href="#ln-413"></a>
<a id="ln-414" name="ln-414" href="#ln-414"></a><span class="w">    </span><span class="n">core_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;absorption&#39;</span><span class="w"></span>
<a id="ln-415" name="ln-415" href="#ln-415"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;core_type&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">core_type</span><span class="p">)</span><span class="w"></span>
<a id="ln-416" name="ln-416" href="#ln-416"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">core_type</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;absorption&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">core_type</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;emission&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">core_type</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-417" name="ln-417" href="#ln-417"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of core_type not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-418" name="ln-418" href="#ln-418"></a>
<a id="ln-419" name="ln-419" href="#ln-419"></a><span class="w">    </span><span class="n">core_qdir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-420" name="ln-420" href="#ln-420"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword_vector</span><span class="p">(</span><span class="s1">&#39;core_qdir&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">core_qdir</span><span class="p">)</span><span class="w"></span>
<a id="ln-421" name="ln-421" href="#ln-421"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-422" name="ln-422" href="#ln-422"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: polarised core geometry requested but core_qdir is not set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-423" name="ln-423" href="#ln-423"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-424" name="ln-424" href="#ln-424"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: polycrystalline core geometry requested but core_qdir is set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-425" name="ln-425" href="#ln-425"></a>
<a id="ln-426" name="ln-426" href="#ln-426"></a><span class="w">    </span><span class="n">core_LAI_broadening</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-427" name="ln-427" href="#ln-427"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;core_lai_broadening&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">core_LAI_broadening</span><span class="p">)</span><span class="w"></span>
<a id="ln-428" name="ln-428" href="#ln-428"></a>
<a id="ln-429" name="ln-429" href="#ln-429"></a><span class="w">    </span><span class="n">LAI_gaussian_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-430" name="ln-430" href="#ln-430"></a><span class="w">    </span><span class="n">LAI_gaussian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-431" name="ln-431" href="#ln-431"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;lai_gaussian_width&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">LAI_gaussian_width</span><span class="p">)</span><span class="w"></span>
<a id="ln-432" name="ln-432" href="#ln-432"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LAI_gaussian_width</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mf">1E-14</span><span class="p">)</span><span class="w"> </span><span class="n">LAI_gaussian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-433" name="ln-433" href="#ln-433"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LAI_gaussian_width</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: LAI_gaussian_width must be positive&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-434" name="ln-434" href="#ln-434"></a>
<a id="ln-435" name="ln-435" href="#ln-435"></a><span class="w">    </span><span class="n">LAI_lorentzian_width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-436" name="ln-436" href="#ln-436"></a><span class="w">    </span><span class="n">LAI_lorentzian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-437" name="ln-437" href="#ln-437"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;lai_lorentzian_width&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">LAI_lorentzian_width</span><span class="p">)</span><span class="w"></span>
<a id="ln-438" name="ln-438" href="#ln-438"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LAI_lorentzian_width</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mf">1E-14</span><span class="p">)</span><span class="w"> </span><span class="n">LAI_lorentzian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-439" name="ln-439" href="#ln-439"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LAI_lorentzian_width</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: LAI_lorentzian_width must be positive&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-440" name="ln-440" href="#ln-440"></a>
<a id="ln-441" name="ln-441" href="#ln-441"></a><span class="w">    </span><span class="n">LAI_lorentzian_scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1_dp</span><span class="w"></span>
<a id="ln-442" name="ln-442" href="#ln-442"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;lai_lorentzian_scale&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">LAI_lorentzian_scale</span><span class="p">)</span><span class="w"></span>
<a id="ln-443" name="ln-443" href="#ln-443"></a><span class="c">!    if (LAI_lorentzian_scale.gt.1E-14) LAI_lorentzian=.true.</span>
<a id="ln-444" name="ln-444" href="#ln-444"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LAI_lorentzian_scale</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: LAI_lorentzian_scale must be positive&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-445" name="ln-445" href="#ln-445"></a>
<a id="ln-446" name="ln-446" href="#ln-446"></a><span class="w">    </span><span class="n">LAI_lorentzian_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-447" name="ln-447" href="#ln-447"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;lai_lorentzian_offset&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">LAI_lorentzian_offset</span><span class="p">)</span><span class="w"></span>
<a id="ln-448" name="ln-448" href="#ln-448"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">LAI_lorentzian_offset</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: LAI_lorentzian_offset must be positive&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-449" name="ln-449" href="#ln-449"></a>
<a id="ln-450" name="ln-450" href="#ln-450"></a><span class="w">    </span><span class="c">! Photoemission parameters - V.Chang Nov-2020</span>
<a id="ln-451" name="ln-451" href="#ln-451"></a><span class="w">    </span><span class="n">photo_momentum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;crystal&#39;</span><span class="w"></span>
<a id="ln-452" name="ln-452" href="#ln-452"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_momentum&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">photo_momentum</span><span class="p">)</span><span class="w"></span>
<a id="ln-453" name="ln-453" href="#ln-453"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">photo_momentum</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;kp&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_momentum</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;crystal&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_momentum</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;operator&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-454" name="ln-454" href="#ln-454"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of momentum not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-455" name="ln-455" href="#ln-455"></a>
<a id="ln-456" name="ln-456" href="#ln-456"></a><span class="w">    </span><span class="n">write_photo_output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;off&#39;</span><span class="w"></span>
<a id="ln-457" name="ln-457" href="#ln-457"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;write_photo_output&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">write_photo_output</span><span class="p">)</span><span class="w"></span>
<a id="ln-458" name="ln-458" href="#ln-458"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;qe_matrix&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;e_bind&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-459" name="ln-459" href="#ln-459"></a><span class="w">      </span><span class="p">&amp;</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;off&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-460" name="ln-460" href="#ln-460"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of write_photo_output output not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-461" name="ln-461" href="#ln-461"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-462" name="ln-462" href="#ln-462"></a>
<a id="ln-463" name="ln-463" href="#ln-463"></a><span class="k">    </span><span class="n">photo_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1step&#39;</span><span class="w"></span>
<a id="ln-464" name="ln-464" href="#ln-464"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_model&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">photo_model</span><span class="p">)</span><span class="w"></span>
<a id="ln-465" name="ln-465" href="#ln-465"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;3step&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1step&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-466" name="ln-466" href="#ln-466"></a><span class="w">        </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;3step&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ds_like_pe&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-467" name="ln-467" href="#ln-467"></a><span class="w">        </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1step&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ds_like_pe&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-468" name="ln-468" href="#ln-468"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: value of photoemission model not recognised in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-469" name="ln-469" href="#ln-469"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-470" name="ln-470" href="#ln-470"></a>
<a id="ln-471" name="ln-471" href="#ln-471"></a><span class="k">    call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_work_function&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_work_function</span><span class="p">)</span><span class="w"></span>
<a id="ln-472" name="ln-472" href="#ln-472"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-473" name="ln-473" href="#ln-473"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: please set workfunction for photoemission calculation&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-474" name="ln-474" href="#ln-474"></a>
<a id="ln-475" name="ln-475" href="#ln-475"></a><span class="w">    </span><span class="n">photo_theta_lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-476" name="ln-476" href="#ln-476"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_theta_lower&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_theta_lower</span><span class="p">)</span><span class="w"></span>
<a id="ln-477" name="ln-477" href="#ln-477"></a><span class="w">    </span><span class="n">photo_theta_upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-478" name="ln-478" href="#ln-478"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_theta_upper&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_theta_upper</span><span class="p">)</span><span class="w"></span>
<a id="ln-479" name="ln-479" href="#ln-479"></a><span class="w">    </span><span class="n">photo_phi_lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-480" name="ln-480" href="#ln-480"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_phi_lower&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_phi_lower</span><span class="p">)</span><span class="w"></span>
<a id="ln-481" name="ln-481" href="#ln-481"></a><span class="w">    </span><span class="n">photo_phi_upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-482" name="ln-482" href="#ln-482"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_phi_upper&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_phi_upper</span><span class="p">)</span><span class="w"></span>
<a id="ln-483" name="ln-483" href="#ln-483"></a><span class="w">    </span><span class="n">photo_photon_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.0_dp</span><span class="w"></span>
<a id="ln-484" name="ln-484" href="#ln-484"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_photon_min&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_photon_min</span><span class="p">)</span><span class="w"></span>
<a id="ln-485" name="ln-485" href="#ln-485"></a><span class="w">    </span><span class="n">photo_photon_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0_dp</span><span class="w"></span>
<a id="ln-486" name="ln-486" href="#ln-486"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_photon_max&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_photon_max</span><span class="p">)</span><span class="w"></span>
<a id="ln-487" name="ln-487" href="#ln-487"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo_photon_min</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="n">photo_photon_max</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">photo_photon_sweep</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-488" name="ln-488" href="#ln-488"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: max photon value is lower than min photon value or they have not been set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-489" name="ln-489" href="#ln-489"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_photon_energy&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_photon_energy</span><span class="p">)</span><span class="w"></span>
<a id="ln-490" name="ln-490" href="#ln-490"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">photo_photon_sweep</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: cannot set photon energy for photon energy sweep calculation&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-491" name="ln-491" href="#ln-491"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">photo_photon_sweep</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-492" name="ln-492" href="#ln-492"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: please set photon energy for photoemission calculation&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-493" name="ln-493" href="#ln-493"></a><span class="w">    </span><span class="n">photo_bulk_cutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-494" name="ln-494" href="#ln-494"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_bulk_cutoff&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_bulk_cutoff</span><span class="p">)</span><span class="w"></span>
<a id="ln-495" name="ln-495" href="#ln-495"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="n">photo_bulk_cutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">log</span><span class="p">(</span><span class="n">photo_bulk_cutoff</span><span class="p">)</span><span class="w"></span>
<a id="ln-496" name="ln-496" href="#ln-496"></a><span class="w">    </span><span class="n">photo_temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">29</span><span class="mf">8.0_dp</span><span class="w"></span>
<a id="ln-497" name="ln-497" href="#ln-497"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_temperature&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_temperature</span><span class="p">)</span><span class="w"></span>
<a id="ln-498" name="ln-498" href="#ln-498"></a>
<a id="ln-499" name="ln-499" href="#ln-499"></a><span class="w">    </span><span class="c">! call param_get_keyword(&#39;photo_surface_area&#39;, found, r_value=photo_surface_area)</span>
<a id="ln-500" name="ln-500" href="#ln-500"></a><span class="w">    </span><span class="c">! if (photo .and. .not. found) &amp;</span>
<a id="ln-501" name="ln-501" href="#ln-501"></a><span class="w">    </span><span class="c">! call io_error(&#39;Error: please set surface area for photoemission calculation&#39;)</span>
<a id="ln-502" name="ln-502" href="#ln-502"></a>
<a id="ln-503" name="ln-503" href="#ln-503"></a><span class="w">    </span><span class="c">! call param_get_keyword(&#39;photo_slab_volume&#39;, found, r_value=photo_slab_volume)</span>
<a id="ln-504" name="ln-504" href="#ln-504"></a><span class="w">    </span><span class="c">! if (photo .and. .not. found) &amp;</span>
<a id="ln-505" name="ln-505" href="#ln-505"></a><span class="w">    </span><span class="c">!   call io_error(&#39;Error: please set volume of the slab for photoemission calculation&#39;)</span>
<a id="ln-506" name="ln-506" href="#ln-506"></a>
<a id="ln-507" name="ln-507" href="#ln-507"></a><span class="w">    </span><span class="n">photo_slab_min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-508" name="ln-508" href="#ln-508"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_slab_min&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_slab_min</span><span class="p">)</span><span class="w"></span>
<a id="ln-509" name="ln-509" href="#ln-509"></a><span class="w">    </span><span class="c">! if(photo .and. .not. found) &amp;</span>
<a id="ln-510" name="ln-510" href="#ln-510"></a><span class="w">    </span><span class="c">!     call io_error(&#39;Error: please set volume of the slab for photoemission calculation&#39;)</span>
<a id="ln-511" name="ln-511" href="#ln-511"></a><span class="w">    </span><span class="n">photo_slab_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-512" name="ln-512" href="#ln-512"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_slab_max&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_slab_max</span><span class="p">)</span><span class="w"></span>
<a id="ln-513" name="ln-513" href="#ln-513"></a>
<a id="ln-514" name="ln-514" href="#ln-514"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo_slab_max</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">photo_slab_min</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-515" name="ln-515" href="#ln-515"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: the supplied min or max values are negative, which causes faulty calculations!&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-516" name="ln-516" href="#ln-516"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-517" name="ln-517" href="#ln-517"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">photo_slab_max</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="n">photo_slab_min</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-518" name="ln-518" href="#ln-518"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: the supplied slab_max value is less than the slab_min value!&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-519" name="ln-519" href="#ln-519"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-520" name="ln-520" href="#ln-520"></a>
<a id="ln-521" name="ln-521" href="#ln-521"></a><span class="k">    </span><span class="n">photo_remove_box_states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">False</span><span class="p">.</span><span class="w"></span>
<a id="ln-522" name="ln-522" href="#ln-522"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_remove_box_states&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="o">=</span><span class="n">photo_remove_box_states</span><span class="p">)</span><span class="w"></span>
<a id="ln-523" name="ln-523" href="#ln-523"></a>
<a id="ln-524" name="ln-524" href="#ln-524"></a><span class="w">    </span><span class="n">photo_layer_choice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;optados&#39;</span><span class="w"></span>
<a id="ln-525" name="ln-525" href="#ln-525"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_layer_choice&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="o">=</span><span class="n">photo_layer_choice</span><span class="p">)</span><span class="w"></span>
<a id="ln-526" name="ln-526" href="#ln-526"></a>
<a id="ln-527" name="ln-527" href="#ln-527"></a><span class="w">    </span><span class="n">photo_max_layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<a id="ln-528" name="ln-528" href="#ln-528"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_max_layer&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="o">=</span><span class="n">photo_max_layer</span><span class="p">)</span><span class="w"></span>
<a id="ln-529" name="ln-529" href="#ln-529"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">photo_layer_choice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-530" name="ln-530" href="#ln-530"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: max # of layers was set to be supplied by user, but does not exist in input&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-531" name="ln-531" href="#ln-531"></a>
<a id="ln-532" name="ln-532" href="#ln-532"></a><span class="w">    </span><span class="n">photo_elec_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00_dp</span><span class="w"></span>
<a id="ln-533" name="ln-533" href="#ln-533"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="s1">&#39;photo_elec_field&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_elec_field</span><span class="p">)</span><span class="w"></span>
<a id="ln-534" name="ln-534" href="#ln-534"></a>
<a id="ln-535" name="ln-535" href="#ln-535"></a><span class="w">    </span><span class="k">call </span><span class="n">param_get_vector_length</span><span class="p">(</span><span class="s1">&#39;photo_imfp_const&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_temp</span><span class="p">)</span><span class="w"></span>
<a id="ln-536" name="ln-536" href="#ln-536"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-537" name="ln-537" href="#ln-537"></a><span class="k">      </span><span class="n">photo_len_imfp_const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i_temp</span><span class="w"></span>
<a id="ln-538" name="ln-538" href="#ln-538"></a><span class="w">      </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">photo_imfp_const</span><span class="p">(</span><span class="n">i_temp</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-539" name="ln-539" href="#ln-539"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: param_read - allocation failed for photo_imfp_const&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-540" name="ln-540" href="#ln-540"></a><span class="w">      </span><span class="k">call </span><span class="n">param_get_keyword_vector</span><span class="p">(</span><span class="s1">&#39;photo_imfp_const&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">i_temp</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="o">=</span><span class="n">photo_imfp_const</span><span class="p">)</span><span class="w"></span>
<a id="ln-541" name="ln-541" href="#ln-541"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-542" name="ln-542" href="#ln-542"></a><span class="k">      </span><span class="n">photo_len_imfp_const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-543" name="ln-543" href="#ln-543"></a><span class="w">      </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">photo_imfp_const</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-544" name="ln-544" href="#ln-544"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: param_read - allocation failed for photo_imfp_const&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-545" name="ln-545" href="#ln-545"></a><span class="w">      </span><span class="n">photo_imfp_const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="w"></span>
<a id="ln-546" name="ln-546" href="#ln-546"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-547" name="ln-547" href="#ln-547"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-548" name="ln-548" href="#ln-548"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: constant imfp, but photo_imfp_const is not set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-549" name="ln-549" href="#ln-549"></a>
<a id="ln-550" name="ln-550" href="#ln-550"></a><span class="w">    </span><span class="n">num_atoms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-551" name="ln-551" href="#ln-551"></a><span class="w">    </span><span class="n">num_species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-552" name="ln-552" href="#ln-552"></a><span class="w">    </span><span class="n">num_crystal_symmetry_operations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-553" name="ln-553" href="#ln-553"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pdos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">pdis</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">optics</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">photo</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">jdos</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<a id="ln-554" name="ln-554" href="#ln-554"></a><span class="w">      </span><span class="c">! try to read in the atoms from the cell file.</span>
<a id="ln-555" name="ln-555" href="#ln-555"></a><span class="w">      </span><span class="c">! We don&#39;t need them otherwise, so let&#39;s not bother</span>
<a id="ln-556" name="ln-556" href="#ln-556"></a><span class="w">      </span><span class="c">!  if(index(devel_flag,&#39;old_filename&#39;)&gt;0) then</span>
<a id="ln-557" name="ln-557" href="#ln-557"></a><span class="w">      </span><span class="c">! No longer need to call get_atoms as we&#39;re forcing people who use the legacy code to make an -out.cell</span>
<a id="ln-558" name="ln-558" href="#ln-558"></a><span class="w">      </span><span class="c">!     call cell_get_atoms</span>
<a id="ln-559" name="ln-559" href="#ln-559"></a><span class="w">      </span><span class="c">!  else</span>
<a id="ln-560" name="ln-560" href="#ln-560"></a><span class="w">      </span><span class="k">call </span><span class="n">cell_read_cell</span><span class="w"></span>
<a id="ln-561" name="ln-561" href="#ln-561"></a><span class="w">      </span><span class="c">!  end if</span>
<a id="ln-562" name="ln-562" href="#ln-562"></a><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<a id="ln-563" name="ln-563" href="#ln-563"></a>
<a id="ln-564" name="ln-564" href="#ln-564"></a><span class="w">    </span><span class="c">! check to see that there are no unrecognised keywords</span>
<a id="ln-565" name="ln-565" href="#ln-565"></a>
<a id="ln-566" name="ln-566" href="#ln-566"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">in_data</span><span class="p">(:))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-567" name="ln-567" href="#ln-567"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;The following section of file &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">seedname</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.odi contained unrecognised keywords&#39;</span><span class="w"></span>
<a id="ln-568" name="ln-568" href="#ln-568"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<a id="ln-569" name="ln-569" href="#ln-569"></a><span class="w">      </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-570" name="ln-570" href="#ln-570"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-571" name="ln-571" href="#ln-571"></a><span class="k">          write</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span><span class="w"></span>
<a id="ln-572" name="ln-572" href="#ln-572"></a><span class="w">        </span><span class="k">end if</span>
<a id="ln-573" name="ln-573" href="#ln-573"></a><span class="k">      end do</span>
<a id="ln-574" name="ln-574" href="#ln-574"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<a id="ln-575" name="ln-575" href="#ln-575"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Unrecognised keyword(s) in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-576" name="ln-576" href="#ln-576"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-577" name="ln-577" href="#ln-577"></a>
<a id="ln-578" name="ln-578" href="#ln-578"></a><span class="k">    call </span><span class="n">param_uppercase</span><span class="p">()</span><span class="w"></span>
<a id="ln-579" name="ln-579" href="#ln-579"></a>
<a id="ln-580" name="ln-580" href="#ln-580"></a><span class="w">    </span><span class="k">deallocate</span><span class="w"> </span><span class="p">(</span><span class="n">in_data</span><span class="p">,</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-581" name="ln-581" href="#ln-581"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error deallocating in_data in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-582" name="ln-582" href="#ln-582"></a>
<a id="ln-583" name="ln-583" href="#ln-583"></a><span class="w">    </span><span class="c">! =============================== !</span>
<a id="ln-584" name="ln-584" href="#ln-584"></a><span class="w">    </span><span class="c">! Some checks and initialisations !</span>
<a id="ln-585" name="ln-585" href="#ln-585"></a><span class="w">    </span><span class="c">! =============================== !</span>
<a id="ln-586" name="ln-586" href="#ln-586"></a>
<a id="ln-587" name="ln-587" href="#ln-587"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dos_min_energy</span><span class="w"> </span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="w"> </span><span class="n">dos_max_energy</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-588" name="ln-588" href="#ln-588"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: must have dos_min_energy &lt; dos_max_energy&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-589" name="ln-589" href="#ln-589"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-590" name="ln-590" href="#ln-590"></a>
<a id="ln-591" name="ln-591" href="#ln-591"></a><span class="k">    if</span><span class="w"> </span><span class="p">((</span><span class="n">dos_nbins</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">dos_spacing</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-592" name="ln-592" href="#ln-592"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: only one of dos_nbins and dos_spacing may be set&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-593" name="ln-593" href="#ln-593"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-594" name="ln-594" href="#ln-594"></a>
<a id="ln-595" name="ln-595" href="#ln-595"></a><span class="k">    if</span><span class="w"> </span><span class="p">((</span><span class="n">dos_nbins</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">dos_spacing</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0_dp</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-596" name="ln-596" href="#ln-596"></a><span class="k">      </span><span class="n">dos_spacing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.005</span><span class="w"> </span><span class="c">! Roughly similar to LinDOS</span>
<a id="ln-597" name="ln-597" href="#ln-597"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-598" name="ln-598" href="#ln-598"></a>
<a id="ln-599" name="ln-599" href="#ln-599"></a><span class="k">    return</span>
<a id="ln-600" name="ln-600" href="#ln-600"></a>
<a id="ln-601" name="ln-601" href="#ln-601"></a><span class="k">  end subroutine </span><span class="n">param_read</span><span class="w"></span>
<a id="ln-602" name="ln-602" href="#ln-602"></a>
<a id="ln-603" name="ln-603" href="#ln-603"></a><span class="w">  </span><span class="c">!===================================================================</span>
<a id="ln-604" name="ln-604" href="#ln-604"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_uppercase</span><span class="w"></span>
<a id="ln-605" name="ln-605" href="#ln-605"></a><span class="w">    </span><span class="c">!===================================================================</span>
<a id="ln-606" name="ln-606" href="#ln-606"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-607" name="ln-607" href="#ln-607"></a><span class="w">    </span><span class="c">! Convert a few things to uppercase to look nice in the output     !</span>
<a id="ln-608" name="ln-608" href="#ln-608"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-609" name="ln-609" href="#ln-609"></a><span class="w">    </span><span class="c">!===================================================================</span>
<a id="ln-610" name="ln-610" href="#ln-610"></a>
<a id="ln-611" name="ln-611" href="#ln-611"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-612" name="ln-612" href="#ln-612"></a>
<a id="ln-613" name="ln-613" href="#ln-613"></a><span class="k">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nsp</span><span class="p">,</span><span class="w"> </span><span class="n">ic</span><span class="w"></span>
<a id="ln-614" name="ln-614" href="#ln-614"></a>
<a id="ln-615" name="ln-615" href="#ln-615"></a><span class="w">    </span><span class="c">! Atom labels (eg, si --&gt; Si)</span>
<a id="ln-616" name="ln-616" href="#ln-616"></a><span class="w">    </span><span class="k">do </span><span class="n">nsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_species</span><span class="w"></span>
<a id="ln-617" name="ln-617" href="#ln-617"></a><span class="w">      </span><span class="n">ic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="n">atoms_label</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<a id="ln-618" name="ln-618" href="#ln-618"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ic</span><span class="w"> </span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ic</span><span class="w"> </span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-619" name="ln-619" href="#ln-619"></a><span class="w">        </span><span class="n">atoms_label</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="n">ic</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">))</span><span class="w"></span>
<a id="ln-620" name="ln-620" href="#ln-620"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-621" name="ln-621" href="#ln-621"></a>
<a id="ln-622" name="ln-622" href="#ln-622"></a><span class="k">    do </span><span class="n">nsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_species</span><span class="w"></span>
<a id="ln-623" name="ln-623" href="#ln-623"></a><span class="w">      </span><span class="n">ic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="n">atoms_symbol</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<a id="ln-624" name="ln-624" href="#ln-624"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ic</span><span class="w"> </span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ic</span><span class="w"> </span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-625" name="ln-625" href="#ln-625"></a><span class="w">        </span><span class="n">atoms_symbol</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="n">ic</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">))</span><span class="w"></span>
<a id="ln-626" name="ln-626" href="#ln-626"></a><span class="w">    </span><span class="k">end do</span><span class="w"></span>
<a id="ln-627" name="ln-627" href="#ln-627"></a>
<a id="ln-628" name="ln-628" href="#ln-628"></a><span class="w">    </span><span class="c">! Length unit (ang --&gt; Ang, bohr --&gt; Bohr)</span>
<a id="ln-629" name="ln-629" href="#ln-629"></a><span class="w">    </span><span class="n">ic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="n">length_unit</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<a id="ln-630" name="ln-630" href="#ln-630"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">ic</span><span class="w"> </span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">ic</span><span class="w"> </span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-631" name="ln-631" href="#ln-631"></a><span class="w">      </span><span class="n">length_unit</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">char</span><span class="p">(</span><span class="n">ic</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">ichar</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">))</span><span class="w"></span>
<a id="ln-632" name="ln-632" href="#ln-632"></a>
<a id="ln-633" name="ln-633" href="#ln-633"></a><span class="w">    </span><span class="k">return</span>
<a id="ln-634" name="ln-634" href="#ln-634"></a>
<a id="ln-635" name="ln-635" href="#ln-635"></a><span class="k">  end subroutine </span><span class="n">param_uppercase</span><span class="w"></span>
<a id="ln-636" name="ln-636" href="#ln-636"></a>
<a id="ln-637" name="ln-637" href="#ln-637"></a><span class="w">  </span><span class="c">!===================================================================</span>
<a id="ln-638" name="ln-638" href="#ln-638"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_write_header</span><span class="w"></span>
<a id="ln-639" name="ln-639" href="#ln-639"></a><span class="w">    </span><span class="k">use </span><span class="n">od_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">optados_version</span><span class="p">,</span><span class="w"> </span><span class="n">copyright</span><span class="w"></span>
<a id="ln-640" name="ln-640" href="#ln-640"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-641" name="ln-641" href="#ln-641"></a><span class="k">    write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<a id="ln-642" name="ln-642" href="#ln-642"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; +===========================================================================+&quot;</span><span class="w"></span>
<a id="ln-643" name="ln-643" href="#ln-643"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-644" name="ln-644" href="#ln-644"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                OOO   PPPP  TTTTT  AA   DDD    OOO    SSS                  | &quot;</span><span class="w"></span>
<a id="ln-645" name="ln-645" href="#ln-645"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |               O   O  P   P   T   A  A  D  D  O   O  S                     | &quot;</span><span class="w"></span>
<a id="ln-646" name="ln-646" href="#ln-646"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |               O   O  PPPP    T   AAAA  D  D  O   O   SS                   | &quot;</span><span class="w"></span>
<a id="ln-647" name="ln-647" href="#ln-647"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |               O   O  P       T   A  A  D  D  O   O     S                  | &quot;</span><span class="w"></span>
<a id="ln-648" name="ln-648" href="#ln-648"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                OOO   P       T   A  A  DDD    OOO   SSS                   | &quot;</span><span class="w"></span>
<a id="ln-649" name="ln-649" href="#ln-649"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-650" name="ln-650" href="#ln-650"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; +---------------------------------------------------------------------------+ &quot;</span><span class="w"></span>
<a id="ln-651" name="ln-651" href="#ln-651"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-652" name="ln-652" href="#ln-652"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a46,a5,a28)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                 Welcome to OptaDOS version &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">optados_version</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;   &amp;</span>
<a id="ln-653" name="ln-653" href="#ln-653"></a><span class="s2">         &amp;                     | &quot;</span><span class="w"></span>
<a id="ln-654" name="ln-654" href="#ln-654"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-655" name="ln-655" href="#ln-655"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |         Andrew J. Morris, Rebecca Nicholls, Chris J. Pickard              | &quot;</span><span class="w"></span>
<a id="ln-656" name="ln-656" href="#ln-656"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                       and Jonathan R. Yates                               | &quot;</span><span class="w"></span>
<a id="ln-657" name="ln-657" href="#ln-657"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-658" name="ln-658" href="#ln-658"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a34,a14,a30)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                       Copyright&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">copyright</span><span class="p">),&amp;</span><span class="w"></span>
<a id="ln-659" name="ln-659" href="#ln-659"></a><span class="w">         </span><span class="p">&amp;</span><span class="s2">&quot;                             | &quot;</span><span class="w"></span>
<a id="ln-660" name="ln-660" href="#ln-660"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-661" name="ln-661" href="#ln-661"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |  Please cite:                                                             | &quot;</span><span class="w"></span>
<a id="ln-662" name="ln-662" href="#ln-662"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |  Andrew J. Morris, Rebecca Nicholls, Chris J. Pickard and Jonathan Yates  | &quot;</span><span class="w"></span>
<a id="ln-663" name="ln-663" href="#ln-663"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |              Comp. Phys. Comm. 185, 5, 1477 (2014)                        | &quot;</span><span class="w"></span>
<a id="ln-664" name="ln-664" href="#ln-664"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-665" name="ln-665" href="#ln-665"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |  Additionally when using the linear broadening:                           | &quot;</span><span class="w"></span>
<a id="ln-666" name="ln-666" href="#ln-666"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; | C.J. Pickard and M.C. Payne, Phys. Rev. B, 59, 7, 4685 (1999)             | &quot;</span><span class="w"></span>
<a id="ln-667" name="ln-667" href="#ln-667"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; | C.J. Pickard and M.C. Payne, Phys. Rev. B, 62, 7, 4383 (2000)             | &quot;</span><span class="w"></span>
<a id="ln-668" name="ln-668" href="#ln-668"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-669" name="ln-669" href="#ln-669"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |  Additionally when using the adaptive broadening:                         | &quot;</span><span class="w"></span>
<a id="ln-670" name="ln-670" href="#ln-670"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; | J.Yates, X.Wang, D.Vanderbilt and I.Souza, Phys. Rev. B, 75, 195121 (2007)| &quot;</span><span class="w"></span>
<a id="ln-671" name="ln-671" href="#ln-671"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-672" name="ln-672" href="#ln-672"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |      in all your publications arising from your use of OptaDOS            | &quot;</span><span class="w"></span>
<a id="ln-673" name="ln-673" href="#ln-673"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; |                                                                           | &quot;</span><span class="w"></span>
<a id="ln-674" name="ln-674" href="#ln-674"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s2">&quot; +===========================================================================+ &quot;</span><span class="w"></span>
<a id="ln-675" name="ln-675" href="#ln-675"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"></span>
<a id="ln-676" name="ln-676" href="#ln-676"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_write_header</span><span class="w"></span>
<a id="ln-677" name="ln-677" href="#ln-677"></a>
<a id="ln-678" name="ln-678" href="#ln-678"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_write_atomic_coord</span><span class="w"></span>
<a id="ln-679" name="ln-679" href="#ln-679"></a><span class="w">    </span><span class="c">!==================================================================!</span>
<a id="ln-680" name="ln-680" href="#ln-680"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-681" name="ln-681" href="#ln-681"></a><span class="w">    </span><span class="c">! write atomic coodes to stdout                                       !</span>
<a id="ln-682" name="ln-682" href="#ln-682"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-683" name="ln-683" href="#ln-683"></a><span class="w">    </span><span class="c">!===================================================================</span>
<a id="ln-684" name="ln-684" href="#ln-684"></a>
<a id="ln-685" name="ln-685" href="#ln-685"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-686" name="ln-686" href="#ln-686"></a>
<a id="ln-687" name="ln-687" href="#ln-687"></a><span class="k">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nat</span><span class="p">,</span><span class="w"> </span><span class="n">nsp</span><span class="p">,</span><span class="w"> </span><span class="n">atom_counter</span><span class="w"></span>
<a id="ln-688" name="ln-688" href="#ln-688"></a>
<a id="ln-689" name="ln-689" href="#ln-689"></a><span class="w">    </span><span class="c">! System</span>
<a id="ln-690" name="ln-690" href="#ln-690"></a>
<a id="ln-691" name="ln-691" href="#ln-691"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_atoms</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-692" name="ln-692" href="#ln-692"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-693" name="ln-693" href="#ln-693"></a><span class="w">      </span><span class="c">! IT DOESN&#39;T SEEM HELPFUL TO WRITE OUT TO MULTIPLY THE INITAL ATOMIC POSITIONS WITH THE FINAL LATTICE...</span>
<a id="ln-694" name="ln-694" href="#ln-694"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-695" name="ln-695" href="#ln-695"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-696" name="ln-696" href="#ln-696"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lenconfac</span><span class="w"> </span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="w"> </span><span class="mf">1.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-697" name="ln-697" href="#ln-697"></a><span class="k">          write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|   Site       Fractional Coordinate          Cartesian Coordinate (Ang)     |&#39;</span><span class="w"></span>
<a id="ln-698" name="ln-698" href="#ln-698"></a><span class="w">        </span><span class="k">else</span>
<a id="ln-699" name="ln-699" href="#ln-699"></a><span class="k">          write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|   Site       Fractional Coordinate          Cartesian Coordinate (Bohr)    |&#39;</span><span class="w"></span>
<a id="ln-700" name="ln-700" href="#ln-700"></a><span class="w">        </span><span class="k">end if</span>
<a id="ln-701" name="ln-701" href="#ln-701"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-702" name="ln-702" href="#ln-702"></a><span class="w">        </span><span class="k">do </span><span class="n">nsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_species</span><span class="w"></span>
<a id="ln-703" name="ln-703" href="#ln-703"></a><span class="w">          </span><span class="k">do </span><span class="n">nat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_species_num</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"></span>
<a id="ln-704" name="ln-704" href="#ln-704"></a><span class="w">            </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a1,1x,a2,1x,i3,3F10.5,3x,a1,1x,3F10.5,4x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_symbol</span><span class="p">(</span><span class="n">nsp</span><span class="p">),</span><span class="w"> </span><span class="n">nat</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-705" name="ln-705" href="#ln-705"></a><span class="w">              </span><span class="n">atoms_pos_frac</span><span class="p">(:,</span><span class="w"> </span><span class="n">nat</span><span class="p">,</span><span class="w"> </span><span class="n">nsp</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_pos_cart</span><span class="p">(:,</span><span class="w"> </span><span class="n">nat</span><span class="p">,</span><span class="w"> </span><span class="n">nsp</span><span class="p">)</span><span class="o">*</span><span class="n">lenconfac</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-706" name="ln-706" href="#ln-706"></a><span class="w">          </span><span class="k">end do</span>
<a id="ln-707" name="ln-707" href="#ln-707"></a><span class="k">        end do</span>
<a id="ln-708" name="ln-708" href="#ln-708"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-709" name="ln-709" href="#ln-709"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;  WARNING: These are the CASTEP input coordinates not the output -- here to   &#39;</span><span class="w"></span>
<a id="ln-710" name="ln-710" href="#ln-710"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;            aid advanced debugging only.&#39;</span><span class="w"></span>
<a id="ln-711" name="ln-711" href="#ln-711"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-712" name="ln-712" href="#ln-712"></a><span class="k">        </span><span class="n">atom_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-713" name="ln-713" href="#ln-713"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-714" name="ln-714" href="#ln-714"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|             Species                  Sites                  Total Atoms    |&#39;</span><span class="w"></span>
<a id="ln-715" name="ln-715" href="#ln-715"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-716" name="ln-716" href="#ln-716"></a><span class="w">        </span><span class="k">do </span><span class="n">nsp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_species</span><span class="w"></span>
<a id="ln-717" name="ln-717" href="#ln-717"></a><span class="w">          </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a1,16x,a2,16x,i4,a3,i4,16x,i4,11x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_symbol</span><span class="p">(</span><span class="n">nsp</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-718" name="ln-718" href="#ln-718"></a><span class="w">               </span><span class="p">&amp;</span><span class="w"> </span><span class="n">atom_counter</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;to&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">atom_counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">atoms_species_num</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">atoms_species_num</span><span class="p">(</span><span class="n">nsp</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;|&quot;</span><span class="w"></span>
<a id="ln-719" name="ln-719" href="#ln-719"></a><span class="w">          </span><span class="n">atom_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atom_counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">atoms_species_num</span><span class="p">(</span><span class="n">nsp</span><span class="p">)</span><span class="w"></span>
<a id="ln-720" name="ln-720" href="#ln-720"></a><span class="w">        </span><span class="k">end do</span>
<a id="ln-721" name="ln-721" href="#ln-721"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-722" name="ln-722" href="#ln-722"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-723" name="ln-723" href="#ln-723"></a><span class="k">    else</span>
<a id="ln-724" name="ln-724" href="#ln-724"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">iprint</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(25x,a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;No atom positions read&#39;</span><span class="w"></span>
<a id="ln-725" name="ln-725" href="#ln-725"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-726" name="ln-726" href="#ln-726"></a><span class="k">    write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-727" name="ln-727" href="#ln-727"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_write_atomic_coord</span><span class="w"></span>
<a id="ln-728" name="ln-728" href="#ln-728"></a>
<a id="ln-729" name="ln-729" href="#ln-729"></a><span class="w">  </span><span class="c">!===================================================================</span>
<a id="ln-730" name="ln-730" href="#ln-730"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_write</span><span class="w"></span>
<a id="ln-731" name="ln-731" href="#ln-731"></a><span class="w">    </span><span class="c">!==================================================================!</span>
<a id="ln-732" name="ln-732" href="#ln-732"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-733" name="ln-733" href="#ln-733"></a><span class="w">    </span><span class="c">! write parameters to stdout                                       !</span>
<a id="ln-734" name="ln-734" href="#ln-734"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-735" name="ln-735" href="#ln-735"></a><span class="w">    </span><span class="c">!===================================================================</span>
<a id="ln-736" name="ln-736" href="#ln-736"></a>
<a id="ln-737" name="ln-737" href="#ln-737"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-738" name="ln-738" href="#ln-738"></a>
<a id="ln-739" name="ln-739" href="#ln-739"></a><span class="k">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">nat</span><span class="p">,</span><span class="w"> </span><span class="n">nsp</span><span class="w"></span>
<a id="ln-740" name="ln-740" href="#ln-740"></a>
<a id="ln-741" name="ln-741" href="#ln-741"></a><span class="w">    </span><span class="c">! System</span>
<a id="ln-742" name="ln-742" href="#ln-742"></a>
<a id="ln-743" name="ln-743" href="#ln-743"></a><span class="w">    </span><span class="c">! if(num_atoms&gt;0) then</span>
<a id="ln-744" name="ln-744" href="#ln-744"></a><span class="w">    </span><span class="c">!    write(stdout,&#39;(1x,a)&#39;) &#39;+----------------------------------------------------------------------------+&#39;</span>
<a id="ln-745" name="ln-745" href="#ln-745"></a><span class="w">    </span><span class="c">!    if (lenconfac.eq.1.0_dp) then</span>
<a id="ln-746" name="ln-746" href="#ln-746"></a><span class="w">    </span><span class="c">!       write(stdout,&#39;(1x,a)&#39;) &#39;|   Site       Fractional Coordinate          Cartesian Coordinate (Ang)     |&#39;</span>
<a id="ln-747" name="ln-747" href="#ln-747"></a><span class="w">    </span><span class="c">!    else</span>
<a id="ln-748" name="ln-748" href="#ln-748"></a><span class="w">    </span><span class="c">!       write(stdout,&#39;(1x,a)&#39;) &#39;|   Site       Fractional Coordinate          Cartesian Coordinate (Bohr)    |&#39;</span>
<a id="ln-749" name="ln-749" href="#ln-749"></a><span class="w">    </span><span class="c">!    endif</span>
<a id="ln-750" name="ln-750" href="#ln-750"></a><span class="w">    </span><span class="c">!    write(stdout,&#39;(1x,a)&#39;) &#39;+----------------------------------------------------------------------------+&#39;</span>
<a id="ln-751" name="ln-751" href="#ln-751"></a><span class="w">    </span><span class="c">!    do nsp=1,num_species</span>
<a id="ln-752" name="ln-752" href="#ln-752"></a><span class="w">    </span><span class="c">!       do nat=1,atoms_species_num(nsp)</span>
<a id="ln-753" name="ln-753" href="#ln-753"></a><span class="w">    </span><span class="c">!          write(stdout,&#39;(1x,a1,1x,a2,1x,i3,3F10.5,3x,a1,1x,3F10.5,4x,a1)&#39;) &#39;|&#39;,atoms_symbol(nsp),nat,&amp;</span>
<a id="ln-754" name="ln-754" href="#ln-754"></a><span class="w">    </span><span class="c">!               atoms_pos_frac(:,nat,nsp),&#39;|&#39;,atoms_pos_cart(:,nat,nsp)*lenconfac,&#39;|&#39;</span>
<a id="ln-755" name="ln-755" href="#ln-755"></a><span class="w">    </span><span class="c">!       end do</span>
<a id="ln-756" name="ln-756" href="#ln-756"></a><span class="w">    </span><span class="c">!    end do</span>
<a id="ln-757" name="ln-757" href="#ln-757"></a><span class="w">    </span><span class="c">!    write(stdout,&#39;(1x,a)&#39;) &#39;+----------------------------------------------------------------------------+&#39;</span>
<a id="ln-758" name="ln-758" href="#ln-758"></a><span class="w">    </span><span class="c">! else</span>
<a id="ln-759" name="ln-759" href="#ln-759"></a><span class="w">    </span><span class="c">!    if(iprint&gt;1)  write(stdout,&#39;(25x,a)&#39;) &#39;No atom positions read&#39;</span>
<a id="ln-760" name="ln-760" href="#ln-760"></a><span class="w">    </span><span class="c">! end if</span>
<a id="ln-761" name="ln-761" href="#ln-761"></a><span class="w">    </span><span class="c">!  write(stdout,*) &#39; &#39;</span>
<a id="ln-762" name="ln-762" href="#ln-762"></a><span class="c">!!$</span>
<a id="ln-763" name="ln-763" href="#ln-763"></a><span class="c">!!$    write(stdout,*) &#39; &#39;</span>
<a id="ln-764" name="ln-764" href="#ln-764"></a><span class="c">!!$    if(iprint&gt;1) then</span>
<a id="ln-765" name="ln-765" href="#ln-765"></a><span class="c">!!$       write(stdout,&#39;(1x,a)&#39;) &#39;*----------------------------------------------------------------------------*&#39;</span>
<a id="ln-766" name="ln-766" href="#ln-766"></a><span class="c">!!$       if (lenconfac.eq.1.0_dp) then</span>
<a id="ln-767" name="ln-767" href="#ln-767"></a><span class="c">!!$          write(stdout,&#39;(1x,a)&#39;) &#39;| k-point      Fractional Coordinate        Cartesian Coordinate (Ang^-1)    |&#39;</span>
<a id="ln-768" name="ln-768" href="#ln-768"></a><span class="c">!!$       else</span>
<a id="ln-769" name="ln-769" href="#ln-769"></a><span class="c">!!$          write(stdout,&#39;(1x,a)&#39;) &#39;| k-point      Fractional Coordinate        Cartesian Coordinate (Bohr^-1)   |&#39;</span>
<a id="ln-770" name="ln-770" href="#ln-770"></a><span class="c">!!$       endif</span>
<a id="ln-771" name="ln-771" href="#ln-771"></a><span class="c">!!$       write(stdout,&#39;(1x,a)&#39;) &#39;+----------------------------------------------------------------------------+&#39;</span>
<a id="ln-772" name="ln-772" href="#ln-772"></a><span class="c">!!$       !       do nkp=1,nkpoints</span>
<a id="ln-773" name="ln-773" href="#ln-773"></a><span class="c">!!$       !          write(stdout,&#39;(1x,a1,i6,1x,3F10.5,3x,a1,1x,3F10.5,4x,a1)&#39;) &#39;|&#39;,&amp;</span>
<a id="ln-774" name="ln-774" href="#ln-774"></a><span class="c">!!$       ! nkp,kpoint_r(:,nkp),&#39;|&#39;,kpoint_r_cart(:,nkp)/lenconfac,&#39;|&#39;</span>
<a id="ln-775" name="ln-775" href="#ln-775"></a><span class="c">!!$       !       end do</span>
<a id="ln-776" name="ln-776" href="#ln-776"></a><span class="c">!!$       write(stdout,&#39;(1x,a)&#39;) &#39;*----------------------------------------------------------------------------*&#39;</span>
<a id="ln-777" name="ln-777" href="#ln-777"></a><span class="c">!!$       write(stdout,*) &#39; &#39;</span>
<a id="ln-778" name="ln-778" href="#ln-778"></a><span class="c">!!$    end if</span>
<a id="ln-779" name="ln-779" href="#ln-779"></a><span class="c">!!$    ! Main</span>
<a id="ln-780" name="ln-780" href="#ln-780"></a>
<a id="ln-781" name="ln-781" href="#ln-781"></a><span class="w">    </span><span class="c">!</span>
<a id="ln-782" name="ln-782" href="#ln-782"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+------------------------------ JOB CONTROL ---------------------------------+&#39;</span><span class="w"></span>
<a id="ln-783" name="ln-783" href="#ln-783"></a><span class="w">    </span><span class="c">!</span>
<a id="ln-784" name="ln-784" href="#ln-784"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dos</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-785" name="ln-785" href="#ln-785"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Density of States                  :  True                         |&#39;</span><span class="w"></span>
<a id="ln-786" name="ln-786" href="#ln-786"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-787" name="ln-787" href="#ln-787"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Density of States                  :  False                        |&#39;</span><span class="w"></span>
<a id="ln-788" name="ln-788" href="#ln-788"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-789" name="ln-789" href="#ln-789"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">pdos</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-790" name="ln-790" href="#ln-790"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Partial Density of States          :  True                         |&#39;</span><span class="w"></span>
<a id="ln-791" name="ln-791" href="#ln-791"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-792" name="ln-792" href="#ln-792"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Partial Density of States          :  False                        |&#39;</span><span class="w"></span>
<a id="ln-793" name="ln-793" href="#ln-793"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-794" name="ln-794" href="#ln-794"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">pdis</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-795" name="ln-795" href="#ln-795"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Projected Bandstructure            :  True                         |&#39;</span><span class="w"></span>
<a id="ln-796" name="ln-796" href="#ln-796"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-797" name="ln-797" href="#ln-797"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Projected Bandstructure            :  False                        |&#39;</span><span class="w"></span>
<a id="ln-798" name="ln-798" href="#ln-798"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-799" name="ln-799" href="#ln-799"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">jdos</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-800" name="ln-800" href="#ln-800"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Joint Density of States            :  True                         |&#39;</span><span class="w"></span>
<a id="ln-801" name="ln-801" href="#ln-801"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-802" name="ln-802" href="#ln-802"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Joint Density of States            :  False                        |&#39;</span><span class="w"></span>
<a id="ln-803" name="ln-803" href="#ln-803"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-804" name="ln-804" href="#ln-804"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">optics</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-805" name="ln-805" href="#ln-805"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Optical Response                   :  True                         |&#39;</span><span class="w"></span>
<a id="ln-806" name="ln-806" href="#ln-806"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-807" name="ln-807" href="#ln-807"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Optical Response                   :  False                        |&#39;</span><span class="w"></span>
<a id="ln-808" name="ln-808" href="#ln-808"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-809" name="ln-809" href="#ln-809"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-810" name="ln-810" href="#ln-810"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Core-level Spectra                 :  True                         |&#39;</span><span class="w"></span>
<a id="ln-811" name="ln-811" href="#ln-811"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-812" name="ln-812" href="#ln-812"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Output Core-level Spectra                 :  False                        |&#39;</span><span class="w"></span>
<a id="ln-813" name="ln-813" href="#ln-813"></a><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<a id="ln-814" name="ln-814" href="#ln-814"></a><span class="w">    </span><span class="c">!Photoemission</span>
<a id="ln-815" name="ln-815" href="#ln-815"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-816" name="ln-816" href="#ln-816"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Calculation                 :  True                         |&#39;</span><span class="w"></span>
<a id="ln-817" name="ln-817" href="#ln-817"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-818" name="ln-818" href="#ln-818"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Calculation                 :  False                        |&#39;</span><span class="w"></span>
<a id="ln-819" name="ln-819" href="#ln-819"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-820" name="ln-820" href="#ln-820"></a><span class="k">    write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,2x,i3,26x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  iprint level                              :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iprint</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-821" name="ln-821" href="#ln-821"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">legacy_file_format</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-822" name="ln-822" href="#ln-822"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Use CASTEP &lt; 6.0 file format              :  True                         |&#39;</span><span class="w"></span>
<a id="ln-823" name="ln-823" href="#ln-823"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-824" name="ln-824" href="#ln-824"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Use CASTEP &lt; 6.0 file format              :  False                        |&#39;</span><span class="w"></span>
<a id="ln-825" name="ln-825" href="#ln-825"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-826" name="ln-826" href="#ln-826"></a><span class="k">    write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+-------------------------------- UNITS -------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-827" name="ln-827" href="#ln-827"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,2x,a4,25x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Length Unit                               :&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">length_unit</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-828" name="ln-828" href="#ln-828"></a>
<a id="ln-829" name="ln-829" href="#ln-829"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dos</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">pdos</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-830" name="ln-830" href="#ln-830"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">dos_per_volume</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-831" name="ln-831" href="#ln-831"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  J/P/DOS units                             :  electrons eV^-1 Ang^-3       |&#39;</span><span class="w"></span>
<a id="ln-832" name="ln-832" href="#ln-832"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-833" name="ln-833" href="#ln-833"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  J/P/DOS units                             :  electrons eV^-1              |&#39;</span><span class="w"></span>
<a id="ln-834" name="ln-834" href="#ln-834"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-835" name="ln-835" href="#ln-835"></a><span class="k">    end if</span>
<a id="ln-836" name="ln-836" href="#ln-836"></a>
<a id="ln-837" name="ln-837" href="#ln-837"></a><span class="k">    write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+-------------------------- SPECTRAL PARAMETERS -----------------------------+&#39;</span><span class="w"></span>
<a id="ln-838" name="ln-838" href="#ln-838"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixed</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-839" name="ln-839" href="#ln-839"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Fixed Width Smearing                      :  True                         |&#39;</span><span class="w"></span>
<a id="ln-840" name="ln-840" href="#ln-840"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,F10.5,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Smearing Width                            :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">fixed_smearing</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-841" name="ln-841" href="#ln-841"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-842" name="ln-842" href="#ln-842"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">adaptive</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-843" name="ln-843" href="#ln-843"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Adaptive Width Smearing                   :  True                         |&#39;</span><span class="w"></span>
<a id="ln-844" name="ln-844" href="#ln-844"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,F10.5,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Adaptive Smearing ratio                   :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">adaptive_smearing</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-845" name="ln-845" href="#ln-845"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-846" name="ln-846" href="#ln-846"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">linear</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-847" name="ln-847" href="#ln-847"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Linear Extrapolation                      :  True                         |&#39;</span><span class="w"></span>
<a id="ln-848" name="ln-848" href="#ln-848"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,F10.5,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Smearing Width                            :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">linear_smearing</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-849" name="ln-849" href="#ln-849"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-850" name="ln-850" href="#ln-850"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">quad</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-851" name="ln-851" href="#ln-851"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Quadratic Extrapolation                   :  True                         |&#39;</span><span class="w"></span>
<a id="ln-852" name="ln-852" href="#ln-852"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">finite_bin_correction</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-853" name="ln-853" href="#ln-853"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Finite Bin Correction                     :  True                         |&#39;</span><span class="w"></span>
<a id="ln-854" name="ln-854" href="#ln-854"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hybrid_linear</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-855" name="ln-855" href="#ln-855"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Hybrid Linear Correction                  :  True                         |&#39;</span><span class="w"></span>
<a id="ln-856" name="ln-856" href="#ln-856"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,F10.5,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Hybrid Linear Gradient Tolerance          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">hybrid_linear_grad_tol</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-857" name="ln-857" href="#ln-857"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-858" name="ln-858" href="#ln-858"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">numerical_intdos</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-859" name="ln-859" href="#ln-859"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Numerical Integration of P/DOS            :  True                         |&#39;</span><span class="w"></span>
<a id="ln-860" name="ln-860" href="#ln-860"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dos_per_volume</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-861" name="ln-861" href="#ln-861"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Present DOS per simulation cell volume    :  True                         |&#39;</span><span class="w"></span>
<a id="ln-862" name="ln-862" href="#ln-862"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">set_efermi_zero</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-863" name="ln-863" href="#ln-863"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Shift energy scale so fermi_energy=0      :  True                         |&#39;</span><span class="w"></span>
<a id="ln-864" name="ln-864" href="#ln-864"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-865" name="ln-865" href="#ln-865"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Shift energy scale so fermi_energy=0      :  False                        |&#39;</span><span class="w"></span>
<a id="ln-866" name="ln-866" href="#ln-866"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-867" name="ln-867" href="#ln-867"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">efermi_user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">99</span><span class="mf">9.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! efermi_user not set</span>
<a id="ln-868" name="ln-868" href="#ln-868"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">efermi_choice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;optados&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-869" name="ln-869" href="#ln-869"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Fermi energy                              :  Calculated by OptaDOS        |&#39;</span><span class="w"></span>
<a id="ln-870" name="ln-870" href="#ln-870"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">efermi_choice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-871" name="ln-871" href="#ln-871"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Fermi energy                              :  Read from file               |&#39;</span><span class="w"></span>
<a id="ln-872" name="ln-872" href="#ln-872"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">efermi_choice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;insulator&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-873" name="ln-873" href="#ln-873"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Fermi energy                              :  Assume insulator (n_elec/2)  |&#39;</span><span class="w"></span>
<a id="ln-874" name="ln-874" href="#ln-874"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-875" name="ln-875" href="#ln-875"></a><span class="k">    else</span><span class="w"> </span><span class="c">! It is set</span>
<a id="ln-876" name="ln-876" href="#ln-876"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1F10.5,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Fermi energy                              :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">efermi_user</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-877" name="ln-877" href="#ln-877"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-878" name="ln-878" href="#ln-878"></a>
<a id="ln-879" name="ln-879" href="#ln-879"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">compute_band_energy</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-880" name="ln-880" href="#ln-880"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Compute the band energy                   :  True                         |&#39;</span><span class="w"></span>
<a id="ln-881" name="ln-881" href="#ln-881"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-882" name="ln-882" href="#ln-882"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Compute the band energy                   :  False                        |&#39;</span><span class="w"></span>
<a id="ln-883" name="ln-883" href="#ln-883"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-884" name="ln-884" href="#ln-884"></a>
<a id="ln-885" name="ln-885" href="#ln-885"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">compute_band_gap</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-886" name="ln-886" href="#ln-886"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Compute the band gap                      :  True                         |&#39;</span><span class="w"></span>
<a id="ln-887" name="ln-887" href="#ln-887"></a><span class="w">    </span><span class="k">else</span>
<a id="ln-888" name="ln-888" href="#ln-888"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Compute the band gap                      :  False                        |&#39;</span><span class="w"></span>
<a id="ln-889" name="ln-889" href="#ln-889"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-890" name="ln-890" href="#ln-890"></a>
<a id="ln-891" name="ln-891" href="#ln-891"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-892" name="ln-892" href="#ln-892"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a19,26x,a2,f7.4,3x,21a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  JDOS bin spacing&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jdos_spacing</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;eV                  |&#39;</span><span class="w"></span>
<a id="ln-893" name="ln-893" href="#ln-893"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a22,23x,a2,f7.4,3x,21a)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  JDOS max energy bin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;: &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jdos_max_energy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;eV                  |&#39;</span><span class="w"></span>
<a id="ln-894" name="ln-894" href="#ln-894"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-895" name="ln-895" href="#ln-895"></a>
<a id="ln-896" name="ln-896" href="#ln-896"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">optics</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">photo</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-897" name="ln-897" href="#ln-897"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+-------------------------------- OPTICS ------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-898" name="ln-898" href="#ln-898"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-899" name="ln-899" href="#ln-899"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Geometry for Optics Calculation           :  Polycrystalline              |&#39;</span><span class="w"></span>
<a id="ln-900" name="ln-900" href="#ln-900"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unpolar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-901" name="ln-901" href="#ln-901"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Geometry for Optics Calculation           :  Unpolarised                  |&#39;</span><span class="w"></span>
<a id="ln-902" name="ln-902" href="#ln-902"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a47,2x,f6.2,2x,f6.2,2x,f6.2,3x,a4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Direction of q-vector (un-normalised)     : &#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-903" name="ln-903" href="#ln-903"></a><span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="n">optics_qdir</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;   |&#39;</span><span class="w"></span>
<a id="ln-904" name="ln-904" href="#ln-904"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-905" name="ln-905" href="#ln-905"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Geometry for Optics Calculation           :  Polarised                    |&#39;</span><span class="w"></span>
<a id="ln-906" name="ln-906" href="#ln-906"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a47,2x,f6.2,2x,f6.2,2x,f6.2,3x,a4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Direction of q-vector (un-normalised)     : &#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-907" name="ln-907" href="#ln-907"></a><span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="n">optics_qdir</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;   |&#39;</span><span class="w"></span>
<a id="ln-908" name="ln-908" href="#ln-908"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;tensor&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-909" name="ln-909" href="#ln-909"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Geometry for Optics Calculation           :  Full dielectric tensor       |&#39;</span><span class="w"></span>
<a id="ln-910" name="ln-910" href="#ln-910"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-911" name="ln-911" href="#ln-911"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">optics_intraband</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-912" name="ln-912" href="#ln-912"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Include Intraband Contribution            :  True                         |&#39;</span><span class="w"></span>
<a id="ln-913" name="ln-913" href="#ln-913"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1E10.3,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Drude Broadening                          :&#39;</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-914" name="ln-914" href="#ln-914"></a><span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">optics_drude_broadening</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-915" name="ln-915" href="#ln-915"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-916" name="ln-916" href="#ln-916"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Include Intraband Contribution            :  False                        |&#39;</span><span class="w"></span>
<a id="ln-917" name="ln-917" href="#ln-917"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-918" name="ln-918" href="#ln-918"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">optics_lossfn_broadening</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-919" name="ln-919" href="#ln-919"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Include Loss Function Broadening          :  True                         |&#39;</span><span class="w"></span>
<a id="ln-920" name="ln-920" href="#ln-920"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Gaussian Width                            :&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-921" name="ln-921" href="#ln-921"></a><span class="w">        </span><span class="p">&amp;</span><span class="n">optics_lossfn_gaussian</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-922" name="ln-922" href="#ln-922"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-923" name="ln-923" href="#ln-923"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Include Loss Function Broadening          :  False                        |&#39;</span><span class="w"></span>
<a id="ln-924" name="ln-924" href="#ln-924"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-925" name="ln-925" href="#ln-925"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">scissor_op</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.0e-10_dp</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-926" name="ln-926" href="#ln-926"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Scissor Operator (eV)                     :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">scissor_op</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-927" name="ln-927" href="#ln-927"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-928" name="ln-928" href="#ln-928"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">core</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-929" name="ln-929" href="#ln-929"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+--------------------------------- CORE -------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-930" name="ln-930" href="#ln-930"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polycrys&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-931" name="ln-931" href="#ln-931"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Geometry for Core Calculation             :  Polycrystalline              |&#39;</span><span class="w"></span>
<a id="ln-932" name="ln-932" href="#ln-932"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;polar&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-933" name="ln-933" href="#ln-933"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Geometry for Core Calculation             :  Polarised                    |&#39;</span><span class="w"></span>
<a id="ln-934" name="ln-934" href="#ln-934"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a47,2x,f6.2,2x,f6.2,2x,f6.2,3x,a4)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Direction of q-vector (un-normalised)     : &#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-935" name="ln-935" href="#ln-935"></a><span class="w">          </span><span class="p">,</span><span class="w"> </span><span class="n">core_qdir</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;   |&#39;</span><span class="w"></span>
<a id="ln-936" name="ln-936" href="#ln-936"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-937" name="ln-937" href="#ln-937"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_type</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;absorption&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-938" name="ln-938" href="#ln-938"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Absorption or Emission Spectrum           :  Absorption                   |&#39;</span><span class="w"></span>
<a id="ln-939" name="ln-939" href="#ln-939"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">core_type</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;emission&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-940" name="ln-940" href="#ln-940"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Absorption or Emission Spectrum           :  Emission                     |&#39;</span><span class="w"></span>
<a id="ln-941" name="ln-941" href="#ln-941"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-942" name="ln-942" href="#ln-942"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Absorption or Emission Spectrum           :  Both                         |&#39;</span><span class="w"></span>
<a id="ln-943" name="ln-943" href="#ln-943"></a><span class="w">      </span><span class="k">end if</span><span class="w"></span>
<a id="ln-944" name="ln-944" href="#ln-944"></a><span class="w">      </span><span class="c">! Write out if mizoguchi shift is applied</span>
<a id="ln-945" name="ln-945" href="#ln-945"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">core_chemical_shift</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0_dp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! mizoguchi shift not set</span>
<a id="ln-946" name="ln-946" href="#ln-946"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Core chemical shift                       :  None                         |&#39;</span><span class="w"></span>
<a id="ln-947" name="ln-947" href="#ln-947"></a><span class="w">      </span><span class="k">else</span><span class="w"> </span><span class="c">! It is set</span>
<a id="ln-948" name="ln-948" href="#ln-948"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Core chemical shift                       :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">core_chemical_shift</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-949" name="ln-949" href="#ln-949"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-950" name="ln-950" href="#ln-950"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">core_LAI_broadening</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-951" name="ln-951" href="#ln-951"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Include lifetime and Instrument Broadening:  True                         |&#39;</span><span class="w"></span>
<a id="ln-952" name="ln-952" href="#ln-952"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Gaussian Width                            :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">LAI_gaussian_width</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-953" name="ln-953" href="#ln-953"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Lorentzian Width                          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">LAI_lorentzian_width</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-954" name="ln-954" href="#ln-954"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Lorentzian Scale                          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">LAI_lorentzian_scale</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-955" name="ln-955" href="#ln-955"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Lorentzian Offset                         :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">LAI_lorentzian_offset</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-956" name="ln-956" href="#ln-956"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-957" name="ln-957" href="#ln-957"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Include lifetime and Instrument Broadening:  False                        |&#39;</span><span class="w"></span>
<a id="ln-958" name="ln-958" href="#ln-958"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-959" name="ln-959" href="#ln-959"></a><span class="k">    end if</span><span class="w"></span>
<a id="ln-960" name="ln-960" href="#ln-960"></a><span class="w">    </span><span class="c">! Added for Photoemission output - F. Mildner, 12/2022</span>
<a id="ln-961" name="ln-961" href="#ln-961"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-962" name="ln-962" href="#ln-962"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------- PHOTOEMISSION PARAMETERS ---------------------------+&#39;</span><span class="w"></span>
<a id="ln-963" name="ln-963" href="#ln-963"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1step&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-964" name="ln-964" href="#ln-964"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Model                       :     1-Step Model              |&#39;</span><span class="w"></span>
<a id="ln-965" name="ln-965" href="#ln-965"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Final State                 :     Free Electron State       |&#39;</span><span class="w"></span>
<a id="ln-966" name="ln-966" href="#ln-966"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;3step&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-967" name="ln-967" href="#ln-967"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Model                       :     3-Step Model              |&#39;</span><span class="w"></span>
<a id="ln-968" name="ln-968" href="#ln-968"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Final State                 :     Bloch State               |&#39;</span><span class="w"></span>
<a id="ln-969" name="ln-969" href="#ln-969"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ds_like_pe&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-970" name="ln-970" href="#ln-970"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photoemission Model                       :     Simplified PE Model       |&#39;</span><span class="w"></span>
<a id="ln-971" name="ln-971" href="#ln-971"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-972" name="ln-972" href="#ln-972"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">photo_photon_sweep</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-973" name="ln-973" href="#ln-973"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,a4,1f7.4,a10)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photon Energy Sweep                       :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_photon_min</span><span class="p">,&amp;</span><span class="w"></span>
<a id="ln-974" name="ln-974" href="#ln-974"></a><span class="w">                                                        </span><span class="p">&amp;</span><span class="w"> </span><span class="s1">&#39; -&gt; &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_photon_max</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; eV      |&#39;</span><span class="w"></span>
<a id="ln-975" name="ln-975" href="#ln-975"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-976" name="ln-976" href="#ln-976"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Photon Energy              (eV)           :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_photon_energy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-977" name="ln-977" href="#ln-977"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-978" name="ln-978" href="#ln-978"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Work Function              (eV)           :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_work_function</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-979" name="ln-979" href="#ln-979"></a><span class="w">      </span><span class="c">! write (stdout, &#39;(1x,a46,1x,1f10.4,20x,a1)&#39;) &#39;|  Surface Area               (Ang**2)       :&#39;, photo_surface_area, &#39;|&#39;</span>
<a id="ln-980" name="ln-980" href="#ln-980"></a><span class="w">      </span><span class="c">! write (stdout, &#39;(1x,a46,1x,1f10.4,20x,a1)&#39;) &#39;|  Slab Volume                (Ang**3)       :&#39;, photo_slab_volume, &#39;|&#39;</span>
<a id="ln-981" name="ln-981" href="#ln-981"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Slab Max Z-Coord.          (Ang)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_slab_max</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-982" name="ln-982" href="#ln-982"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Slab Min Z-Coord.          (Ang)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_slab_min</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-983" name="ln-983" href="#ln-983"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">photo_layer_choice</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-984" name="ln-984" href="#ln-984"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,2x,I4,25x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  User set maximal # of layers for calc.    :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_max_layer</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-985" name="ln-985" href="#ln-985"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-986" name="ln-986" href="#ln-986"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">photo_imfp_const</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-987" name="ln-987" href="#ln-987"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  IMFP Constant              (Ang)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_imfp_const</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-988" name="ln-988" href="#ln-988"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-989" name="ln-989" href="#ln-989"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  IMFP Constant              (Ang)          : Layer values provided by user |&#39;</span><span class="w"></span>
<a id="ln-990" name="ln-990" href="#ln-990"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|                                              values will be printed later  |&#39;</span><span class="w"></span>
<a id="ln-991" name="ln-991" href="#ln-991"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-992" name="ln-992" href="#ln-992"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,4x,E11.4,16x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Approx. Bulk P_escape Cutoff              :&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">photo_bulk_cutoff</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-993" name="ln-993" href="#ln-993"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">photo_elec_field</span><span class="w"> </span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="w"> </span><span class="mf">1.0E-4_dp</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">photo_elec_field</span><span class="w"> </span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="w"> </span><span class="mf">1.0E-25_dp</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-994" name="ln-994" href="#ln-994"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f10.4,20x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Electric Field Strength    (V/Ang)        :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_elec_field</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-995" name="ln-995" href="#ln-995"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-996" name="ln-996" href="#ln-996"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,E17.9,13x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Electric Field Strength    (V/Ang)        :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_elec_field</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-997" name="ln-997" href="#ln-997"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-998" name="ln-998" href="#ln-998"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f8.2,22x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Smearing Temperature       (K)            :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_temperature</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-999" name="ln-999" href="#ln-999"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,5x,a9,17x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Transverse Momentum Scheme                :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_momentum</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-1000" name="ln-1000" href="#ln-1000"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo_remove_box_states</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1001" name="ln-1001" href="#ln-1001"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Identify and remove box states            :     True                      |&#39;</span><span class="w"></span>
<a id="ln-1002" name="ln-1002" href="#ln-1002"></a><span class="w">      </span><span class="k">end if</span><span class="w"></span>
<a id="ln-1003" name="ln-1003" href="#ln-1003"></a><span class="w">      </span><span class="c">! TODO: Edit the output to reflect the changes made to the printing subroutines</span>
<a id="ln-1004" name="ln-1004" href="#ln-1004"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;slab&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1005" name="ln-1005" href="#ln-1005"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Writing Photoemission Matrix Elements     :     Atom Sites                |&#39;</span><span class="w"></span>
<a id="ln-1006" name="ln-1006" href="#ln-1006"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|          to *SEED*_matrix.dat ---------------------------------------------|&#39;</span><span class="w"></span>
<a id="ln-1007" name="ln-1007" href="#ln-1007"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1008" name="ln-1008" href="#ln-1008"></a><span class="k">        write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Writing Photoemission Matrix Elements     :     All Elements              |&#39;</span><span class="w"></span>
<a id="ln-1009" name="ln-1009" href="#ln-1009"></a><span class="w">        </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|          to *SEED*_matrix.dat ---------------------------------------------|&#39;</span><span class="w"></span>
<a id="ln-1010" name="ln-1010" href="#ln-1010"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1011" name="ln-1011" href="#ln-1011"></a><span class="k">      write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Emission Angle Bounds for writing to *SEED*_binding_energy.dat -----------|&#39;</span><span class="w"></span>
<a id="ln-1012" name="ln-1012" href="#ln-1012"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f8.2,22x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Theta    -lower -          (deg)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_theta_lower</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-1013" name="ln-1013" href="#ln-1013"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f8.2,22x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Theta    -upper -          (deg)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_theta_upper</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-1014" name="ln-1014" href="#ln-1014"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f8.2,22x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Phi      -lower -          (deg)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_phi_lower</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-1015" name="ln-1015" href="#ln-1015"></a><span class="w">      </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a46,1x,1f8.2,22x,a1)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;|  Phi      -upper -          (deg)          :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">photo_phi_upper</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;|&#39;</span><span class="w"></span>
<a id="ln-1016" name="ln-1016" href="#ln-1016"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1017" name="ln-1017" href="#ln-1017"></a><span class="k">    write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a78)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;+----------------------------------------------------------------------------+&#39;</span><span class="w"></span>
<a id="ln-1018" name="ln-1018" href="#ln-1018"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_exclude_bands</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a16,1x,999(1x,I3))&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;excluded_bands :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">exclude_bands</span><span class="p">(:)</span><span class="w"></span>
<a id="ln-1019" name="ln-1019" href="#ln-1019"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">devel_flag</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;AEIOUaeiou&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(1x,a12,1x,a100)&#39;</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39;devel_flag :&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">devel_flag</span><span class="w"></span>
<a id="ln-1020" name="ln-1020" href="#ln-1020"></a><span class="w">    </span><span class="k">write</span><span class="w"> </span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1021" name="ln-1021" href="#ln-1021"></a>
<a id="ln-1022" name="ln-1022" href="#ln-1022"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_write</span><span class="w"></span>
<a id="ln-1023" name="ln-1023" href="#ln-1023"></a>
<a id="ln-1024" name="ln-1024" href="#ln-1024"></a><span class="w">  </span><span class="c">!==================================================================!</span>
<a id="ln-1025" name="ln-1025" href="#ln-1025"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_dealloc</span><span class="w"></span>
<a id="ln-1026" name="ln-1026" href="#ln-1026"></a><span class="w">    </span><span class="c">!==================================================================!</span>
<a id="ln-1027" name="ln-1027" href="#ln-1027"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-1028" name="ln-1028" href="#ln-1028"></a><span class="w">    </span><span class="c">! release memory from allocated parameters                         !</span>
<a id="ln-1029" name="ln-1029" href="#ln-1029"></a><span class="w">    </span><span class="c">!                                                                  !</span>
<a id="ln-1030" name="ln-1030" href="#ln-1030"></a><span class="w">    </span><span class="c">!===================================================================</span>
<a id="ln-1031" name="ln-1031" href="#ln-1031"></a>
<a id="ln-1032" name="ln-1032" href="#ln-1032"></a><span class="w">    </span><span class="k">implicit none</span><span class="w"></span>
<a id="ln-1033" name="ln-1033" href="#ln-1033"></a>
<a id="ln-1034" name="ln-1034" href="#ln-1034"></a><span class="w">    </span><span class="c">!    if ( allocated ( ndimwin ) ) then</span>
<a id="ln-1035" name="ln-1035" href="#ln-1035"></a><span class="w">    </span><span class="c">!       ieallocate (  ndimwin, stat=ierr  )</span>
<a id="ln-1036" name="ln-1036" href="#ln-1036"></a><span class="w">    </span><span class="c">!       if (ierr/=0) call io_error(&#39;Error in deallocating ndimwin in param_dealloc&#39;)</span>
<a id="ln-1037" name="ln-1037" href="#ln-1037"></a><span class="w">    </span><span class="c">!    end if</span>
<a id="ln-1038" name="ln-1038" href="#ln-1038"></a><span class="w">    </span><span class="k">return</span>
<a id="ln-1039" name="ln-1039" href="#ln-1039"></a>
<a id="ln-1040" name="ln-1040" href="#ln-1040"></a><span class="k">  end subroutine </span><span class="n">param_dealloc</span><span class="w"></span>
<a id="ln-1041" name="ln-1041" href="#ln-1041"></a>
<a id="ln-1042" name="ln-1042" href="#ln-1042"></a><span class="w">  </span><span class="c">!=======================================!</span>
<a id="ln-1043" name="ln-1043" href="#ln-1043"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_in_file</span><span class="w"></span>
<a id="ln-1044" name="ln-1044" href="#ln-1044"></a><span class="w">    </span><span class="c">!=======================================!</span>
<a id="ln-1045" name="ln-1045" href="#ln-1045"></a><span class="w">    </span><span class="c">! Load the *.win file into a character  !</span>
<a id="ln-1046" name="ln-1046" href="#ln-1046"></a><span class="w">    </span><span class="c">! array in_file, ignoring comments and  !</span>
<a id="ln-1047" name="ln-1047" href="#ln-1047"></a><span class="w">    </span><span class="c">! blank lines and converting everything !</span>
<a id="ln-1048" name="ln-1048" href="#ln-1048"></a><span class="w">    </span><span class="c">! to lowercase characters               !</span>
<a id="ln-1049" name="ln-1049" href="#ln-1049"></a><span class="w">    </span><span class="c">!=======================================!</span>
<a id="ln-1050" name="ln-1050" href="#ln-1050"></a>
<a id="ln-1051" name="ln-1051" href="#ln-1051"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_file_unit</span><span class="p">,</span><span class="w"> </span><span class="n">io_error</span><span class="p">,</span><span class="w"> </span><span class="n">seedname</span><span class="p">,</span><span class="w"> </span><span class="k">options</span>
<a id="ln-1052" name="ln-1052" href="#ln-1052"></a><span class="k">    use </span><span class="n">od_algorithms</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">utility_lowercase</span><span class="w"></span>
<a id="ln-1053" name="ln-1053" href="#ln-1053"></a>
<a id="ln-1054" name="ln-1054" href="#ln-1054"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1055" name="ln-1055" href="#ln-1055"></a>
<a id="ln-1056" name="ln-1056" href="#ln-1056"></a><span class="k">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">in_unit</span><span class="p">,</span><span class="w"> </span><span class="n">tot_num_lines</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">,</span><span class="w"> </span><span class="n">line_counter</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">in1</span><span class="p">,</span><span class="w"> </span><span class="n">in2</span><span class="w"></span>
<a id="ln-1057" name="ln-1057" href="#ln-1057"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1058" name="ln-1058" href="#ln-1058"></a>
<a id="ln-1059" name="ln-1059" href="#ln-1059"></a><span class="w">    </span><span class="n">in_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">io_file_unit</span><span class="p">()</span><span class="w"></span>
<a id="ln-1060" name="ln-1060" href="#ln-1060"></a><span class="w">    </span><span class="k">open</span><span class="w"> </span><span class="p">(</span><span class="n">in_unit</span><span class="p">,</span><span class="w"> </span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">seedname</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.odi&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">form</span><span class="o">=</span><span class="s1">&#39;formatted&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span><span class="w"></span>
<a id="ln-1061" name="ln-1061" href="#ln-1061"></a><span class="w">    </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">tot_num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-1062" name="ln-1062" href="#ln-1062"></a><span class="w">    </span><span class="k">do</span>
<a id="ln-1063" name="ln-1063" href="#ln-1063"></a><span class="k">      read</span><span class="w"> </span><span class="p">(</span><span class="n">in_unit</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">210</span><span class="p">)</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1064" name="ln-1064" href="#ln-1064"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1065" name="ln-1065" href="#ln-1065"></a><span class="w">      </span><span class="n">tot_num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tot_num_lines</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1066" name="ln-1066" href="#ln-1066"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;!&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1067" name="ln-1067" href="#ln-1067"></a><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dummy</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num_lines</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1068" name="ln-1068" href="#ln-1068"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1069" name="ln-1069" href="#ln-1069"></a>
<a id="ln-1070" name="ln-1070" href="#ln-1070"></a><span class="k">    end do</span>
<a id="ln-1071" name="ln-1071" href="#ln-1071"></a>
<a id="ln-1072" name="ln-1072" href="#ln-1072"></a><span class="mi">101</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem opening input file &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">seedname</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.odi&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1073" name="ln-1073" href="#ln-1073"></a><span class="mi">200</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem reading input file &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">seedname</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;.odi&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1074" name="ln-1074" href="#ln-1074"></a><span class="mi">210</span><span class="w"> </span><span class="k">continue</span>
<a id="ln-1075" name="ln-1075" href="#ln-1075"></a><span class="k">    rewind</span><span class="w"> </span><span class="p">(</span><span class="n">in_unit</span><span class="p">)</span><span class="w"></span>
<a id="ln-1076" name="ln-1076" href="#ln-1076"></a>
<a id="ln-1077" name="ln-1077" href="#ln-1077"></a><span class="w">    </span><span class="k">allocate</span><span class="w"> </span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">num_lines</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-1078" name="ln-1078" href="#ln-1078"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error allocating in_data in param_in_file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1079" name="ln-1079" href="#ln-1079"></a>
<a id="ln-1080" name="ln-1080" href="#ln-1080"></a><span class="w">    </span><span class="n">line_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-1081" name="ln-1081" href="#ln-1081"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">tot_num_lines</span><span class="w"></span>
<a id="ln-1082" name="ln-1082" href="#ln-1082"></a><span class="w">      </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">in_unit</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1083" name="ln-1083" href="#ln-1083"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">utility_lowercase</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1084" name="ln-1084" href="#ln-1084"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1085" name="ln-1085" href="#ln-1085"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;!&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1086" name="ln-1086" href="#ln-1086"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">dummy</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1087" name="ln-1087" href="#ln-1087"></a><span class="k">      </span><span class="n">line_counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line_counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1088" name="ln-1088" href="#ln-1088"></a><span class="w">      </span><span class="n">in1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;!&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1089" name="ln-1089" href="#ln-1089"></a><span class="w">      </span><span class="n">in2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1090" name="ln-1090" href="#ln-1090"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_counter</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1091" name="ln-1091" href="#ln-1091"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_counter</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(:</span><span class="n">in2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1092" name="ln-1092" href="#ln-1092"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_counter</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(:</span><span class="n">in1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1093" name="ln-1093" href="#ln-1093"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_counter</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(:</span><span class="nb">min</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span><span class="w"> </span><span class="n">in2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1094" name="ln-1094" href="#ln-1094"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-1095" name="ln-1095" href="#ln-1095"></a>
<a id="ln-1096" name="ln-1096" href="#ln-1096"></a><span class="k">    close</span><span class="w"> </span><span class="p">(</span><span class="n">in_unit</span><span class="p">)</span><span class="w"></span>
<a id="ln-1097" name="ln-1097" href="#ln-1097"></a>
<a id="ln-1098" name="ln-1098" href="#ln-1098"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_in_file</span><span class="w"></span>
<a id="ln-1099" name="ln-1099" href="#ln-1099"></a>
<a id="ln-1100" name="ln-1100" href="#ln-1100"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_pdos</span><span class="w"></span>
<a id="ln-1101" name="ln-1101" href="#ln-1101"></a>
<a id="ln-1102" name="ln-1102" href="#ln-1102"></a><span class="w">    </span><span class="c">!    call param_get_block_length(&#39;projection&#39;,found,rows)</span>
<a id="ln-1103" name="ln-1103" href="#ln-1103"></a>
<a id="ln-1104" name="ln-1104" href="#ln-1104"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_get_pdos</span><span class="w"></span>
<a id="ln-1105" name="ln-1105" href="#ln-1105"></a>
<a id="ln-1106" name="ln-1106" href="#ln-1106"></a><span class="w">  </span><span class="c">!===========================================================================!</span>
<a id="ln-1107" name="ln-1107" href="#ln-1107"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_keyword</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="p">)</span><span class="w"></span>
<a id="ln-1108" name="ln-1108" href="#ln-1108"></a><span class="w">    </span><span class="c">!===========================================================================!</span>
<a id="ln-1109" name="ln-1109" href="#ln-1109"></a><span class="w">    </span><span class="c">!                                                                           !</span>
<a id="ln-1110" name="ln-1110" href="#ln-1110"></a><span class="w">    </span><span class="c">!             Finds the value of the required keyword.                      !</span>
<a id="ln-1111" name="ln-1111" href="#ln-1111"></a><span class="w">    </span><span class="c">!                                                                           !</span>
<a id="ln-1112" name="ln-1112" href="#ln-1112"></a><span class="w">    </span><span class="c">!===========================================================================!</span>
<a id="ln-1113" name="ln-1113" href="#ln-1113"></a>
<a id="ln-1114" name="ln-1114" href="#ln-1114"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1115" name="ln-1115" href="#ln-1115"></a>
<a id="ln-1116" name="ln-1116" href="#ln-1116"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1117" name="ln-1117" href="#ln-1117"></a>
<a id="ln-1118" name="ln-1118" href="#ln-1118"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1119" name="ln-1119" href="#ln-1119"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1120" name="ln-1120" href="#ln-1120"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_value</span><span class="w"></span>
<a id="ln-1121" name="ln-1121" href="#ln-1121"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">l_value</span><span class="w"></span>
<a id="ln-1122" name="ln-1122" href="#ln-1122"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i_value</span><span class="w"></span>
<a id="ln-1123" name="ln-1123" href="#ln-1123"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r_value</span><span class="w"></span>
<a id="ln-1124" name="ln-1124" href="#ln-1124"></a>
<a id="ln-1125" name="ln-1125" href="#ln-1125"></a><span class="w">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">kl</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">itmp</span><span class="w"></span>
<a id="ln-1126" name="ln-1126" href="#ln-1126"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1127" name="ln-1127" href="#ln-1127"></a>
<a id="ln-1128" name="ln-1128" href="#ln-1128"></a><span class="w">    </span><span class="n">kl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">len_trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1129" name="ln-1129" href="#ln-1129"></a>
<a id="ln-1130" name="ln-1130" href="#ln-1130"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1131" name="ln-1131" href="#ln-1131"></a>
<a id="ln-1132" name="ln-1132" href="#ln-1132"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1133" name="ln-1133" href="#ln-1133"></a><span class="w">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1134" name="ln-1134" href="#ln-1134"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1135" name="ln-1135" href="#ln-1135"></a><span class="k">      </span><span class="n">itmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1136" name="ln-1136" href="#ln-1136"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">itmp</span><span class="p">:</span><span class="n">itmp</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1137" name="ln-1137" href="#ln-1137"></a><span class="w">          </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">itmp</span><span class="p">:</span><span class="n">itmp</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1138" name="ln-1138" href="#ln-1138"></a><span class="w">          </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">itmp</span><span class="p">:</span><span class="n">itmp</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1139" name="ln-1139" href="#ln-1139"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1140" name="ln-1140" href="#ln-1140"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1141" name="ln-1141" href="#ln-1141"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1142" name="ln-1142" href="#ln-1142"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1143" name="ln-1143" href="#ln-1143"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">kl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1144" name="ln-1144" href="#ln-1144"></a><span class="w">      </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1145" name="ln-1145" href="#ln-1145"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1146" name="ln-1146" href="#ln-1146"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1147" name="ln-1147" href="#ln-1147"></a><span class="k">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1148" name="ln-1148" href="#ln-1148"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1149" name="ln-1149" href="#ln-1149"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1150" name="ln-1150" href="#ln-1150"></a><span class="k">    end do</span>
<a id="ln-1151" name="ln-1151" href="#ln-1151"></a>
<a id="ln-1152" name="ln-1152" href="#ln-1152"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1153" name="ln-1153" href="#ln-1153"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c_value</span><span class="p">))</span><span class="w"> </span><span class="n">c_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1154" name="ln-1154" href="#ln-1154"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">l_value</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1155" name="ln-1155" href="#ln-1155"></a><span class="k">        if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1156" name="ln-1156" href="#ln-1156"></a><span class="k">          </span><span class="n">l_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1157" name="ln-1157" href="#ln-1157"></a><span class="w">        </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;f&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1158" name="ln-1158" href="#ln-1158"></a><span class="k">          </span><span class="n">l_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1159" name="ln-1159" href="#ln-1159"></a><span class="w">        </span><span class="k">else</span>
<a id="ln-1160" name="ln-1160" href="#ln-1160"></a><span class="k">          call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem reading logical keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1161" name="ln-1161" href="#ln-1161"></a><span class="w">        </span><span class="k">end if</span>
<a id="ln-1162" name="ln-1162" href="#ln-1162"></a><span class="k">      end if</span>
<a id="ln-1163" name="ln-1163" href="#ln-1163"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span><span class="w"> </span><span class="n">i_value</span><span class="w"></span>
<a id="ln-1164" name="ln-1164" href="#ln-1164"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">r_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span><span class="w"> </span><span class="n">r_value</span><span class="w"></span>
<a id="ln-1165" name="ln-1165" href="#ln-1165"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1166" name="ln-1166" href="#ln-1166"></a>
<a id="ln-1167" name="ln-1167" href="#ln-1167"></a><span class="k">    return</span>
<a id="ln-1168" name="ln-1168" href="#ln-1168"></a>
<a id="ln-1169" name="ln-1169" href="#ln-1169"></a><span class="mi">220</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem reading keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1170" name="ln-1170" href="#ln-1170"></a>
<a id="ln-1171" name="ln-1171" href="#ln-1171"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_get_keyword</span><span class="w"></span>
<a id="ln-1172" name="ln-1172" href="#ln-1172"></a>
<a id="ln-1173" name="ln-1173" href="#ln-1173"></a><span class="w">  </span><span class="c">!===========================================================================!</span>
<a id="ln-1174" name="ln-1174" href="#ln-1174"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_efermi</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="p">)</span><span class="w"></span>
<a id="ln-1175" name="ln-1175" href="#ln-1175"></a><span class="w">    </span><span class="c">!===========================================================================!</span>
<a id="ln-1176" name="ln-1176" href="#ln-1176"></a><span class="w">    </span><span class="c">!                                                                           !</span>
<a id="ln-1177" name="ln-1177" href="#ln-1177"></a><span class="w">    </span><span class="c">!             Finds the value of the required keyword.                      !</span>
<a id="ln-1178" name="ln-1178" href="#ln-1178"></a><span class="w">    </span><span class="c">!                                                                           !</span>
<a id="ln-1179" name="ln-1179" href="#ln-1179"></a><span class="w">    </span><span class="c">!===========================================================================!</span>
<a id="ln-1180" name="ln-1180" href="#ln-1180"></a>
<a id="ln-1181" name="ln-1181" href="#ln-1181"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1182" name="ln-1182" href="#ln-1182"></a>
<a id="ln-1183" name="ln-1183" href="#ln-1183"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1184" name="ln-1184" href="#ln-1184"></a>
<a id="ln-1185" name="ln-1185" href="#ln-1185"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1186" name="ln-1186" href="#ln-1186"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1187" name="ln-1187" href="#ln-1187"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_value</span><span class="w"></span>
<a id="ln-1188" name="ln-1188" href="#ln-1188"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r_value</span><span class="w"></span>
<a id="ln-1189" name="ln-1189" href="#ln-1189"></a>
<a id="ln-1190" name="ln-1190" href="#ln-1190"></a><span class="w">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">kl</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">itmp</span><span class="w"></span>
<a id="ln-1191" name="ln-1191" href="#ln-1191"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1192" name="ln-1192" href="#ln-1192"></a>
<a id="ln-1193" name="ln-1193" href="#ln-1193"></a><span class="w">    </span><span class="n">kl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">len_trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1194" name="ln-1194" href="#ln-1194"></a>
<a id="ln-1195" name="ln-1195" href="#ln-1195"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1196" name="ln-1196" href="#ln-1196"></a>
<a id="ln-1197" name="ln-1197" href="#ln-1197"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1198" name="ln-1198" href="#ln-1198"></a><span class="w">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1199" name="ln-1199" href="#ln-1199"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1200" name="ln-1200" href="#ln-1200"></a><span class="k">      </span><span class="n">itmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1201" name="ln-1201" href="#ln-1201"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">itmp</span><span class="p">:</span><span class="n">itmp</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1202" name="ln-1202" href="#ln-1202"></a><span class="w">          </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">itmp</span><span class="p">:</span><span class="n">itmp</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1203" name="ln-1203" href="#ln-1203"></a><span class="w">          </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">itmp</span><span class="p">:</span><span class="n">itmp</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1204" name="ln-1204" href="#ln-1204"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1205" name="ln-1205" href="#ln-1205"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1206" name="ln-1206" href="#ln-1206"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1207" name="ln-1207" href="#ln-1207"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1208" name="ln-1208" href="#ln-1208"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">kl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1209" name="ln-1209" href="#ln-1209"></a><span class="w">      </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1210" name="ln-1210" href="#ln-1210"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1211" name="ln-1211" href="#ln-1211"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1212" name="ln-1212" href="#ln-1212"></a><span class="k">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1213" name="ln-1213" href="#ln-1213"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1214" name="ln-1214" href="#ln-1214"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1215" name="ln-1215" href="#ln-1215"></a><span class="k">    end do</span>
<a id="ln-1216" name="ln-1216" href="#ln-1216"></a>
<a id="ln-1217" name="ln-1217" href="#ln-1217"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1218" name="ln-1218" href="#ln-1218"></a><span class="k">      </span><span class="n">c_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1219" name="ln-1219" href="#ln-1219"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">c_value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;optados&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">c_value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">c_value</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;insulator&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1220" name="ln-1220" href="#ln-1220"></a><span class="k">        </span><span class="n">r_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">99</span><span class="mf">9.0_dp</span><span class="w"> </span><span class="c">! ie not set</span>
<a id="ln-1221" name="ln-1221" href="#ln-1221"></a><span class="w">      </span><span class="k">else</span><span class="w"></span>
<a id="ln-1222" name="ln-1222" href="#ln-1222"></a><span class="w">        </span><span class="c">! assume it is a number</span>
<a id="ln-1223" name="ln-1223" href="#ln-1223"></a><span class="w">        </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span><span class="w"> </span><span class="n">r_value</span><span class="w"></span>
<a id="ln-1224" name="ln-1224" href="#ln-1224"></a><span class="w">        </span><span class="n">c_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="w"></span>
<a id="ln-1225" name="ln-1225" href="#ln-1225"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1226" name="ln-1226" href="#ln-1226"></a><span class="k">    end if</span>
<a id="ln-1227" name="ln-1227" href="#ln-1227"></a>
<a id="ln-1228" name="ln-1228" href="#ln-1228"></a><span class="k">    return</span>
<a id="ln-1229" name="ln-1229" href="#ln-1229"></a>
<a id="ln-1230" name="ln-1230" href="#ln-1230"></a><span class="mi">220</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem reading keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1231" name="ln-1231" href="#ln-1231"></a>
<a id="ln-1232" name="ln-1232" href="#ln-1232"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_get_efermi</span><span class="w"></span>
<a id="ln-1233" name="ln-1233" href="#ln-1233"></a>
<a id="ln-1234" name="ln-1234" href="#ln-1234"></a><span class="w">  </span><span class="c">!=========================================================================================!</span>
<a id="ln-1235" name="ln-1235" href="#ln-1235"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_keyword_vector</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="p">)</span><span class="w"></span>
<a id="ln-1236" name="ln-1236" href="#ln-1236"></a><span class="w">    </span><span class="c">!=========================================================================================!</span>
<a id="ln-1237" name="ln-1237" href="#ln-1237"></a><span class="w">    </span><span class="c">!                                                                                         !</span>
<a id="ln-1238" name="ln-1238" href="#ln-1238"></a><span class="w">    </span><span class="c">!                  Finds the values of the required keyword vector                        !</span>
<a id="ln-1239" name="ln-1239" href="#ln-1239"></a><span class="w">    </span><span class="c">!                                                                                         !</span>
<a id="ln-1240" name="ln-1240" href="#ln-1240"></a><span class="w">    </span><span class="c">!=========================================================================================!</span>
<a id="ln-1241" name="ln-1241" href="#ln-1241"></a>
<a id="ln-1242" name="ln-1242" href="#ln-1242"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1243" name="ln-1243" href="#ln-1243"></a>
<a id="ln-1244" name="ln-1244" href="#ln-1244"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1245" name="ln-1245" href="#ln-1245"></a>
<a id="ln-1246" name="ln-1246" href="#ln-1246"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1247" name="ln-1247" href="#ln-1247"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1248" name="ln-1248" href="#ln-1248"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">length</span><span class="w"></span>
<a id="ln-1249" name="ln-1249" href="#ln-1249"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_value</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1250" name="ln-1250" href="#ln-1250"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">l_value</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1251" name="ln-1251" href="#ln-1251"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i_value</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1252" name="ln-1252" href="#ln-1252"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r_value</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1253" name="ln-1253" href="#ln-1253"></a>
<a id="ln-1254" name="ln-1254" href="#ln-1254"></a><span class="w">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">kl</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"></span>
<a id="ln-1255" name="ln-1255" href="#ln-1255"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1256" name="ln-1256" href="#ln-1256"></a>
<a id="ln-1257" name="ln-1257" href="#ln-1257"></a><span class="w">    </span><span class="n">kl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">len_trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1258" name="ln-1258" href="#ln-1258"></a>
<a id="ln-1259" name="ln-1259" href="#ln-1259"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1260" name="ln-1260" href="#ln-1260"></a>
<a id="ln-1261" name="ln-1261" href="#ln-1261"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1262" name="ln-1262" href="#ln-1262"></a><span class="w">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1263" name="ln-1263" href="#ln-1263"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1264" name="ln-1264" href="#ln-1264"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1265" name="ln-1265" href="#ln-1265"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1266" name="ln-1266" href="#ln-1266"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1267" name="ln-1267" href="#ln-1267"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1268" name="ln-1268" href="#ln-1268"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">kl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1269" name="ln-1269" href="#ln-1269"></a><span class="w">      </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1270" name="ln-1270" href="#ln-1270"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1271" name="ln-1271" href="#ln-1271"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1272" name="ln-1272" href="#ln-1272"></a><span class="k">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1273" name="ln-1273" href="#ln-1273"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1274" name="ln-1274" href="#ln-1274"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1275" name="ln-1275" href="#ln-1275"></a><span class="k">    end do</span>
<a id="ln-1276" name="ln-1276" href="#ln-1276"></a>
<a id="ln-1277" name="ln-1277" href="#ln-1277"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1278" name="ln-1278" href="#ln-1278"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">230</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">c_value</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1279" name="ln-1279" href="#ln-1279"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">l_value</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<a id="ln-1280" name="ln-1280" href="#ln-1280"></a><span class="w">        </span><span class="c">! I don&#39;t think we need this. Maybe read into a dummy charater</span>
<a id="ln-1281" name="ln-1281" href="#ln-1281"></a><span class="w">        </span><span class="c">! array and convert each element to logical</span>
<a id="ln-1282" name="ln-1282" href="#ln-1282"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1283" name="ln-1283" href="#ln-1283"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">230</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">i_value</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1284" name="ln-1284" href="#ln-1284"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">r_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">230</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">230</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">r_value</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1285" name="ln-1285" href="#ln-1285"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1286" name="ln-1286" href="#ln-1286"></a>
<a id="ln-1287" name="ln-1287" href="#ln-1287"></a><span class="k">    return</span>
<a id="ln-1288" name="ln-1288" href="#ln-1288"></a>
<a id="ln-1289" name="ln-1289" href="#ln-1289"></a><span class="mi">230</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem reading keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; in param_get_keyword_vector&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1290" name="ln-1290" href="#ln-1290"></a>
<a id="ln-1291" name="ln-1291" href="#ln-1291"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_get_keyword_vector</span><span class="w"></span>
<a id="ln-1292" name="ln-1292" href="#ln-1292"></a>
<a id="ln-1293" name="ln-1293" href="#ln-1293"></a><span class="w">  </span><span class="c">!========================================================!</span>
<a id="ln-1294" name="ln-1294" href="#ln-1294"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_vector_length</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1295" name="ln-1295" href="#ln-1295"></a><span class="w">    </span><span class="c">!======================================================!</span>
<a id="ln-1296" name="ln-1296" href="#ln-1296"></a><span class="w">    </span><span class="c">!                                                      !</span>
<a id="ln-1297" name="ln-1297" href="#ln-1297"></a><span class="w">    </span><span class="c">!        Returns the length of a keyword vector        !</span>
<a id="ln-1298" name="ln-1298" href="#ln-1298"></a><span class="w">    </span><span class="c">!                                                      !</span>
<a id="ln-1299" name="ln-1299" href="#ln-1299"></a><span class="w">    </span><span class="c">!======================================================!</span>
<a id="ln-1300" name="ln-1300" href="#ln-1300"></a>
<a id="ln-1301" name="ln-1301" href="#ln-1301"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1302" name="ln-1302" href="#ln-1302"></a>
<a id="ln-1303" name="ln-1303" href="#ln-1303"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1304" name="ln-1304" href="#ln-1304"></a>
<a id="ln-1305" name="ln-1305" href="#ln-1305"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1306" name="ln-1306" href="#ln-1306"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1307" name="ln-1307" href="#ln-1307"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">length</span><span class="w"></span>
<a id="ln-1308" name="ln-1308" href="#ln-1308"></a>
<a id="ln-1309" name="ln-1309" href="#ln-1309"></a><span class="w">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">kl</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">pos</span><span class="w"></span>
<a id="ln-1310" name="ln-1310" href="#ln-1310"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1311" name="ln-1311" href="#ln-1311"></a>
<a id="ln-1312" name="ln-1312" href="#ln-1312"></a><span class="w">    </span><span class="n">kl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">len_trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1313" name="ln-1313" href="#ln-1313"></a>
<a id="ln-1314" name="ln-1314" href="#ln-1314"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1315" name="ln-1315" href="#ln-1315"></a>
<a id="ln-1316" name="ln-1316" href="#ln-1316"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1317" name="ln-1317" href="#ln-1317"></a><span class="w">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1318" name="ln-1318" href="#ln-1318"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1319" name="ln-1319" href="#ln-1319"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1320" name="ln-1320" href="#ln-1320"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1321" name="ln-1321" href="#ln-1321"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1322" name="ln-1322" href="#ln-1322"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1323" name="ln-1323" href="#ln-1323"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">kl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1324" name="ln-1324" href="#ln-1324"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1325" name="ln-1325" href="#ln-1325"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1326" name="ln-1326" href="#ln-1326"></a><span class="k">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1327" name="ln-1327" href="#ln-1327"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1328" name="ln-1328" href="#ln-1328"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1329" name="ln-1329" href="#ln-1329"></a><span class="k">    end do</span>
<a id="ln-1330" name="ln-1330" href="#ln-1330"></a>
<a id="ln-1331" name="ln-1331" href="#ln-1331"></a><span class="k">    </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-1332" name="ln-1332" href="#ln-1332"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1333" name="ln-1333" href="#ln-1333"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; is blank&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1334" name="ln-1334" href="#ln-1334"></a><span class="w">      </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1335" name="ln-1335" href="#ln-1335"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1336" name="ln-1336" href="#ln-1336"></a><span class="w">      </span><span class="k">do</span>
<a id="ln-1337" name="ln-1337" href="#ln-1337"></a><span class="k">        </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1338" name="ln-1338" href="#ln-1338"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1339" name="ln-1339" href="#ln-1339"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1340" name="ln-1340" href="#ln-1340"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1341" name="ln-1341" href="#ln-1341"></a><span class="k">          </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1342" name="ln-1342" href="#ln-1342"></a><span class="w">        </span><span class="k">else</span>
<a id="ln-1343" name="ln-1343" href="#ln-1343"></a><span class="k">          exit</span>
<a id="ln-1344" name="ln-1344" href="#ln-1344"></a><span class="k">        end if</span>
<a id="ln-1345" name="ln-1345" href="#ln-1345"></a>
<a id="ln-1346" name="ln-1346" href="#ln-1346"></a><span class="k">      end do</span>
<a id="ln-1347" name="ln-1347" href="#ln-1347"></a>
<a id="ln-1348" name="ln-1348" href="#ln-1348"></a><span class="k">    end if</span>
<a id="ln-1349" name="ln-1349" href="#ln-1349"></a>
<a id="ln-1350" name="ln-1350" href="#ln-1350"></a><span class="k">    return</span>
<a id="ln-1351" name="ln-1351" href="#ln-1351"></a>
<a id="ln-1352" name="ln-1352" href="#ln-1352"></a><span class="k">  end subroutine </span><span class="n">param_get_vector_length</span><span class="w"></span>
<a id="ln-1353" name="ln-1353" href="#ln-1353"></a>
<a id="ln-1354" name="ln-1354" href="#ln-1354"></a><span class="w">  </span><span class="c">!==============================================================================================!</span>
<a id="ln-1355" name="ln-1355" href="#ln-1355"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_keyword_block</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">c_value</span><span class="p">,</span><span class="w"> </span><span class="n">l_value</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="p">,</span><span class="w"> </span><span class="n">r_value</span><span class="p">)</span><span class="w"></span>
<a id="ln-1356" name="ln-1356" href="#ln-1356"></a><span class="w">    </span><span class="c">!==============================================================================================!</span>
<a id="ln-1357" name="ln-1357" href="#ln-1357"></a><span class="w">    </span><span class="c">!                                                                                              !</span>
<a id="ln-1358" name="ln-1358" href="#ln-1358"></a><span class="w">    </span><span class="c">!                           Finds the values of the required data block                        !</span>
<a id="ln-1359" name="ln-1359" href="#ln-1359"></a><span class="w">    </span><span class="c">!                                                                                              !</span>
<a id="ln-1360" name="ln-1360" href="#ln-1360"></a><span class="w">    </span><span class="c">!==============================================================================================!</span>
<a id="ln-1361" name="ln-1361" href="#ln-1361"></a>
<a id="ln-1362" name="ln-1362" href="#ln-1362"></a><span class="w">    </span><span class="k">use </span><span class="n">od_constants</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">bohr2ang</span><span class="w"></span>
<a id="ln-1363" name="ln-1363" href="#ln-1363"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1364" name="ln-1364" href="#ln-1364"></a>
<a id="ln-1365" name="ln-1365" href="#ln-1365"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1366" name="ln-1366" href="#ln-1366"></a>
<a id="ln-1367" name="ln-1367" href="#ln-1367"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1368" name="ln-1368" href="#ln-1368"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1369" name="ln-1369" href="#ln-1369"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">rows</span><span class="w"></span>
<a id="ln-1370" name="ln-1370" href="#ln-1370"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">columns</span><span class="w"></span>
<a id="ln-1371" name="ln-1371" href="#ln-1371"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_value</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"></span>
<a id="ln-1372" name="ln-1372" href="#ln-1372"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">l_value</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"></span>
<a id="ln-1373" name="ln-1373" href="#ln-1373"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i_value</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"></span>
<a id="ln-1374" name="ln-1374" href="#ln-1374"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">r_value</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"></span>
<a id="ln-1375" name="ln-1375" href="#ln-1375"></a>
<a id="ln-1376" name="ln-1376" href="#ln-1376"></a><span class="w">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">ins</span><span class="p">,</span><span class="w"> </span><span class="n">ine</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">line_e</span><span class="p">,</span><span class="w"> </span><span class="n">line_s</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="n">blen</span><span class="w"></span>
<a id="ln-1377" name="ln-1377" href="#ln-1377"></a><span class="w">    </span><span class="kt">logical</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">found_e</span><span class="p">,</span><span class="w"> </span><span class="n">found_s</span><span class="p">,</span><span class="w"> </span><span class="n">lconvert</span><span class="w"></span>
<a id="ln-1378" name="ln-1378" href="#ln-1378"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">end_st</span><span class="p">,</span><span class="w"> </span><span class="n">start_st</span><span class="w"></span>
<a id="ln-1379" name="ln-1379" href="#ln-1379"></a>
<a id="ln-1380" name="ln-1380" href="#ln-1380"></a><span class="w">    </span><span class="n">found_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1381" name="ln-1381" href="#ln-1381"></a><span class="w">    </span><span class="n">found_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1382" name="ln-1382" href="#ln-1382"></a>
<a id="ln-1383" name="ln-1383" href="#ln-1383"></a><span class="w">    </span><span class="n">start_st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;begin &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1384" name="ln-1384" href="#ln-1384"></a><span class="w">    </span><span class="n">end_st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;end &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1385" name="ln-1385" href="#ln-1385"></a>
<a id="ln-1386" name="ln-1386" href="#ln-1386"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1387" name="ln-1387" href="#ln-1387"></a><span class="w">      </span><span class="n">ins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1388" name="ln-1388" href="#ln-1388"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ins</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1389" name="ln-1389" href="#ln-1389"></a><span class="k">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;begin&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1390" name="ln-1390" href="#ln-1390"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1391" name="ln-1391" href="#ln-1391"></a><span class="k">      </span><span class="n">line_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop</span><span class="w"></span>
<a id="ln-1392" name="ln-1392" href="#ln-1392"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1393" name="ln-1393" href="#ln-1393"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">start_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1394" name="ln-1394" href="#ln-1394"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1395" name="ln-1395" href="#ln-1395"></a><span class="k">      </span><span class="n">found_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1396" name="ln-1396" href="#ln-1396"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-1397" name="ln-1397" href="#ln-1397"></a>
<a id="ln-1398" name="ln-1398" href="#ln-1398"></a><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found_s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1399" name="ln-1399" href="#ln-1399"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1400" name="ln-1400" href="#ln-1400"></a><span class="w">      </span><span class="k">return</span>
<a id="ln-1401" name="ln-1401" href="#ln-1401"></a><span class="k">    end if</span>
<a id="ln-1402" name="ln-1402" href="#ln-1402"></a>
<a id="ln-1403" name="ln-1403" href="#ln-1403"></a><span class="k">    do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1404" name="ln-1404" href="#ln-1404"></a><span class="w">      </span><span class="n">ine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1405" name="ln-1405" href="#ln-1405"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ine</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1406" name="ln-1406" href="#ln-1406"></a><span class="k">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1407" name="ln-1407" href="#ln-1407"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1408" name="ln-1408" href="#ln-1408"></a><span class="k">      </span><span class="n">line_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop</span><span class="w"></span>
<a id="ln-1409" name="ln-1409" href="#ln-1409"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_e</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1410" name="ln-1410" href="#ln-1410"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">end_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1411" name="ln-1411" href="#ln-1411"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1412" name="ln-1412" href="#ln-1412"></a><span class="k">      </span><span class="n">found_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1413" name="ln-1413" href="#ln-1413"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-1414" name="ln-1414" href="#ln-1414"></a>
<a id="ln-1415" name="ln-1415" href="#ln-1415"></a><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found_e</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1416" name="ln-1416" href="#ln-1416"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">start_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; but no &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">end_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1417" name="ln-1417" href="#ln-1417"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1418" name="ln-1418" href="#ln-1418"></a>
<a id="ln-1419" name="ln-1419" href="#ln-1419"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">line_e</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">line_s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1420" name="ln-1420" href="#ln-1420"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">end_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; comes before &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">start_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1421" name="ln-1421" href="#ln-1421"></a><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<a id="ln-1422" name="ln-1422" href="#ln-1422"></a>
<a id="ln-1423" name="ln-1423" href="#ln-1423"></a><span class="w">    </span><span class="c">! number of lines of data in block</span>
<a id="ln-1424" name="ln-1424" href="#ln-1424"></a><span class="w">    </span><span class="n">blen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line_e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">line_s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1425" name="ln-1425" href="#ln-1425"></a>
<a id="ln-1426" name="ln-1426" href="#ln-1426"></a><span class="w">    </span><span class="c">!    if( blen /= rows) then</span>
<a id="ln-1427" name="ln-1427" href="#ln-1427"></a><span class="w">    </span><span class="c">!       if ( index(trim(keyword),&#39;unit_cell_cart&#39;).ne.0 ) then</span>
<a id="ln-1428" name="ln-1428" href="#ln-1428"></a><span class="w">    </span><span class="c">!          if ( blen /= rows+1 ) call io_error(&#39;Error: Wrong number of lines in block &#39;//trim(keyword))</span>
<a id="ln-1429" name="ln-1429" href="#ln-1429"></a><span class="w">    </span><span class="c">!       else</span>
<a id="ln-1430" name="ln-1430" href="#ln-1430"></a><span class="w">    </span><span class="c">!          call io_error(&#39;Error: Wrong number of lines in block &#39;//trim(keyword))</span>
<a id="ln-1431" name="ln-1431" href="#ln-1431"></a><span class="w">    </span><span class="c">!       endif</span>
<a id="ln-1432" name="ln-1432" href="#ln-1432"></a><span class="w">    </span><span class="c">!    endif</span>
<a id="ln-1433" name="ln-1433" href="#ln-1433"></a>
<a id="ln-1434" name="ln-1434" href="#ln-1434"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">blen</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="n">rows</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">blen</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1435" name="ln-1435" href="#ln-1435"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Wrong number of lines in block &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1436" name="ln-1436" href="#ln-1436"></a>
<a id="ln-1437" name="ln-1437" href="#ln-1437"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">blen</span><span class="w"> </span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;unit_cell_cart&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1438" name="ln-1438" href="#ln-1438"></a><span class="w">      </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Wrong number of lines in block &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1439" name="ln-1439" href="#ln-1439"></a>
<a id="ln-1440" name="ln-1440" href="#ln-1440"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1441" name="ln-1441" href="#ln-1441"></a>
<a id="ln-1442" name="ln-1442" href="#ln-1442"></a><span class="w">    </span><span class="n">lconvert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1443" name="ln-1443" href="#ln-1443"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">blen</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rows</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1444" name="ln-1444" href="#ln-1444"></a><span class="k">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1445" name="ln-1445" href="#ln-1445"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ang&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1446" name="ln-1446" href="#ln-1446"></a><span class="k">        </span><span class="n">lconvert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1447" name="ln-1447" href="#ln-1447"></a><span class="w">      </span><span class="n">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bohr&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1448" name="ln-1448" href="#ln-1448"></a><span class="k">        </span><span class="n">lconvert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1449" name="ln-1449" href="#ln-1449"></a><span class="w">      </span><span class="k">else</span>
<a id="ln-1450" name="ln-1450" href="#ln-1450"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Units in block &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; not recognised&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1451" name="ln-1451" href="#ln-1451"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1452" name="ln-1452" href="#ln-1452"></a><span class="k">      </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_s</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1453" name="ln-1453" href="#ln-1453"></a><span class="w">      </span><span class="n">line_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line_s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1454" name="ln-1454" href="#ln-1454"></a><span class="w">    </span><span class="k">end if</span><span class="w"></span>
<a id="ln-1455" name="ln-1455" href="#ln-1455"></a>
<a id="ln-1456" name="ln-1456" href="#ln-1456"></a><span class="w">    </span><span class="c">!    r_value=1.0_dp</span>
<a id="ln-1457" name="ln-1457" href="#ln-1457"></a><span class="w">    </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-1458" name="ln-1458" href="#ln-1458"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line_s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">line_e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1459" name="ln-1459" href="#ln-1459"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"></span>
<a id="ln-1460" name="ln-1460" href="#ln-1460"></a><span class="w">      </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1461" name="ln-1461" href="#ln-1461"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">c_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="p">)</span><span class="w"></span>
<a id="ln-1462" name="ln-1462" href="#ln-1462"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">l_value</span><span class="p">))</span><span class="w"> </span><span class="k">then</span><span class="w"></span>
<a id="ln-1463" name="ln-1463" href="#ln-1463"></a><span class="w">        </span><span class="c">! I don&#39;t think we need this. Maybe read into a dummy charater</span>
<a id="ln-1464" name="ln-1464" href="#ln-1464"></a><span class="w">        </span><span class="c">! array and convert each element to logical</span>
<a id="ln-1465" name="ln-1465" href="#ln-1465"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1466" name="ln-1466" href="#ln-1466"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">i_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">i_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="p">)</span><span class="w"></span>
<a id="ln-1467" name="ln-1467" href="#ln-1467"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">r_value</span><span class="p">))</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">240</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">r_value</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">columns</span><span class="p">)</span><span class="w"></span>
<a id="ln-1468" name="ln-1468" href="#ln-1468"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-1469" name="ln-1469" href="#ln-1469"></a>
<a id="ln-1470" name="ln-1470" href="#ln-1470"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">lconvert</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1471" name="ln-1471" href="#ln-1471"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">r_value</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1472" name="ln-1472" href="#ln-1472"></a><span class="k">        </span><span class="n">r_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_value</span><span class="o">*</span><span class="n">bohr2ang</span><span class="w"></span>
<a id="ln-1473" name="ln-1473" href="#ln-1473"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1474" name="ln-1474" href="#ln-1474"></a><span class="k">    end if</span>
<a id="ln-1475" name="ln-1475" href="#ln-1475"></a>
<a id="ln-1476" name="ln-1476" href="#ln-1476"></a><span class="k">    </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_s</span><span class="p">:</span><span class="n">line_e</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1477" name="ln-1477" href="#ln-1477"></a>
<a id="ln-1478" name="ln-1478" href="#ln-1478"></a><span class="w">    </span><span class="k">return</span>
<a id="ln-1479" name="ln-1479" href="#ln-1479"></a>
<a id="ln-1480" name="ln-1480" href="#ln-1480"></a><span class="mi">240</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Problem reading block keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1481" name="ln-1481" href="#ln-1481"></a>
<a id="ln-1482" name="ln-1482" href="#ln-1482"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_get_keyword_block</span><span class="w"></span>
<a id="ln-1483" name="ln-1483" href="#ln-1483"></a>
<a id="ln-1484" name="ln-1484" href="#ln-1484"></a><span class="w">  </span><span class="c">!=====================================================!</span>
<a id="ln-1485" name="ln-1485" href="#ln-1485"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_block_length</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">rows</span><span class="p">,</span><span class="w"> </span><span class="n">lunits</span><span class="p">)</span><span class="w"></span>
<a id="ln-1486" name="ln-1486" href="#ln-1486"></a><span class="w">    </span><span class="c">!=====================================================!</span>
<a id="ln-1487" name="ln-1487" href="#ln-1487"></a><span class="w">    </span><span class="c">!                                                     !</span>
<a id="ln-1488" name="ln-1488" href="#ln-1488"></a><span class="w">    </span><span class="c">!       Finds the length of the data block            !</span>
<a id="ln-1489" name="ln-1489" href="#ln-1489"></a><span class="w">    </span><span class="c">!                                                     !</span>
<a id="ln-1490" name="ln-1490" href="#ln-1490"></a><span class="w">    </span><span class="c">!=====================================================!</span>
<a id="ln-1491" name="ln-1491" href="#ln-1491"></a>
<a id="ln-1492" name="ln-1492" href="#ln-1492"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1493" name="ln-1493" href="#ln-1493"></a>
<a id="ln-1494" name="ln-1494" href="#ln-1494"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1495" name="ln-1495" href="#ln-1495"></a>
<a id="ln-1496" name="ln-1496" href="#ln-1496"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1497" name="ln-1497" href="#ln-1497"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1498" name="ln-1498" href="#ln-1498"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rows</span><span class="w"></span>
<a id="ln-1499" name="ln-1499" href="#ln-1499"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lunits</span><span class="w"></span>
<a id="ln-1500" name="ln-1500" href="#ln-1500"></a>
<a id="ln-1501" name="ln-1501" href="#ln-1501"></a><span class="w">    </span><span class="kt">integer</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">ins</span><span class="p">,</span><span class="w"> </span><span class="n">ine</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">line_e</span><span class="p">,</span><span class="w"> </span><span class="n">line_s</span><span class="w"></span>
<a id="ln-1502" name="ln-1502" href="#ln-1502"></a><span class="w">    </span><span class="kt">logical</span><span class="w">           </span><span class="kd">::</span><span class="w"> </span><span class="n">found_e</span><span class="p">,</span><span class="w"> </span><span class="n">found_s</span><span class="w"></span>
<a id="ln-1503" name="ln-1503" href="#ln-1503"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">end_st</span><span class="p">,</span><span class="w"> </span><span class="n">start_st</span><span class="p">,</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1504" name="ln-1504" href="#ln-1504"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">atsym</span><span class="w"></span>
<a id="ln-1505" name="ln-1505" href="#ln-1505"></a><span class="w">    </span><span class="kt">real</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">dp</span><span class="p">)</span><span class="w">     </span><span class="kd">::</span><span class="w"> </span><span class="n">atpos</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-1506" name="ln-1506" href="#ln-1506"></a>
<a id="ln-1507" name="ln-1507" href="#ln-1507"></a><span class="w">    </span><span class="n">found_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1508" name="ln-1508" href="#ln-1508"></a><span class="w">    </span><span class="n">found_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1509" name="ln-1509" href="#ln-1509"></a>
<a id="ln-1510" name="ln-1510" href="#ln-1510"></a><span class="w">    </span><span class="n">start_st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;begin &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1511" name="ln-1511" href="#ln-1511"></a><span class="w">    </span><span class="n">end_st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;end &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1512" name="ln-1512" href="#ln-1512"></a>
<a id="ln-1513" name="ln-1513" href="#ln-1513"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1514" name="ln-1514" href="#ln-1514"></a><span class="w">      </span><span class="n">ins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1515" name="ln-1515" href="#ln-1515"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ins</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1516" name="ln-1516" href="#ln-1516"></a><span class="k">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;begin&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1517" name="ln-1517" href="#ln-1517"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1518" name="ln-1518" href="#ln-1518"></a><span class="k">      </span><span class="n">line_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop</span><span class="w"></span>
<a id="ln-1519" name="ln-1519" href="#ln-1519"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1520" name="ln-1520" href="#ln-1520"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">start_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1521" name="ln-1521" href="#ln-1521"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1522" name="ln-1522" href="#ln-1522"></a><span class="k">      </span><span class="n">found_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1523" name="ln-1523" href="#ln-1523"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-1524" name="ln-1524" href="#ln-1524"></a>
<a id="ln-1525" name="ln-1525" href="#ln-1525"></a><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found_s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1526" name="ln-1526" href="#ln-1526"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1527" name="ln-1527" href="#ln-1527"></a><span class="w">      </span><span class="k">return</span>
<a id="ln-1528" name="ln-1528" href="#ln-1528"></a><span class="k">    end if</span>
<a id="ln-1529" name="ln-1529" href="#ln-1529"></a>
<a id="ln-1530" name="ln-1530" href="#ln-1530"></a><span class="k">    do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1531" name="ln-1531" href="#ln-1531"></a><span class="w">      </span><span class="n">ine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1532" name="ln-1532" href="#ln-1532"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ine</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1533" name="ln-1533" href="#ln-1533"></a><span class="k">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;end&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1534" name="ln-1534" href="#ln-1534"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1535" name="ln-1535" href="#ln-1535"></a><span class="k">      </span><span class="n">line_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop</span><span class="w"></span>
<a id="ln-1536" name="ln-1536" href="#ln-1536"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">found_e</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1537" name="ln-1537" href="#ln-1537"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">end_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1538" name="ln-1538" href="#ln-1538"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1539" name="ln-1539" href="#ln-1539"></a><span class="k">      </span><span class="n">found_e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1540" name="ln-1540" href="#ln-1540"></a><span class="w">    </span><span class="k">end do</span>
<a id="ln-1541" name="ln-1541" href="#ln-1541"></a>
<a id="ln-1542" name="ln-1542" href="#ln-1542"></a><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found_e</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1543" name="ln-1543" href="#ln-1543"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">start_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; but no &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">end_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1544" name="ln-1544" href="#ln-1544"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1545" name="ln-1545" href="#ln-1545"></a>
<a id="ln-1546" name="ln-1546" href="#ln-1546"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">line_e</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">line_s</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1547" name="ln-1547" href="#ln-1547"></a><span class="k">      call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">end_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; comes before &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">start_st</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1548" name="ln-1548" href="#ln-1548"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1549" name="ln-1549" href="#ln-1549"></a>
<a id="ln-1550" name="ln-1550" href="#ln-1550"></a><span class="k">    </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line_e</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">line_s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1551" name="ln-1551" href="#ln-1551"></a>
<a id="ln-1552" name="ln-1552" href="#ln-1552"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1553" name="ln-1553" href="#ln-1553"></a>
<a id="ln-1554" name="ln-1554" href="#ln-1554"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lunits</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1555" name="ln-1555" href="#ln-1555"></a><span class="k">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1556" name="ln-1556" href="#ln-1556"></a><span class="w">      </span><span class="c">!       write(stdout,*) dummy</span>
<a id="ln-1557" name="ln-1557" href="#ln-1557"></a><span class="w">      </span><span class="c">!       write(stdout,*) trim(dummy)</span>
<a id="ln-1558" name="ln-1558" href="#ln-1558"></a><span class="w">      </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">555</span><span class="p">)</span><span class="w"> </span><span class="n">atsym</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">atpos</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-1559" name="ln-1559" href="#ln-1559"></a><span class="w">      </span><span class="n">lunits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1560" name="ln-1560" href="#ln-1560"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1561" name="ln-1561" href="#ln-1561"></a>
<a id="ln-1562" name="ln-1562" href="#ln-1562"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">!cope with empty blocks</span>
<a id="ln-1563" name="ln-1563" href="#ln-1563"></a><span class="w">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1564" name="ln-1564" href="#ln-1564"></a><span class="w">      </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_s</span><span class="p">:</span><span class="n">line_e</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1565" name="ln-1565" href="#ln-1565"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1566" name="ln-1566" href="#ln-1566"></a>
<a id="ln-1567" name="ln-1567" href="#ln-1567"></a><span class="k">    return</span>
<a id="ln-1568" name="ln-1568" href="#ln-1568"></a>
<a id="ln-1569" name="ln-1569" href="#ln-1569"></a><span class="mi">555</span><span class="w"> </span><span class="n">lunits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1570" name="ln-1570" href="#ln-1570"></a>
<a id="ln-1571" name="ln-1571" href="#ln-1571"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rows</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">!cope with empty blocks</span>
<a id="ln-1572" name="ln-1572" href="#ln-1572"></a><span class="w">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1573" name="ln-1573" href="#ln-1573"></a><span class="w">      </span><span class="n">in_data</span><span class="p">(</span><span class="n">line_s</span><span class="p">:</span><span class="n">line_e</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1574" name="ln-1574" href="#ln-1574"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1575" name="ln-1575" href="#ln-1575"></a>
<a id="ln-1576" name="ln-1576" href="#ln-1576"></a><span class="k">    return</span>
<a id="ln-1577" name="ln-1577" href="#ln-1577"></a>
<a id="ln-1578" name="ln-1578" href="#ln-1578"></a><span class="k">  end subroutine </span><span class="n">param_get_block_length</span><span class="w"></span>
<a id="ln-1579" name="ln-1579" href="#ln-1579"></a>
<a id="ln-1580" name="ln-1580" href="#ln-1580"></a><span class="w">  </span><span class="c">!====================================================================!</span>
<a id="ln-1581" name="ln-1581" href="#ln-1581"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_get_range_vector</span><span class="p">(</span><span class="n">keyword</span><span class="p">,</span><span class="w"> </span><span class="n">found</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">lcount</span><span class="p">,</span><span class="w"> </span><span class="n">i_value</span><span class="p">)</span><span class="w"></span>
<a id="ln-1582" name="ln-1582" href="#ln-1582"></a><span class="w">    </span><span class="c">!====================================================================!</span>
<a id="ln-1583" name="ln-1583" href="#ln-1583"></a><span class="w">    </span><span class="c">!   Read a range vector eg. 1,2,3,4-10  or 1 3 400:100               !</span>
<a id="ln-1584" name="ln-1584" href="#ln-1584"></a><span class="w">    </span><span class="c">!   if(lcount) we return the number of states in length              !</span>
<a id="ln-1585" name="ln-1585" href="#ln-1585"></a><span class="w">    </span><span class="c">!====================================================================!</span>
<a id="ln-1586" name="ln-1586" href="#ln-1586"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1587" name="ln-1587" href="#ln-1587"></a>
<a id="ln-1588" name="ln-1588" href="#ln-1588"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1589" name="ln-1589" href="#ln-1589"></a>
<a id="ln-1590" name="ln-1590" href="#ln-1590"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">keyword</span><span class="w"></span>
<a id="ln-1591" name="ln-1591" href="#ln-1591"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">found</span><span class="w"></span>
<a id="ln-1592" name="ln-1592" href="#ln-1592"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">length</span><span class="w"></span>
<a id="ln-1593" name="ln-1593" href="#ln-1593"></a><span class="w">    </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">    </span><span class="kd">::</span><span class="w"> </span><span class="n">lcount</span><span class="w"></span>
<a id="ln-1594" name="ln-1594" href="#ln-1594"></a><span class="w">    </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">optional</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">i_value</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="w"></span>
<a id="ln-1595" name="ln-1595" href="#ln-1595"></a>
<a id="ln-1596" name="ln-1596" href="#ln-1596"></a><span class="w">    </span><span class="kt">integer</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">kl</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">loop</span><span class="p">,</span><span class="w"> </span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="n">num2</span><span class="p">,</span><span class="w"> </span><span class="n">i_punc</span><span class="w"></span>
<a id="ln-1597" name="ln-1597" href="#ln-1597"></a><span class="w">    </span><span class="kt">integer</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="n">i_digit</span><span class="p">,</span><span class="w"> </span><span class="n">loop_r</span><span class="p">,</span><span class="w"> </span><span class="n">range_size</span><span class="w"></span>
<a id="ln-1598" name="ln-1598" href="#ln-1598"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dummy</span><span class="w"></span>
<a id="ln-1599" name="ln-1599" href="#ln-1599"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;0123456789&quot;</span><span class="w"></span>
<a id="ln-1600" name="ln-1600" href="#ln-1600"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-:&quot;</span><span class="w"></span>
<a id="ln-1601" name="ln-1601" href="#ln-1601"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; ,;&quot;</span><span class="w"></span>
<a id="ln-1602" name="ln-1602" href="#ln-1602"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">c_punc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; ,;-:&quot;</span><span class="w"></span>
<a id="ln-1603" name="ln-1603" href="#ln-1603"></a><span class="w">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">c_num1</span><span class="p">,</span><span class="w"> </span><span class="n">c_num2</span><span class="w"></span>
<a id="ln-1604" name="ln-1604" href="#ln-1604"></a>
<a id="ln-1605" name="ln-1605" href="#ln-1605"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lcount</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">present</span><span class="p">(</span><span class="n">i_value</span><span class="p">))</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;param_get_range_vector: incorrect call&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1606" name="ln-1606" href="#ln-1606"></a>
<a id="ln-1607" name="ln-1607" href="#ln-1607"></a><span class="w">    </span><span class="n">kl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">len_trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="w"></span>
<a id="ln-1608" name="ln-1608" href="#ln-1608"></a>
<a id="ln-1609" name="ln-1609" href="#ln-1609"></a><span class="w">    </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="w"></span>
<a id="ln-1610" name="ln-1610" href="#ln-1610"></a>
<a id="ln-1611" name="ln-1611" href="#ln-1611"></a><span class="w">    </span><span class="k">do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_lines</span><span class="w"></span>
<a id="ln-1612" name="ln-1612" href="#ln-1612"></a><span class="w">      </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">index</span><span class="p">(</span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1613" name="ln-1613" href="#ln-1613"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">cycle</span>
<a id="ln-1614" name="ln-1614" href="#ln-1614"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1615" name="ln-1615" href="#ln-1615"></a><span class="k">        call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: Found keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; more than once in input file&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1616" name="ln-1616" href="#ln-1616"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1617" name="ln-1617" href="#ln-1617"></a><span class="k">      </span><span class="n">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w"></span>
<a id="ln-1618" name="ln-1618" href="#ln-1618"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">kl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1619" name="ln-1619" href="#ln-1619"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1620" name="ln-1620" href="#ln-1620"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">lcount</span><span class="p">)</span><span class="w"> </span><span class="n">in_data</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">maxlen</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"></span>
<a id="ln-1621" name="ln-1621" href="#ln-1621"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;=&#39;</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;:&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1622" name="ln-1622" href="#ln-1622"></a><span class="k">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span><span class="w"></span>
<a id="ln-1623" name="ln-1623" href="#ln-1623"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1624" name="ln-1624" href="#ln-1624"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1625" name="ln-1625" href="#ln-1625"></a><span class="k">    end do</span>
<a id="ln-1626" name="ln-1626" href="#ln-1626"></a>
<a id="ln-1627" name="ln-1627" href="#ln-1627"></a><span class="k">    if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">found</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<a id="ln-1628" name="ln-1628" href="#ln-1628"></a>
<a id="ln-1629" name="ln-1629" href="#ln-1629"></a><span class="k">    </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<a id="ln-1630" name="ln-1630" href="#ln-1630"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; is blank&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1631" name="ln-1631" href="#ln-1631"></a><span class="w">    </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="w"></span>
<a id="ln-1632" name="ln-1632" href="#ln-1632"></a><span class="w">    </span><span class="k">do</span>
<a id="ln-1633" name="ln-1633" href="#ln-1633"></a><span class="k">      </span><span class="n">i_punc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">scan</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">c_punc</span><span class="p">)</span><span class="w"></span>
<a id="ln-1634" name="ln-1634" href="#ln-1634"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_punc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error parsing keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1635" name="ln-1635" href="#ln-1635"></a><span class="w">      </span><span class="n">c_num1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i_punc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1636" name="ln-1636" href="#ln-1636"></a><span class="w">      </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">c_num1</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span><span class="w"> </span><span class="n">num1</span><span class="w"></span>
<a id="ln-1637" name="ln-1637" href="#ln-1637"></a><span class="w">      </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="n">i_punc</span><span class="p">:))</span><span class="w"></span>
<a id="ln-1638" name="ln-1638" href="#ln-1638"></a><span class="w">      </span><span class="c">!look for range</span>
<a id="ln-1639" name="ln-1639" href="#ln-1639"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">c_range</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1640" name="ln-1640" href="#ln-1640"></a><span class="k">        </span><span class="n">i_digit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">scan</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">c_digit</span><span class="p">)</span><span class="w"></span>
<a id="ln-1641" name="ln-1641" href="#ln-1641"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="n">i_digit</span><span class="p">:))</span><span class="w"></span>
<a id="ln-1642" name="ln-1642" href="#ln-1642"></a><span class="w">        </span><span class="n">i_punc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">scan</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">c_punc</span><span class="p">)</span><span class="w"></span>
<a id="ln-1643" name="ln-1643" href="#ln-1643"></a><span class="w">        </span><span class="n">c_num2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dummy</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i_punc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1644" name="ln-1644" href="#ln-1644"></a><span class="w">        </span><span class="k">read</span><span class="w"> </span><span class="p">(</span><span class="n">c_num2</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span><span class="w"> </span><span class="n">num2</span><span class="w"></span>
<a id="ln-1645" name="ln-1645" href="#ln-1645"></a><span class="w">        </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="n">i_punc</span><span class="p">:))</span><span class="w"></span>
<a id="ln-1646" name="ln-1646" href="#ln-1646"></a><span class="w">        </span><span class="n">range_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">num2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">num1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1647" name="ln-1647" href="#ln-1647"></a><span class="w">        </span><span class="k">do </span><span class="n">loop_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">range_size</span><span class="w"></span>
<a id="ln-1648" name="ln-1648" href="#ln-1648"></a><span class="w">          </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1649" name="ln-1649" href="#ln-1649"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">lcount</span><span class="p">)</span><span class="w"> </span><span class="n">i_value</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span><span class="w"> </span><span class="n">num2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">loop_r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1650" name="ln-1650" href="#ln-1650"></a><span class="w">        </span><span class="k">end do</span>
<a id="ln-1651" name="ln-1651" href="#ln-1651"></a><span class="k">      else</span>
<a id="ln-1652" name="ln-1652" href="#ln-1652"></a><span class="k">        </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1653" name="ln-1653" href="#ln-1653"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">lcount</span><span class="p">)</span><span class="w"> </span><span class="n">i_value</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num1</span><span class="w"></span>
<a id="ln-1654" name="ln-1654" href="#ln-1654"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1655" name="ln-1655" href="#ln-1655"></a>
<a id="ln-1656" name="ln-1656" href="#ln-1656"></a><span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">c_sep</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">dummy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">adjustl</span><span class="p">(</span><span class="n">dummy</span><span class="p">(</span><span class="mi">2</span><span class="p">:))</span><span class="w"></span>
<a id="ln-1657" name="ln-1657" href="#ln-1657"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="n">c_range</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error parsing keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; incorrect range&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1658" name="ln-1658" href="#ln-1658"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">dummy</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>
<a id="ln-1659" name="ln-1659" href="#ln-1659"></a><span class="k">    end do</span>
<a id="ln-1660" name="ln-1660" href="#ln-1660"></a>
<a id="ln-1661" name="ln-1661" href="#ln-1661"></a><span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">lcount</span><span class="p">)</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">counter</span><span class="w"></span>
<a id="ln-1662" name="ln-1662" href="#ln-1662"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">lcount</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1663" name="ln-1663" href="#ln-1663"></a><span class="k">      do </span><span class="n">loop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<a id="ln-1664" name="ln-1664" href="#ln-1664"></a><span class="w">        </span><span class="k">do </span><span class="n">loop_r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="w"></span>
<a id="ln-1665" name="ln-1665" href="#ln-1665"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">i_value</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i_value</span><span class="p">(</span><span class="n">loop_r</span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span><span class="w"></span>
<a id="ln-1666" name="ln-1666" href="#ln-1666"></a><span class="w">            </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error parsing keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; duplicate values&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1667" name="ln-1667" href="#ln-1667"></a><span class="w">        </span><span class="k">end do</span>
<a id="ln-1668" name="ln-1668" href="#ln-1668"></a><span class="k">      end do</span>
<a id="ln-1669" name="ln-1669" href="#ln-1669"></a><span class="k">    end if</span>
<a id="ln-1670" name="ln-1670" href="#ln-1670"></a>
<a id="ln-1671" name="ln-1671" href="#ln-1671"></a><span class="k">    return</span>
<a id="ln-1672" name="ln-1672" href="#ln-1672"></a>
<a id="ln-1673" name="ln-1673" href="#ln-1673"></a><span class="mi">101</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error parsing keyword &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keyword</span><span class="p">))</span><span class="w"></span>
<a id="ln-1674" name="ln-1674" href="#ln-1674"></a>
<a id="ln-1675" name="ln-1675" href="#ln-1675"></a><span class="w">  </span><span class="k">end subroutine </span><span class="n">param_get_range_vector</span><span class="w"></span>
<a id="ln-1676" name="ln-1676" href="#ln-1676"></a>
<a id="ln-1677" name="ln-1677" href="#ln-1677"></a><span class="w">  </span><span class="k">subroutine </span><span class="n">param_dist</span><span class="w"></span>
<a id="ln-1678" name="ln-1678" href="#ln-1678"></a><span class="w">    </span><span class="c">!-----------------------------------------------------</span>
<a id="ln-1679" name="ln-1679" href="#ln-1679"></a><span class="w">    </span><span class="c">! Send the parameters from the root node to all others</span>
<a id="ln-1680" name="ln-1680" href="#ln-1680"></a><span class="w">    </span><span class="c">!-----------------------------------------------------</span>
<a id="ln-1681" name="ln-1681" href="#ln-1681"></a>
<a id="ln-1682" name="ln-1682" href="#ln-1682"></a><span class="w">    </span><span class="k">use </span><span class="n">od_comms</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">comms_bcast</span><span class="p">,</span><span class="w"> </span><span class="n">on_root</span><span class="w"></span>
<a id="ln-1683" name="ln-1683" href="#ln-1683"></a><span class="w">    </span><span class="k">use </span><span class="n">od_io</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="p">:</span><span class="w"> </span><span class="n">io_error</span><span class="w"></span>
<a id="ln-1684" name="ln-1684" href="#ln-1684"></a>
<a id="ln-1685" name="ln-1685" href="#ln-1685"></a><span class="w">    </span><span class="k">implicit none</span>
<a id="ln-1686" name="ln-1686" href="#ln-1686"></a><span class="k">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ierr</span><span class="w"></span>
<a id="ln-1687" name="ln-1687" href="#ln-1687"></a>
<a id="ln-1688" name="ln-1688" href="#ln-1688"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">output_format</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">output_format</span><span class="p">))</span><span class="w"></span>
<a id="ln-1689" name="ln-1689" href="#ln-1689"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">devel_flag</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">devel_flag</span><span class="p">))</span><span class="w"></span>
<a id="ln-1690" name="ln-1690" href="#ln-1690"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">iprint</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1691" name="ln-1691" href="#ln-1691"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">energy_unit</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">energy_unit</span><span class="p">))</span><span class="w"></span>
<a id="ln-1692" name="ln-1692" href="#ln-1692"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">length_unit</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">length_unit</span><span class="p">))</span><span class="w"></span>
<a id="ln-1693" name="ln-1693" href="#ln-1693"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1694" name="ln-1694" href="#ln-1694"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">pdos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1695" name="ln-1695" href="#ln-1695"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">jdos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1696" name="ln-1696" href="#ln-1696"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">optics</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1697" name="ln-1697" href="#ln-1697"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1698" name="ln-1698" href="#ln-1698"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_photon_sweep</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1699" name="ln-1699" href="#ln-1699"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">core</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1700" name="ln-1700" href="#ln-1700"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">compare_dos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1701" name="ln-1701" href="#ln-1701"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">compare_jdos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1702" name="ln-1702" href="#ln-1702"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">fixed</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1703" name="ln-1703" href="#ln-1703"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">adaptive</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1704" name="ln-1704" href="#ln-1704"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1705" name="ln-1705" href="#ln-1705"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">quad</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1706" name="ln-1706" href="#ln-1706"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos_nbins</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1707" name="ln-1707" href="#ln-1707"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">compute_band_energy</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1708" name="ln-1708" href="#ln-1708"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">compute_band_gap</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1709" name="ln-1709" href="#ln-1709"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">adaptive_smearing</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1710" name="ln-1710" href="#ln-1710"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">fixed_smearing</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1711" name="ln-1711" href="#ln-1711"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">linear_smearing</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1712" name="ln-1712" href="#ln-1712"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">hybrid_linear</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1713" name="ln-1713" href="#ln-1713"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">hybrid_linear_grad_tol</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1714" name="ln-1714" href="#ln-1714"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos_per_volume</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1715" name="ln-1715" href="#ln-1715"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">efermi_user</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1716" name="ln-1716" href="#ln-1716"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">efermi_choice</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">efermi_choice</span><span class="p">))</span><span class="w"></span>
<a id="ln-1717" name="ln-1717" href="#ln-1717"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">finite_bin_correction</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1718" name="ln-1718" href="#ln-1718"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">numerical_intdos</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1719" name="ln-1719" href="#ln-1719"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">jdos_max_energy</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1720" name="ln-1720" href="#ln-1720"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">jdos_spacing</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1721" name="ln-1721" href="#ln-1721"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">scissor_op</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1722" name="ln-1722" href="#ln-1722"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">optics_geom</span><span class="p">))</span><span class="w"></span>
<a id="ln-1723" name="ln-1723" href="#ln-1723"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">optics_qdir</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-1724" name="ln-1724" href="#ln-1724"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">optics_intraband</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1725" name="ln-1725" href="#ln-1725"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">optics_drude_broadening</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1726" name="ln-1726" href="#ln-1726"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">core_chemical_shift</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1727" name="ln-1727" href="#ln-1727"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">core_geom</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">core_geom</span><span class="p">))</span><span class="w"></span>
<a id="ln-1728" name="ln-1728" href="#ln-1728"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">core_type</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">core_type</span><span class="p">))</span><span class="w"></span>
<a id="ln-1729" name="ln-1729" href="#ln-1729"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">core_qdir</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<a id="ln-1730" name="ln-1730" href="#ln-1730"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">core_LAI_broadening</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1731" name="ln-1731" href="#ln-1731"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">LAI_gaussian_width</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1732" name="ln-1732" href="#ln-1732"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">LAI_gaussian</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1733" name="ln-1733" href="#ln-1733"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">LAI_lorentzian_width</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1734" name="ln-1734" href="#ln-1734"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">LAI_lorentzian_scale</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1735" name="ln-1735" href="#ln-1735"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">LAI_lorentzian_offset</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1736" name="ln-1736" href="#ln-1736"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">LAI_lorentzian</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1737" name="ln-1737" href="#ln-1737"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos_per_volume</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1738" name="ln-1738" href="#ln-1738"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos_min_energy</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1739" name="ln-1739" href="#ln-1739"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos_max_energy</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1740" name="ln-1740" href="#ln-1740"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">dos_spacing</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1741" name="ln-1741" href="#ln-1741"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">legacy_file_format</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1742" name="ln-1742" href="#ln-1742"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">projectors_string</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">projectors_string</span><span class="p">))</span><span class="w"></span>
<a id="ln-1743" name="ln-1743" href="#ln-1743"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">set_efermi_zero</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1744" name="ln-1744" href="#ln-1744"></a><span class="w">    </span><span class="c">!</span>
<a id="ln-1745" name="ln-1745" href="#ln-1745"></a><span class="w">    </span><span class="c">! Photoemission</span>
<a id="ln-1746" name="ln-1746" href="#ln-1746"></a><span class="w">    </span><span class="c">! TODO: Broadcast the rest of the photoemission parameters!!</span>
<a id="ln-1747" name="ln-1747" href="#ln-1747"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_model</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">photo_model</span><span class="p">))</span><span class="w"></span>
<a id="ln-1748" name="ln-1748" href="#ln-1748"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_momentum</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">photo_momentum</span><span class="p">))</span><span class="w"></span>
<a id="ln-1749" name="ln-1749" href="#ln-1749"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_photon_energy</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1750" name="ln-1750" href="#ln-1750"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">photo_photon_sweep</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1751" name="ln-1751" href="#ln-1751"></a><span class="k">      call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_photon_min</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1752" name="ln-1752" href="#ln-1752"></a><span class="w">      </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_photon_max</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1753" name="ln-1753" href="#ln-1753"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1754" name="ln-1754" href="#ln-1754"></a><span class="k">    call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_work_function</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1755" name="ln-1755" href="#ln-1755"></a><span class="w">    </span><span class="c">! call comms_bcast(photo_surface_area, 1)</span>
<a id="ln-1756" name="ln-1756" href="#ln-1756"></a><span class="w">    </span><span class="c">! call comms_bcast(photo_slab_volume, 1)</span>
<a id="ln-1757" name="ln-1757" href="#ln-1757"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_slab_max</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1758" name="ln-1758" href="#ln-1758"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_slab_min</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1759" name="ln-1759" href="#ln-1759"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_layer_choice</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">photo_layer_choice</span><span class="p">))</span><span class="w"></span>
<a id="ln-1760" name="ln-1760" href="#ln-1760"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_max_layer</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1761" name="ln-1761" href="#ln-1761"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_elec_field</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1762" name="ln-1762" href="#ln-1762"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_remove_box_states</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1763" name="ln-1763" href="#ln-1763"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_len_imfp_const</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1764" name="ln-1764" href="#ln-1764"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">on_root</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1765" name="ln-1765" href="#ln-1765"></a><span class="k">      allocate</span><span class="w"> </span><span class="p">(</span><span class="n">photo_imfp_const</span><span class="p">(</span><span class="n">photo_len_imfp_const</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-1766" name="ln-1766" href="#ln-1766"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error: param_dist - allocation failed for photo_imfp_const&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1767" name="ln-1767" href="#ln-1767"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1768" name="ln-1768" href="#ln-1768"></a><span class="k">    call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_imfp_const</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">photo_len_imfp_const</span><span class="p">)</span><span class="w"></span>
<a id="ln-1769" name="ln-1769" href="#ln-1769"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_bulk_cutoff</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1770" name="ln-1770" href="#ln-1770"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_temperature</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1771" name="ln-1771" href="#ln-1771"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">write_photo_output</span><span class="p">))</span><span class="w"></span>
<a id="ln-1772" name="ln-1772" href="#ln-1772"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_theta_lower</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1773" name="ln-1773" href="#ln-1773"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_theta_upper</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1774" name="ln-1774" href="#ln-1774"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_phi_lower</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1775" name="ln-1775" href="#ln-1775"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">photo_phi_upper</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1776" name="ln-1776" href="#ln-1776"></a>
<a id="ln-1777" name="ln-1777" href="#ln-1777"></a><span class="w">    </span><span class="k">call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">num_exclude_bands</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<a id="ln-1778" name="ln-1778" href="#ln-1778"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">num_exclude_bands</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1779" name="ln-1779" href="#ln-1779"></a><span class="k">      if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">on_root</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<a id="ln-1780" name="ln-1780" href="#ln-1780"></a><span class="k">        allocate</span><span class="w"> </span><span class="p">(</span><span class="n">exclude_bands</span><span class="p">(</span><span class="n">num_exclude_bands</span><span class="p">),</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span><span class="w"></span>
<a id="ln-1781" name="ln-1781" href="#ln-1781"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ierr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">io_error</span><span class="p">(</span><span class="s1">&#39;Error allocating exclude_bands in param_read&#39;</span><span class="p">)</span><span class="w"></span>
<a id="ln-1782" name="ln-1782" href="#ln-1782"></a><span class="w">      </span><span class="k">end if</span>
<a id="ln-1783" name="ln-1783" href="#ln-1783"></a><span class="k">      call </span><span class="n">comms_bcast</span><span class="p">(</span><span class="n">exclude_bands</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">num_exclude_bands</span><span class="p">)</span><span class="w"></span>
<a id="ln-1784" name="ln-1784" href="#ln-1784"></a><span class="w">    </span><span class="k">end if</span>
<a id="ln-1785" name="ln-1785" href="#ln-1785"></a>
<a id="ln-1786" name="ln-1786" href="#ln-1786"></a><span class="k">  end subroutine </span><span class="n">param_dist</span><span class="w"></span>
<a id="ln-1787" name="ln-1787" href="#ln-1787"></a>
<a id="ln-1788" name="ln-1788" href="#ln-1788"></a><span class="k">end module </span><span class="n">od_parameters</span><span class="w"></span>
</pre></div>

    </section>
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>OptaDOS was developed by The OptaDOS developers group<br>&copy; 2024 
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>